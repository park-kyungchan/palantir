# HWPX Native: OWPML & Spec Compliance (KS X 6101)

This document outlines the requirements and implementation details for generating native HWPX (XML) files that are 100% compatible with Hancom Office 2024.

## 1. Specification Compliance
All XML construction follows the **KS X 6101** national standard. We avoid "simulated" formatting and instead use native OWPML elements.

### 1.1 HwpUnit Conversion Formulas
**1 HwpUnit = 1/7200 inch** (approx. 0.00353mm).

| Conversion | Formula | Example |
|---|---|---|
| HwpUnit → pt | `pt = hwpunit / 100` | 1000 HwpUnit = 10pt |
| HwpUnit → mm | `mm = hwpunit / 283.46` | 283 HwpUnit ≈ 1mm |
| pt → HwpUnit | `hwpunit = pt * 100` | 12pt = 1200 HwpUnit |
| mm → HwpUnit | `hwpunit = mm * 283.46` | 25.4mm = 7200 HwpUnit |

## 2. Template-Based Reconstruction (TBR)
Due to the OWPML header's extreme complexity (IDs for fonts, styles, borders), the engine uses a "Golden Template".
- **Source**: `Skeleton.hwpx` (official base).
- **Process**: Copy all ZIP parts except `Contents/section0.xml`.
- **Dynamic Content**: Inject generated paragraph and run data into `section0.xml`.

## 3. Control Elements (`hp:ctrl`)
Critical layout and mathematical objects are **Controls**, not attributes.
- **Columns (`hp:colPr`)**: Must be inserted after `<hp:secPr>` in the first run of a section. Use attributes `colCount`, `type="NEWSPAPER"`, `sameSz="1"`, and `sameGap`.
- **Equations (`hp:eqEdit`)**: Requires transpilation from LaTeX -> HWP Script -> `<hp:eqEdit>`.
- **Tables (`hp:tbl`)**: Hierarchical structure with `<hp:tr>` (rows) and `<hp:tc>` (cells).
- **Images (`hp:pic`)**: References `BinData/` items via `binaryItemIDRef`. Use `<hp:originalSize>` and `<hp:curSize>` for dimensions.
- **Shapes (`hp:rect`, `hp:ellipse`, etc.)**: Drawing objects with absolute positioning in HwpUnit.

### 3.1 Table Merge Logic (KS X 6101)
Cell merging is handled by the `<hp:cellSpan>` child element within `<hp:tc>`, not by attributes on the cell itself.

```xml
<hp:tc>
  <hp:cellAddr colAddr="0" rowAddr="0"/>
  <hp:cellSpan colSpan="2" rowSpan="3"/>
</hp:tc>
```

**Key Requirement**: HWPX does not allow "ghost cells" in merged regions. If cells are merged, the number of `<hp:tc>` elements in the row decreases. Logical coordinates must be tracked via `cellAddr`.

## 4. Packaging and OCF Compliance
HWPX files must strictly follow Open Container Format (OCF) standards:
1. **mimetype**: Must be the **first file** in the ZIP archive, **uncompressed (Stored)**, and contain only `application/hwp+zip`.
2. **Mandatory Files**: `version.xml`, `Contents/content.hpf`, `Contents/header.xml`, `Contents/section0.xml`, `META-INF/container.xml`.
3. **OPF Spine**: The `content.hpf` spine defines the reading order of sections.

## 5. Tools and Libraries
- **python-hwpx**: Primary library for cross-platform programmatic control (no HWP installation required).
- **HwpUnit Utilities**: Centralized in `lib/owpml/units.py` for precision layout.

## 6. Stability Checklist
- **Paragraph IDs**: Every `<hp:p>` should have `paraPrIDRef` and optionally `styleIDRef`.
- **Lineseg**: Every paragraph must have a skeletal `<hp:linesegarray>` for renderer stability.
- **Namespace Consistency**: Always use standard OWPML 2011/2016 URIs.
