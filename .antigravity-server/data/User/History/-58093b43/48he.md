# HWPX Pipeline Audit: Pilot Test (sample.pdf)

## 1. Audit Target
- **Input**: `sample.pdf` (Complex layout with tables, equations, and numbering)
- **Engine**: HWPX Reconstruction Pipeline (Phase 15 - Unified)
- **Mode**: Local (`--no-ocr`, Docling-driven sequence)

## 2. Stage B Results: Logic Trace Failure
The pilot test identified critical systemic disconnects preventing successful end-to-end execution.

### 2.1 Argument Drift
- **Issue**: `main.py` attempted to instantiate `HWPXPipeline` with `use_ocr=True`.
- **Root Cause**: The `HWPXPipeline` constructor in `lib/pipeline.py` defines the parameter as `use_mathpix`.
- **Impact**: Immediate `TypeError` on execution, blocking the ingestion layer.

### 2.2 Orchestration Void
- **Issue**: `HWPXPipeline.run()` was hard-coded to use the legacy `HWPGenerator`.
- **Root Cause**: The modern `HwpxDocumentBuilder` (developed in Phases 8-14) was never promoted to the primary generation engine.
- **Impact**: Even if ingestion succeeded, the output would lack tables, images, and advanced styling supported by the builder.

## 3. Remediation Actions (Completed)
1. **Signature Alignment**: Modified `main.py` to pass `use_mathpix` to the pipeline.
2. **Engine Promotion**: Integrated `HwpxDocumentBuilder` into `lib/pipeline.py`, replacing the `HWPGenerator` call.
3. **Trace Verification**: Confirmed that `HwpAction` objects generated by the compiler are now correctly routed to the builder's recursive `build()` method.

## 4. Current Blockers (Post-Remediation)
- **Silent Exit**: Running the pilot after remediation produced no console output and no `sample_pilot.hwpx`.
- **Suspected Cause**: The `DoclingIngestor` or `MarkdownParser` may be encountering an unhandled exception that is being swallowed or resulting in an empty action list.
- **Next Step**: Enable verbose logging in `lib/pipeline.py` and inspect the intermediate `actions_dicts` to locate the drop-off point.
