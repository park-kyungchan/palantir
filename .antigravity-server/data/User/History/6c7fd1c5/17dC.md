# Walkthrough: ODA 3-Stage Protocol Framework (v5.1)

**Date:** 2026-01-05
**Status:** FULLY DEPLOYED
**Protocol:** ANTIGRAVITY_ARCHITECT_V5.1 (SCRIPT-ENFORCED)

---

## 1. Overview

The Orion ODA has transitioned from manual adherence to the "3-Stage Deep-Dive" methodology to a **programmatically enforced framework**. This transition ensures that every operation—Audit, Planning, and Execution—is backed by verifiable evidence (files viewed, line references, and logic traces), eliminating LLM hallucination and ensuring architectural consistency.

---

## 2. Core Python Framework (`scripts/ontology/protocols/`)

The framework is built on a set of abstract base classes and decorators that mandate a 3-stage sequence:

1.  **Stage A (SCAN)**: Surface scan to establish structural reality.
2.  **Stage B (TRACE)**: Integration trace to verify data flows and signatures.
3.  **Stage C (VERIFY)**: Quality gate for final validation.

### Key Components:
- **`ThreeStageProtocol`**: The abstract base class orchestrating the A->B->C sequence.
- **`StageResult`**: Mandatory data object requiring `evidence` for a "PASS" status.
- **`@require_protocol`**: A decorator used in `ActionType` definitions to block execution until the associated protocol passes.
- **`ProtocolRegistry`**: A central manager tracking protocol compliance status.

---

## 3. Governance Integration

The `GovernanceEngine` (in `scripts/ontology/actions/__init__.py`) was updated with a `check_protocol_compliance()` method. This method serves as a mandatory pre-execution gate for all ODA actions.

**Enforcement Policy:**
- **BLOCK**: Execution is denied if the required protocol hasn't passed with sufficient evidence.
- **WARN**: Execution proceeds but logs a compliance violation (used for non-critical path operations).

---

## 4. Workflow & Rules Synchronization

To satisfy the "No Ambiguity" requirement, the `.agent/` configuration layer was restructured:

### Workflows (`.agent/workflows/`):
- **`/00_start`**: Now initializes the `ProtocolContext` for the session.
- **`@/01_plan`**: Restructured to match the `PlanningProtocol` stages.
- **`/05_consolidate`**: Wrapped with `ExecutionProtocol` pre/post checks.
- **`/deep-audit`**: A new, dedicated workflow for the `AuditProtocol`.

### Rules (`.agent/rules/governance/`):
- **`protocol_required.md`**: Defines the mapping between action types and their mandatory protocols.
- **`three_stage_protocol.md`**: Formalizes the methodology as a core system rule.

---

## 5. Verification Results

Successful verification was conducted on 2026-01-05:
- **E2E Tests**: 100% pass (tests/e2e/test_monolith.py).
- **Import Chain**: Verified functional imports from `scripts.ontology.protocols`.
- **Protocol Execution**: `AuditProtocol` and `PlanningProtocol` confirmed to generate 3-stage results with mandatory evidence tracking.

---

## 6. Conclusion

With the deployment of the Kernel v5.1 and the 3-Stage Protocol Framework, the Orion ODA has reached a new level of operational rigor. The system now programmatically prevents the "leap-before-looking" behavior and mandates a deep-dive analysis for every mutation.
