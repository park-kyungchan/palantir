# HWPX Programmatic Automation ê°œì„  ê³„íš

> **Protocol:** 3-Stage Planning (01_plan)  
> **Target:** `/home/palantir/hwpx/`  
> **Reference:** `docs/hwpx_progrmmatic.md` (KS X 6101 ìŠ¤í™)

---

## User Review Required

> [!IMPORTANT]
> í˜„ì¬ êµ¬í˜„ì²´ì™€ ìŠ¤í™ ë¬¸ì„œ ê°„ Gap ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.
> ìš°ì„ ìˆœìœ„/ë²”ìœ„ í™•ì¸ í›„ ì§„í–‰ ìŠ¹ì¸ ë°”ëë‹ˆë‹¤.

---

## Stage A: Gap Analysis

### í˜„ì¬ êµ¬í˜„ ìƒíƒœ

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ | ìƒíƒœ |
|---------|------|------|
| OWPML Generator | `lib/owpml/generator.py` | âœ… ê¸°ë³¸ ë™ì‘ |
| Document Builder | `lib/owpml/document_builder.py` | âœ… 341 lines |
| LaTeX Converter | `lib/owpml/equation_converter.py` | âœ… 255 lines |
| Table Compile | `lib/compiler.py` | ğŸŸ¡ ë³‘í•© ë¯¸ì§€ì› |

### ìŠ¤í™ vs êµ¬í˜„ Gap

| ìŠ¤í™ í•­ëª© | ë¬¸ì„œ ìœ„ì¹˜ | í˜„ì¬ êµ¬í˜„ | Gap |
|----------|----------|----------|-----|
| ì…€ ë³‘í•© (`cellSpan`) | Line 54-72 | âŒ ë¯¸êµ¬í˜„ | `<hp:cellSpan colSpan rowSpan>` ëˆ„ë½ |
| í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼ ì°¸ì¡° | Line 74-87 | ğŸŸ¡ í•˜ë“œì½”ë”© | `header.xml` `borderFillIDRef` ë™ì  ê´€ë¦¬ í•„ìš” |
| BinData ì´ë¯¸ì§€ | Line 267-276 | âŒ ë¯¸êµ¬í˜„ | ZIP ë‚´ ì´ë¯¸ì§€ ì£¼ì… ë¡œì§ ì—†ìŒ |
| HwpUnit ë³€í™˜ | Line 155-167 | ğŸŸ¡ ë¶€ë¶„ | ì²´ê³„ì  ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ í•„ìš” |

---

## Stage B: Proposed Phases

### Phase 1: Table Cell Merge (`cellSpan`)

**ëª©í‘œ:** í‘œ ë³‘í•© ê¸°ëŠ¥ êµ¬í˜„ (rowspan/colspan)

**íŒŒì¼ ìˆ˜ì •:**
- `lib/owpml/document_builder.py` - `_create_table()` ì¶”ê°€
- `lib/models.py` - `MergeCells` action ì¶”ê°€

**í…ŒìŠ¤íŠ¸:**
```python
# tests/unit/test_table_merge.py
def test_2x3_merge():
    actions = [CreateTable(rows=3, cols=3), MergeCells(0, 0, rowspan=2, colspan=2)]
    # ê²°ê³¼: cellSpan ìš”ì†Œ ìƒì„± í™•ì¸
```

---

### Phase 2: BorderFill ID ê´€ë¦¬

**ëª©í‘œ:** `header.xml`ì˜ borderFill ìŠ¤íƒ€ì¼ ë™ì  ë“±ë¡/ì°¸ì¡°

**êµ¬í˜„:**
```python
class HeaderManager:
    def register_border_fill(self, style: BorderStyle) -> int:
        """Returns borderFillIDRef for use in cells"""
```

**íŒŒì¼:**
- [NEW] `lib/owpml/header_manager.py`
- [MODIFY] `lib/owpml/document_builder.py`

---

### Phase 3: BinData ì´ë¯¸ì§€ íŒŒì´í”„ë¼ì¸

**ëª©í‘œ:** ì´ë¯¸ì§€ë¥¼ ZIP ì•„ì¹´ì´ë¸Œì— ì£¼ì…í•˜ê³  `hp:binItemRefId` ì°¸ì¡°

**êµ¬í˜„:**
```python
class BinDataManager:
    def add_image(self, image_path: str) -> str:
        """Returns BIN_ID for hp:pic reference"""
```

**íŒŒì¼:**
- [NEW] `lib/owpml/bindata_manager.py`
- [MODIFY] `lib/owpml/generator.py`

---

### Phase 4: HwpUnit ë³€í™˜ ìœ í‹¸ë¦¬í‹°

**ëª©í‘œ:** mm/pt/inch â†” HwpUnit ë³€í™˜ í†µí•©

**êµ¬í˜„:**
```python
# lib/owpml/units.py
def mm_to_hwpunit(mm: float) -> int:
    return int(mm * 283.46)

def pt_to_hwpunit(pt: float) -> int:
    return int(pt * 100)
```

---

## Stage C: Quality Gate

### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

| Phase | í…ŒìŠ¤íŠ¸ íŒŒì¼ | ì¼€ì´ìŠ¤ |
|-------|-----------|-------|
| 1 | `test_table_merge.py` | 2x2, 3x3 ë³‘í•© |
| 2 | `test_header_manager.py` | ìŠ¤íƒ€ì¼ ë“±ë¡/ì°¸ì¡° |
| 3 | `test_bindata.py` | PNG/JPG ì£¼ì… |
| 4 | `test_units.py` | ë³€í™˜ ì •í™•ë„ |

### ê²€ì¦ ëª…ë ¹

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
pytest tests/unit/ -v

# HWPX ì¶œë ¥ ê²€ì¦
python scripts/verify_hwpx_output.py output.hwpx
```

---

## ë¦¬ìŠ¤í¬ í‰ê°€

| ë¦¬ìŠ¤í¬ | í™•ë¥  | ì˜í–¥ | ì™„í™”ì±… |
|-------|------|-----|--------|
| ì…€ ë³‘í•© ì•Œê³ ë¦¬ì¦˜ ë³µì¡ì„± | Medium | High | ë‹¨ê³„ì  êµ¬í˜„ (2x2 â†’ NxM) |
| header.xml í˜¸í™˜ì„± | Low | Medium | Skeleton.hwpx ê¸°ë°˜ ìœ ì§€ |
| ì´ë¯¸ì§€ í¬ë§· ë‹¤ì–‘ì„± | Medium | Low | PNG/JPG ìš°ì„  ì§€ì› |

---

## ìš°ì„ ìˆœìœ„ ì¶”ì²œ

1. **Phase 4** (HwpUnit) - ê¸°ë°˜ ìœ í‹¸ë¦¬í‹°, 30ë¶„
2. **Phase 1** (Table Merge) - í•µì‹¬ ê¸°ëŠ¥, 2ì‹œê°„  
3. **Phase 2** (BorderFill) - ìŠ¤íƒ€ì¼ ì •êµí™”, 1ì‹œê°„
4. **Phase 3** (BinData) - ì´ë¯¸ì§€ ì§€ì›, 1.5ì‹œê°„

---

> **Ready to Execute:** Pending User Approval
