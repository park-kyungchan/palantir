# HWPX Automation & Compliance Improvement Plan

> **Protocol:** 01_plan (3-Stage)
> **Baseline:** KS X 6101 OWPML Specification
> **Status:** Phase 4 & Phase 1 Foundation Complete

---

## User Review Required

> [!WARNING]
> Critical gaps identified in OWPML compliance:
> 1. **Image/Shape Support**: `InsertImage`, `InsertTextBox`, `CreateBorderBox` defined but NOT implemented in builder.
> 2. **Start/End of Compliance**: `requirements.txt` missing `python-hwpx`.
> 3. **ID Reference System**: Current implementation uses hardcoded ID '0', violating KS X 6101 spec for complex documents.

---

## Stage A: Compliance Audit Findings

| Category | Finding | Spec Ref | Severity |
|----------|---------|----------|----------|
| **Dependency** | `python-hwpx` missing in requirements.txt | N/A | HIGH |
| **Logic** | `InsertImage` handler missing | Line 219 (hp:pic) | HIGH |
| **Logic** | `InsertTextBox` handler missing | Line 231 (Shape) | HIGH |
| **Logic** | `CreateBorderBox` handler missing | Line 203 | MEDIUM |
| **Protocol** | Hardcoded ID refs (styleIDRef="0") | Line 101 (header.xml) | HIGH |

---

## Stage B: Phased Roadmap

### âœ… [Completed] Standard Features (Phases 1-9)
- **Phase 1**: Tables (Merging, Precision 1/100pt).
- **Phase 3**: BinData Manager (Embedded Resources).
- **Phase 6**: Controls (Images, TextBoxes).
- **Phase 7**: Equations (LaTeX to HWP Script).
- **Phase 8**: Styles (CharPr, ParaPr, Dynamic IDs).
- **Phase 9**: Page Layout (Dimensions, Orientation, Margins).

### ðŸ†• Phase 10: Table Formatting (Borders & Fills)
- **Concept**: Transform `DocumentBuilder` into a Cursor-based State Machine for Table Editing.
- **Actions**:
  - `MoveToCell(row, col)`: Set context to specific cell.
  - `SetCellBorder(...)`: Apply `borderFill` to current cell.
  - `InsertText(...)`: Insert text into current cell context.
- **Architecture**:
  - `HeaderManager`: Implement `get_or_create_border_fill(type, width, color)`.
  - `DocumentBuilder`: Track `self._current_cell` and `self._current_container`.

### ðŸ”® Future Phases
- **Phase 11**: Nested Tables.
- **Phase 12**: Advanced Lists (Bullets/Numbering).

---

## Stage C: Quality Gate & Verification

### Verification Plan
- **Phase 5**: `pip install -r requirements.txt` succeeds; valid .hwpx generated.
- **Phase 6**: Generated HWPX contains visible Image and TextBox.
- **Phase 2**: XML diff shows unique IDs for different styles.

### Recommended Execution Order
1. **Phase 5** (Fix Env - 5 mins)
2. **Phase 3 + 6** (BinData + Images - 2 hours)
3. **Phase 1** (Tables - 2 hours)
4. **Phase 2** (Styles - 3 hours)

---

> **Ready to Execute:** Pending User Approval for Phase 5 & 6.
