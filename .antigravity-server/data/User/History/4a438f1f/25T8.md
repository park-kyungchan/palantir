# HWPX Automation & Compliance Improvement Plan

> **Protocol:** 01_plan (3-Stage)
> **Baseline:** KS X 6101 OWPML Specification
> **Status:** Phase 4 & Phase 1 Foundation Complete

---

## User Review Required

> [!WARNING]
> Critical gaps identified in OWPML compliance:
> 1. **Image/Shape Support**: `InsertImage`, `InsertTextBox`, `CreateBorderBox` defined but NOT implemented in builder.
> 2. **Start/End of Compliance**: `requirements.txt` missing `python-hwpx`.
> 3. **ID Reference System**: Current implementation uses hardcoded ID '0', violating KS X 6101 spec for complex documents.

---

## Stage A: Compliance Audit Findings

| Category | Finding | Spec Ref | Severity |
|----------|---------|----------|----------|
| **Dependency** | `python-hwpx` missing in requirements.txt | N/A | HIGH |
| **Logic** | `InsertImage` handler missing | Line 219 (hp:pic) | HIGH |
| **Logic** | `InsertTextBox` handler missing | Line 231 (Shape) | HIGH |
| **Logic** | `CreateBorderBox` handler missing | Line 203 | MEDIUM |
| **Protocol** | Hardcoded ID refs (styleIDRef="0") | Line 101 (header.xml) | HIGH |

---

## Stage B: Phased Roadmap

### âœ… [Completed] Phase 4: Foundation
- HwpUnit utilities implemented and tested.

### ðŸŸ¡ [In-Progress] Phase 1: Table Implementation
- `MergeCells` action model added.
- **Next**: Implement `_create_table()` using `hp:tbl`, `hp:tr`, `hp:tc` with `cellSpan`.

### ðŸ†• Phase 5: Dependency & CI Fixes
- Add `python-hwpx==1.9` to `requirements.txt`.
- Verify `mimetype` OCF compliance (stored/first).

### ðŸ†• Phase 6: Control Objects (Images & Shapes)
- Implement `_insert_image` using `hp:pic` schema.
- Implement `_insert_textbox` using `hp:rect` schema.
- Requires **Phase 3 (BinData Manager)** to be active.

### ðŸ”„ Phase 2: Style & ID Management (Refined)
- Create `HeaderManager` to dynamically register:
  - `borderFills` (for Tables/BorderBox)
  - `charPr` (for Fonts/Colors)
  - `paraPr` (for Alignments)
- Replace '0' hardcodes with dynamic IDs.

---

## Stage C: Quality Gate & Verification

### Verification Plan
- **Phase 5**: `pip install -r requirements.txt` succeeds; valid .hwpx generated.
- **Phase 6**: Generated HWPX contains visible Image and TextBox.
- **Phase 2**: XML diff shows unique IDs for different styles.

### Recommended Execution Order
1. **Phase 5** (Fix Env - 5 mins)
2. **Phase 3 + 6** (BinData + Images - 2 hours)
3. **Phase 1** (Tables - 2 hours)
4. **Phase 2** (Styles - 3 hours)

---

> **Ready to Execute:** Pending User Approval for Phase 5 & 6.
