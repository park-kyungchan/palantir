# Docling Model Pre-Download Plan

## Objective
Pre-download all Docling models to enable stable offline PDF processing in the HWPX pipeline.

---

## Stage A: Blueprint âœ…

### Requirements
- Download all Docling models (layout, tableformer, picture classifier, code formula, easyocr)
- Configure `docling_ingestor.py` to use local artifacts path
- Verify offline operation

### Dependencies
| Component | Status |
|:---|:---|
| `docling-tools` CLI | Available in .venv |
| HuggingFace cache | Partial (some models exist) |
| Docling cache | Empty (`~/.cache/docling/models` not found) |

### Complexity: **Small** (2 phases)

---

## Stage B: Implementation Phases

### Phase 1: Download Models
- **Goal**: Pre-download all required models to local cache
- **Method**: Use `docling-tools models download` CLI command
- **Expected Output**: Models in `~/.cache/docling/models/`
- **Quality Gate**: Directory exists with model files

```bash
# turbo
cd /home/palantir/hwpx && source .venv/bin/activate && docling-tools models download
```

---

### Phase 2: Configure Ingestor for Offline Mode
- **Goal**: Update `docling_ingestor.py` to use local artifacts
- **Change**:
```python
pipeline_options = PdfPipelineOptions(
    artifacts_path=os.path.expanduser("~/.cache/docling/models")
)
```
- **Quality Gate**: Pipeline runs without network access

---

## Stage C: Verification Plan

### Automated Tests
```bash
# Test offline mode
cd /home/palantir/hwpx && source .venv/bin/activate
python convert_pipeline.py sample.pdf --strategy docling --output test_offline.hwpx
```

### Success Criteria
- [ ] Models downloaded (>100MB in `~/.cache/docling/models`)
- [ ] Pipeline completes without timeout
- [ ] HWPX output generated with extracted content

---

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|:---|:---|:---|:---|
| Download failure (network) | Medium | High | Retry with `--force` flag |
| Disk space insufficient | Low | High | Check free space before download |
| Model version mismatch | Low | Medium | Pin docling version in requirements |

---

## Approval Required

- [ ] User approves Phase 1 execution (model download ~2GB)
