# MCP Tools Integration Plan

NPX/NPM 기반 MCP 도구들을 Gemini CLI 및 Orion ODA 워크스페이스에 통합하기 위한 구현 계획.

## User Review Required

> [!IMPORTANT]
> **API Keys 필요**: 다음 도구들은 외부 API 키가 필요합니다:
> - `tavily`: TAVILY_API_KEY (https://app.tavily.com에서 무료 발급)
> - `github`: GITHUB_PERSONAL_ACCESS_TOKEN (GitHub Settings → Developer Settings → Personal Access Tokens)

> [!WARNING]
> API 키들은 환경 변수로 설정되어야 하며, 코드에 직접 포함되지 않습니다.

---

## Proposed Changes

### MCP Servers to Integrate

| Server | NPM Package | Purpose | API Key Required |
|--------|------------|---------|------------------|
| **sequential-thinking** | `@modelcontextprotocol/server-sequential-thinking` | 복잡한 문제를 단계별로 분해하여 추론 | ❌ No |
| **context7** | `@upstash/context7-mcp` | 최신 라이브러리 문서를 AI 컨텍스트에 주입 | ❌ No |
| **github** | `@modelcontextprotocol/server-github` | GitHub 레포지토리, 이슈, PR 관리 | ✅ GITHUB_PERSONAL_ACCESS_TOKEN |
| **tavily** | `tavily-mcp` | AI 최적화 웹 검색 API | ✅ TAVILY_API_KEY |

---

### Component: MCP Configuration

#### [MODIFY] [mcp_config.json](file:///home/palantir/.gemini/antigravity/mcp_config.json)

```json
{
  "mcpServers": {
    "sequential-thinking": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"]
    },
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp@latest"]
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${GITHUB_PERSONAL_ACCESS_TOKEN}"
      }
    },
    "tavily": {
      "command": "npx",
      "args": ["-y", "tavily-mcp@latest"],
      "env": {
        "TAVILY_API_KEY": "${TAVILY_API_KEY}"
      }
    }
  }
}
```

---

### Component: Environment Setup

#### [MODIFY] [.bashrc](file:///home/palantir/park-kyungchan/palantir/.bashrc)

사용자 환경에 API 키 export 추가 (placeholder):

```bash
# MCP Tool API Keys (replace with actual values)
export TAVILY_API_KEY="your-tavily-api-key"
export GITHUB_PERSONAL_ACCESS_TOKEN="your-github-pat"
```

---

### Component: MCP Preflight Script

#### [MODIFY] [mcp_preflight.py](file:///home/palantir/park-kyungchan/palantir/scripts/mcp_preflight.py)

환경 변수 기반 서버 검증 로직 강화:
- API 키 환경 변수 존재 여부 체크
- npx 실행 가능 여부 체크

---

### Component: Governance Rules

#### [MODIFY] [GEMINI.md](file:///home/palantir/.gemini/GEMINI.md)

Rule #9 (Deep Audit Rigor)에서 참조하는 `search_web` → `tavily` MCP 도구와 연동 확인.
`sequential-thinking` → `task_boundary` 대체 또는 보완.

---

## Verification Plan

### Automated Tests

```bash
# 1. MCP Preflight 실행
cd /home/palantir/park-kyungchan/palantir
.venv/bin/python3 scripts/mcp_preflight.py --auto-disable-failed

# 2. 개별 서버 테스트 (npx 실행 확인)
npx -y @modelcontextprotocol/server-sequential-thinking --help
npx -y @upstash/context7-mcp@latest --help
```

### Manual Verification

1. Gemini CLI 재시작 후 MCP 도구 목록 확인
2. `context7` 도구로 React 문서 쿼리 테스트
3. `sequential-thinking` 도구로 복잡한 문제 분해 테스트
4. (API 키 설정 후) `tavily` 웹 검색 테스트
5. (API 키 설정 후) `github` 레포 접근 테스트

---

## Risk Assessment

| Risk Type | Probability | Impact | Mitigation |
|-----------|-------------|--------|------------|
| API Key Missing | Medium | High | Preflight에서 환경 변수 체크, 없으면 해당 서버 비활성화 |
| npx Timeout | Low | Medium | --prefer-offline 옵션 또는 로컬 설치 대안 제공 |
| Package Not Found | Low | Low | @latest 버전 명시로 안정성 확보 |

---

## Implementation Phases

### Phase 1: MCP Config Update (현재)
- [x] 웹 리서치로 패키지명 확인
- [ ] mcp_config.json 업데이트
- [ ] 기본 테스트

### Phase 2: Environment Setup
- [ ] .bashrc에 API 키 placeholder 추가
- [ ] 사용자에게 API 키 설정 안내

### Phase 3: Preflight Enhancement
- [ ] mcp_preflight.py 환경 변수 체크 추가
- [ ] 에러 메시지 개선

### Phase 4: Governance Integration
- [ ] GEMINI.md Rule #9 검증
- [ ] 워크플로우 연동 확인
