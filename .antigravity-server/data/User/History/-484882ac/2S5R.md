# Case Study: ODA Decomposition as Learning Curriculum

This case study documents the application of the **Palantir FDE Learning Protocol v2.0** to the **Orion ODA** codebase itself, illustrating the "Codebase-as-Curriculum" methodology.

## 1. Interaction Context
- **User Intent**: Deconstruct the Orion ODA starting from entry points for learning purposes without modifying code.
- **Workflow Triggered**: `/fde-learn`
- **Protocol Enforcement**: 7-Component Response Structure requirement activated.

## 2. Curriculum Mapping (ODA Entry Points)
The following files were identified as the primary "learning교보재" (teaching materials) based on the ODA Ontology:

### A. The "Brain" (System Architecture)
- **KB Reference**: `/home/palantir/coding/knowledge_bases/09_orion_system_architecture.md`
- **Concept**: Universal definition of Ontology-Driven Architecture (Schema as Law, Action Registry).

### B. The "Body" (Runtime Kernel)
- **Source File**: `scripts/runtime/kernel.py`
- **Key Item**: `OrionRuntime` class.
- **Learning Goal**: Understanding the V3 Semantic OS Kernel loop, `_process_task_cognitive` for LLM plan parsing, and `_process_approved_proposals`.

### C. The "Verbs" (Strategic Actions)
- **Source File**: `scripts/ontology/actions/__init__.py`
- **Key Item**: `ActionType`, `EditOperation`, and `SubmissionCriterion`.
- **Learning Goal**: Understanding how state mutations are gated and predefined as atomic actions rather than loose CRUD.

### D. The "Memory" (Persistence Layer)
- **Source File**: `scripts/ontology/storage/proposal_repository.py`
- **Key Item**: `ProposalRepository` using SQLAlchemy Async ORM.
- **Learning Goal**: Studying Optimistic Locking (`version` field) and Audit History tracking.

## 3. The 4-Layer Decomposition Model
Following the v2.0 protocol, the ODA was deconstructed into 4 distinct layers for pedagogical clarity:
1. **Layer 0: DOMAIN** (`ontology_types.py`) - "The Nouns"
2. **Layer 1: APPLICATION** (`actions/`) - "The Verbs"
3. **Layer 2: INFRASTRUCTURE** (`storage/`) - "The Persistence"
4. **Layer 3: RUNTIME** (`kernel.py`) - "The Engine"

Full pedagogical details are available in: `artifacts/curriculum/oda_codebase_curriculum.md`.

## 3. Pedagogical Alignment
By applying the 7-component structure to this request, the agent successfully:
1.  **Bridged Theory and Practice**: Linked `09_orion_system_architecture.md` (theory) directly to `kernel.py` (implementation).
2.  **Enforced Zero-Trust**: Visualized the ODA structure as a "governance layer" that students must first understand before being allowed to suggest changes.
3.  **Adaptive Next Steps**: Guided the user towards `scripts/consolidation.py` to explore how the system learns from its own execution history.

## 5. Case Study: Jan 2026 Refinement & Remediation Audit
The latest application of the protocol involved a **Deep-Dive Audit (v5.0)** of the refactored ODA workspace.

### A. Learning from "Code Smells"
The identification of **bare `except:` blocks** in `memory_actions.py` was used as a teaching moment for:
- **Error Handling Discipline**: The difference between "swallowing" exceptions and "handling" them with logging for auditability.
- **Transactional Integrity**: How silent failures in status parsing could lead to data corruption in the ontology.

### B. Palantir Pattern Alignment
The mapping of ODA components to Palantir Foundry standards (Action Types, Side Effects, Proposals) provided a "Production-Grade" baseline for the student.
- **Key Learning**: Distinguishing between fire-and-forget **Side Effects** (post-commit) and transactional **Writebacks** (pre-commit).

## 6. Conclusion
The v2.1 upgrade (Principal Architect role) enables the system to not only develop but also **remediate** its own technical debt through a structured audit protocol, providing a transparent and rigorous learning example for aspiring Palantir Engineers.
