# Native OWPML Generation & Template-Based Reconstruction

This document outlines the technical implementation of native HWPX (OWPML XML) generation, moving beyond win32com automation to a stable, Linux-native pipeline.

## 1. Architectural Evolution

The native OWPML pipeline evolved from manual XML assembly to **Template-Based Reconstruction (TBR)** to handle the extreme complexity of OWPML headers.

### 1.1 The ID-Reference Mechanism
OWPML uses an ID-Reference system. Formatting entities (Para Shapes, Char Shapes, Borders) are defined in `header.xml` and assigned integer IDs, which are then referenced in `section0.xml` (e.g., `paraPrIDRef="0"`).

## 2. Mandatory OWPML Structure (Anti-Corruption)

Hancom Office 2024 enforces strict validation of both ZIP structure and XML logic.

### 2.1 ZIP Package Integrity
- **Mimetype**: Must be the first file and uncompressed (`Stored`).
- **Required Root Files**: `version.xml` (version info), `settings.xml` (cursor state), `META-INF/manifest.xml`.
- **Logical Linkage**: `META-INF/container.rdf` is mandatory to associate ZIP parts with OWPML roles (`HeaderFile`, `SectionFile`).

### 2.2 Body Integrity (`section0.xml`)
- **Section Properties (`hp:secPr`)**: The first paragraph **MUST** contain `secPr` in its first run to define paper size/margins.
- **Layout Cache**: Paragraphs should include a skeletal `hp:linesegarray` for renderer stability.

## 3. Strategy: Template-Based Reconstruction (TBR)

Due to the 40KB+ complexity of `header.xml` (containing multi-language font definitions and nested property tags), the system uses a verified "Golden Template" (e.g., `Skeleton.hwpx`).

1.  **Template Reuse**: The generator copies all metadata, manifests, and complex header structures from the template.
2.  **Substitution**: Only `Contents/section0.xml` is replaced with dynamically generated OWPML Body XML.
3.  **Stability**: This approach guarantees 100% compatibility with Hancom 2024's strict rendering engine.

## 4. Alignment with Community 'Interpretive Standards'

The pipeline relies on **Interpretive Standards** (해석적 표준) derived from the `pyhwp` and `python-hwpx` communities. These standards provide the mapping logic necessary to translate complex, often proprietary HWP behaviors into interoperable OWPML structures.

For a detailed analysis, refer to [Community Standards Audit](../overview/community_standards_audit.md).
