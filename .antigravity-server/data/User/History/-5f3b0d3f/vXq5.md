# Implementation: Action Knowledge Base Parsing

To enable intelligent automation, the system parses the HWP Action Table PDF into a structured **Action Database**. This database provides the look-up table for HWP Action IDs and their associated ParameterSets.

## 1. Data Source
The primary source is `ActionTable_2504.pdf`, a reference manual provided by Hancom. It contains tables mapping "Action IDs" to internal "ParameterSet IDs" and descriptions.

### 1.1 Storage & Isolation
The resulting `ActionDatabase` is stored at `lib/knowledge/hwpx/action_db.json`. This isolation ensures that HWPX-specific control knowledge is decoupled from other document processing modules.


## 2. Parsing Logic (`ActionTableParser`)

The `ActionTableParser` (`lib/knowledge/parser.py`) consumes the "Digital Twin" JSON generated by the **LayoutTextIngestor**.

### 2.1 Fixed-Width Table Slicing
The parser processes blocks with `type="table"`. It identifies columns based on character offsets:
- **Action ID (0-24)**: The unique mnemonic (e.g., `AddHanjaWord`).
- **ParameterSet ID (24-44)**: The required parameter set (e.g., `FindReplace`).
- **Description (44+)**: Multi-line Korean text.

### 2.2 Row Merging Logic
To handle descriptions that wrap across multiple lines, the ingestor follows a "Presence of ID" rule:
1. **New Row**: If Column 1 (Action ID) is non-empty, a new record is initialized.
2. **Continuation**: If Column 1 is empty, the content in Column 3 is appended to the `description_ko` of the active record.

### 2.2 Symbol Resolution
The parser handles specific symbols found in the Action Table:
- `+`: Indicates that the action is functional and has a primary role.
- `-`: Indicates a secondary or internal action.
- `*`: Indicates that the ParameterSet is used indirectly or as a specialized subset.

### 2.3 Schema Mapping
Each row is transformed into an `ActionDefinition` Pydantic model:
```python
class ActionDefinition(BaseModel):
    action_id: str
    parameter_set_id: Optional[str]
    description_ko: str
    run_blocked: bool = False
```

## 3. Integration with Compiler
The resulting `ActionDatabase` (loaded from `lib/knowledge/hwpx/action_db.json`) is used by the `Compiler` to:
1. **Validate Intent**: Ensure a requested action exists in the HWP API.
2. **Retrieve Parameters**: Automatically determine which `ParameterSet` object needs to be instantiated on the Windows side.
3. **Generate OLE Code**: Map the mnemonic `ActionID` to the HWP `CreateAction` and `Execute` calls via the OLE bridge.

