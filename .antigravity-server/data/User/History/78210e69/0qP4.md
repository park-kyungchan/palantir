# HWPX Builder: Action-to-Automation Transpiler

## Overview
The HWPX Builder is the final stage of the conversion pipeline. It transforms a sequence of `HwpAction` objects into a standalone, executable Python script (`reconstruct.py`) designed for Windows-native execution via the `win32com` (OLE/COM) interface.

## 1. Architectural Strategy
Unlike the Compiler (which maps IR to semantic actions), the Builder maps semantic actions to **Control-Level API calls**. It follows a "Code Generator" pattern:
- **Input**: `List[HwpAction]` (from `lib.models`).
- **Process**: Dispatch and concatenation of Python code strings.
- **Output**: A `.py` script that can be executed on any Windows machine with Hancom Office 2024 installed.

## 2. Key Mapping Patterns

### 2.1 Standard Action Pattern (`GetDefault` -> `Execute`)
Most HWP API actions require initializing a parameter set, modifying it, and then executing the action.
```python
# InsertText Example
hwp.HAction.GetDefault('InsertText', hwp.HParameterSet.HInsertText.HSet)
hwp.HParameterSet.HInsertText.Text = 'Content'
hwp.HAction.Execute('InsertText', hwp.HParameterSet.HInsertText.HSet)
```

### 2.2 Property Mapping (Points vs HWPUNITS)
- **PointToSet**: Used for margins and fonts.
- **HWPUNITS**: Used for structural gaps (though the builder currently uses points where applicable).

### 2.3 Complex Containers (Tables)
`CreateTable` initializes the structural parameters (`Rows`, `Cols`, `WidthType`). Subsequent content insertion depends on the cursor remaining inside the table or using `MoveToCell` (V2).

## 3. Implementation Details (`lib/builder.py`)
- **Header Injection**: Includes `RegisterModule` for the mandatory `FilePathCheckDLL` (Security Module) to bypass local file access prompts.
- **Escaping**: Handles string escaping for Korean text and LaTeX scripts to prevent syntax errors in the generated Python script.
- **Image/Equation Handling**: Uses `hwp.InsertPicture` and specific `Equation` action sets for high-fidelity object insertion.

## 4. Verification
Verified via `scripts/verify_builder.py`, which:
1. Instantiates a suite of test actions (ParaShape, Table, Text).
2. Generates `test_reconstruct.py`.
3. Performs static analysis on the generated code to ensure presence of `ParagraphShape` and `TableCreate` logic.
