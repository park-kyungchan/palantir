---
description: Execute Progressive-Deep-Dive-Audit (Kernel v5.0 Protocol)
---
# /deep-audit: Full Context Injection Protocol

> **This workflow implements the complete Antigravity IDE Kernel v5.0 audit protocol.**
> **Replaces the need to paste the 150+ line prompt every time.**

---

## Phase 1: Zero-Trust Acknowledgment
- **Action**: Acknowledge CONTEXT_NULL state
- **Output**:
```
[STATE] CONTEXT_NULL â†’ Starting Progressive-Deep-Dive-Audit
[TARGET] {user-specified target or auto-detect from request}
```

---

## Phase 2: Stage A - Surface Scan (Landscape)
- **Action**: Scan target directory/file structure
- **Checks**:
  - [ ] AIP-KEY remnants (PROHIBITED per DC_02)
  - [ ] Subscription gate points (REQUIRED per DC_01)
  - [ ] Domain Invariant compliance (DIA.xml Sec 2.5)

```bash
# AIP-KEY Check
grep -rn "AIP[-_]KEY\|api[_-]key" {target} | grep -v ollama | head -20
```

---

## Phase 3: Stage B - Logic Trace (Deep-Dive)
- **Action**: Use `sequential-thinking` to trace data flow
- **Output Format**:
```
INPUT â†’ MIDDLEWARE â†’ CONTROLLER â†’ SERVICE â†’ DB
  â†“         â†“            â†“           â†“       â†“
[source] [validation] [handler] [logic] [persist]
```

---

## Phase 4: Stage C - Atomic Quality Audit (Microscope)
- **Action**: Line-by-line code quality check
- **Criteria**:
  - Complexity (cyclomatic)
  - Safety (null checks, error handling)
  - Naming conventions
  - SOLID principles
  - Clean Architecture layer violations

---

## Phase 5: Holistic Synthesis (Butterfly Effect)
- **Action**: Simulate impact of proposed changes
- **Output Format**:
```
[State A] â†’ [Mutation X] â†’ [Ripple Effect Y] â†’ [Verdict: SAFE/HIGH_RISK]
```

---

## Phase 6: Machine-Readable Audit Report

**Output this exact structure:**

```markdown
### ğŸ“  MACHINE-READABLE AUDIT REPORT (v5.0)

#### 1. DETAILED_ANALYSIS_LOG
* **Landscape_Scan:**
    * `AIP-KEY_Status`: [CLEAN/DETECTED]
    * `Subscription_Gate`: [VALID/INVALID]
* **Logic_Trace:**
    * `Critical_Path`: [Detailed Flow]
* **Quality_Audit_Findings:**
    * `[File:Line]` : [Severity] - [Issue]

#### 2. HOLISTIC_IMPACT_SIMULATION
* **Simulation_Target:** [Component]
* **Execution_Trace:**
    1. `Initial_State`: [Description]
    2. `Mutation`: [Proposed Change]
    3. `Ripple_Effect`: [Affected Modules]
* **Architectural_Verdict:** [SAFE/HIGH_RISK]

#### 3. XML_V2.2_COMPLIANCE_MATRIX
* `Domain_Invariants (Sec 2.5)`: [PASS/FAIL]
* `Layer_Architecture (Sec 3.5)`: [PASS/FAIL]

#### 4. STATUS_CONFIRMATION
* `Current_State`: **[CONTEXT_INJECTED]**
* `Ready_to_Execute`: **TRUE/FALSE**
```

---

## Phase 7: System Halt & User Approval
- **Action**: Output Korean notification and WAIT
- **Output**:
```
ì‚¬ìš©ìë‹˜, **Code-Level-Context-Injected** ìƒíƒœì— ë„ë‹¬í•˜ê¸° ìœ„í•´
**Deep-Dive Audit**ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

ìƒì„¸ ë‚´ìš©ì€ ìœ„ **Machine-Readable Report**ë¥¼ ì°¸ì¡°í•´ì£¼ì‹­ì‹œì˜¤.

[WAIT] - ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
```

---

## Usage Examples

**Full audit on specific target:**
```
/deep-audit scripts/ontology/actions/__init__.py
```

**Audit before feature implementation:**
```
/deep-audit
Target: scripts/runtime/
Request: Add new Kernel hook for pre-execution validation
```

**Quick audit (auto-detect from context):**
```
/deep-audit
[í˜„ì¬ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ì—ì„œ ëŒ€ìƒ ìë™ ê°ì§€]
```
