[
{
  "id": "1",
  "subject": "[PERMANENT] Skill Optimization v9.0 — All Skills Deep Redesign",
  "description": "## [PERMANENT] — PT-v2\n\n### User Intent\nDeep redesign of 9 pipeline/utility skills + related agent files for precise alignment with INFRA v9.0 Agent Teams architecture. Introduces context:fork isolation for Lead-only skills.\n\nKey goals:\n- 9 SKILL.md files restructured into 2 template variants (coordinator-based + fork-based)\n- 8 coordinator agent .md files converged to Template B (768→402L, -48%)\n- 3 new fork-context agent .md files created (pt-manager, delivery-agent, rsil-agent)\n- 4 Lead-only skills converted to context:fork execution\n- PT-centric interface: GC 14→3 sections (9 eliminate, 2 migrate, 3 keep scratch)\n- CLAUDE.md §10 modified: 3-layer enforcement for fork agent Task API exception\n- CC features adopted ($ARGUMENTS, Dynamic Context, context:fork, agent: field)\n- All CLAUDE.md/reference duplication removed from skills (1-line references only)\n- New Interface Section (§C) added to all 9 skills\n\n### Codebase Impact Map\n- Module Dependencies:\n  - SKILL.md (9 files) → agent .md (8 coordinators + 3 new fork) → CLAUDE.md §10\n  - Skills reference: agent-common-protocol.md, coordinator-shared-protocol.md, gate-evaluation-standard.md\n  - PT-centric interface: all skills read/write PT via TaskGet/TaskUpdate (replaces GC state bus)\n  - context:fork: 4 skills → 3 new agent .md → CLAUDE.md §10 exception rule\n  - Coordinator convergence: 8 coordinator .md → coordinator-shared-protocol.md (shared) + unique logic (inline)\n  - L2 Downstream Handoff chain: brainstorming→write-plan→validation→execution→verification→delivery\n- Ripple Paths:\n  - Change PT interface → affects all 9 skills simultaneously (Big Bang)\n  - Change coordinator agent .md → affects skill Directive Section templates\n  - Add context:fork → requires CLAUDE.md rule change + new agent files + agent-common-protocol.md §Task API\n  - Remove GC versioning → skill Interface Section rewired to PT + L2 handoff\n  - Template B convergence → 8 coordinator .md simultaneously (-366L total)\n- Interface Boundaries:\n  - Skill ↔ Agent .md: subagent_type exact match, frontmatter tools list\n  - Skill ↔ PT: TaskGet/TaskUpdate for state, l2_path pointers for predecessor discovery\n  - Fork Skill ↔ Lead: context:fork return value, $ARGUMENTS input, Dynamic Context pre-render\n  - Skill ↔ CLAUDE.md: 1-line cross-cutting references (§6, §9, §10)\n  - Coordinator ↔ Protocol: 2-line references replace ~175L inlined protocol per coordinator\n- Risk Hotspots:\n  - permanent-tasks fork + Task API (CLAUDE.md §10 rule change required)\n  - Big Bang 22+ file change (syntax error in any skill blocks all)\n  - Coordinator agent .md changes (8 files, affects all coordinated phases)\n  - Task list scope in fork context (RISK-8: C-4 contract dependency)\n  - Fork agent spawning from fork (OQ-1: 85% confidence, rsil-agent)\n\n### Architecture Decisions\n\n**Phase 1 — Discovery (11 decisions):**\n| # | Decision | Rationale |\n|---|----------|-----------|\n| D-1 | Exclude palantir-dev (9 skills) | Non-pipeline skill |\n| D-2 | All Deep Redesign | INFRA alignment, README.md = ground truth |\n| D-3 | A+B only (Spawn + Prompt) | Lead Orchestration Define |\n| D-4 | No compression target | YAGNI only |\n| D-5 | Common 1x CC research | Shared spawn mechanism |\n| D-6 | Precision Refocus (4-section) | Spawn+Directive+Interface+Cross-Cutting |\n| D-7 | PT-centric interface | GC → session scratch |\n| D-8 | Big Bang (simultaneous) | Interface consistency |\n| D-9 | 4 skills → context:fork | delivery, rsil-global, rsil-review, permanent-tasks |\n| D-10 | CLAUDE.md §10 modification | Fork agent Task API allowed |\n| D-11 | 3 new fork agent .md files | delivery-agent, rsil-agent, pt-manager |\n\n**Phase 2 — Research (4 decisions):**\n| # | Decision | Rationale |\n|---|----------|-----------|\n| D-12 | Task API frontmatter-enforced | Not platform-level, NL modification only |\n| D-13 | Template B convergence (lean) | Protocol-referencing coordinator .md |\n| D-14 | GC 14→3 reduction | 9 eliminate (→L2 Handoff) + 2 migrate (→PT) + 3 keep (scratch) |\n| D-15 | Custom agents in fork FEASIBLE | CC research confirmed agent: field support |\n\n**Phase 3 — Architecture (15 decisions):**\n\nStructural (8 ADRs):\n- ADR-S1: 2 template variants (coordinator-based + fork-based)\n- ADR-S2: Template B convergence with execution-coordinator extended (45L unique)\n- ADR-S3: memory: project for all 8 coordinators\n- ADR-S4: Skills preload DEFERRED (token cost unfavorable)\n- ADR-S5: Shared rsil-agent for both RSIL skills\n- ADR-S6: Interface Section (§C) NEW for all 9 skills\n- ADR-S7: Phase 0 PT Check stays in fork skills\n- ADR-S8: Cross-Cutting inline for fork (no CLAUDE.md 1-liners in fork context)\n\nInterface (5 contracts):\n- C-1: PT Read/Write (N:1, all skills share one PT)\n- C-2: L2 Downstream Handoff chain (replaces 9 GC sections)\n- C-3: GC scratch-only (3 concerns: metrics, gate records, version)\n- C-4: Fork-to-PT Direct (TaskGet/TaskUpdate, depends on RISK-8)\n- C-5: §10 Exception (3 named agents, 3-layer enforcement)\n\nRisk resolutions:\n- CLC-1: SendMessage removed from pt-manager (RISK-9 eliminated)\n- OQ-1: Fork spawning YES (85%, pre-deploy validation required)\n- OQ-2: 2 variants confirmed (content varies, not structure)\n- OQ-3: GC elimination in v9.0 (Big Bang = atomic interface change)\n\nFull architecture detail: `.agent/teams/skill-opt-v9/phase-3/arch-coord/L2-summary.md`\n\n### Phase Status\n| Phase | Status | Notes |\n|-------|--------|-------|\n| P0 | COMPLETE | PT created at Gate 1 |\n| P1 | COMPLETE | Gate 1 APPROVED, 11 decisions |\n| P2 | COMPLETE | Gate 2 APPROVED, 117 evidence, 4 decisions (D-12~D-15). L2: `.agent/teams/skill-opt-v9/phase-2/research-coord/L2-summary.md` |\n| P3 | COMPLETE | Gate 3 APPROVED (Lead + auditor 7/7 PASS), 149 evidence, 15 decisions. L2: `.agent/teams/skill-opt-v9/phase-3/arch-coord/L2-summary.md` |\n| P4 | IN_PROGRESS | Detailed Design — planning-coordinator route |\n| P5-P9 | PENDING | — |\n\n### Constraints\n- Pipeline Tier: COMPLEX (22+ files, 3+ modules)\n- palantir-dev excluded\n- 35 worker agent .md files NOT in scope (coordinators only)\n- Reference docs (.claude/references/*.md) NOT in scope\n- Hooks, settings NOT in scope\n- YAGNI: no features beyond current needs\n- Big Bang: all changes simultaneous for interface consistency\n- BUG-001: always mode: \"default\" for spawns\n- Per-skill delta: 61-75% unique, ~18% template, 15-20% new (Interface Section)\n- Pre-deploy validation sequence: A→B→C→D (CRITICAL before production commit)\n\n### Active Risks\n| ID | Severity | Likelihood | Risk | Mitigation |\n|----|----------|------------|------|------------|\n| RISK-2 | MED-HIGH | CERTAIN | PT fork loses conversation history | 3-layer: pipeline/rich/interactive |\n| RISK-3 | MEDIUM | HIGH | Delivery fork complexity | No nested skills, idempotent, fork last |\n| RISK-5 | HIGH | MEDIUM | Big Bang 22+ files | YAML validation, atomic commit, rollback |\n| RISK-8 | MEDIUM | MEDIUM | Task list scope in fork | Pre-deploy validation + $ARGUMENTS fallback |\n\n### Architecture Summary (Pointer)\n2 template variants, PT-centric interface (GC 14→3), 3 fork agents, coordinator convergence (768→402L, -48%), CLAUDE.md §10 modification, per-skill 61-75% unique.\nFull design: `.agent/teams/skill-opt-v9/phase-3/` (arch-coord L2 + 3 architect L3s)",
  "activeForm": "Managing PERMANENT Task",
  "status": "pending",
  "blocks": [],
  "blockedBy": []
}]
