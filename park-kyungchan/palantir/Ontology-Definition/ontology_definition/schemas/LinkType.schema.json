{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://oda.palantir.local/schemas/LinkType.schema.json",
  "title": "LinkType Definition Schema",
  "description": "Palantir Foundry-aligned LinkType definition for ODA system. A LinkType is the schema definition of a relationship between two object types.",
  "type": "object",
  "properties": {
    "apiName": {
      "type": "string",
      "description": "Programmatic identifier (immutable once Active). No spaces or special characters.",
      "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["EmployeeToDepartment", "AircraftToFlight", "OrderToLineItem"]
    },
    "displayName": {
      "type": "string",
      "description": "Human-friendly UI name for this relationship.",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["Employee to Department", "Aircraft to Flight"]
    },
    "description": {
      "type": "string",
      "description": "Documentation describing the relationship semantics.",
      "maxLength": 4096
    },
    "rid": {
      "type": "string",
      "description": "Resource ID - global unique identifier. Auto-generated by system.",
      "pattern": "^ri\\.ontology\\.[a-z]+\\.link-type\\.[a-zA-Z0-9-]+$",
      "readOnly": true
    },
    "sourceObjectType": {
      "$ref": "#/$defs/ObjectTypeReference",
      "description": "ObjectType on the 'from' side of the relationship."
    },
    "targetObjectType": {
      "$ref": "#/$defs/ObjectTypeReference",
      "description": "ObjectType on the 'to' side of the relationship."
    },
    "cardinality": {
      "$ref": "#/$defs/Cardinality",
      "description": "Relationship cardinality defining how many instances can be linked."
    },
    "implementation": {
      "$ref": "#/$defs/LinkImplementation",
      "description": "How the link is physically stored (foreign key or backing table)."
    },
    "bidirectional": {
      "type": "boolean",
      "description": "If true, link can be navigated from both source and target.",
      "default": true
    },
    "reverseApiName": {
      "type": "string",
      "description": "apiName for the reverse direction navigation (target to source).",
      "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
    },
    "reverseDisplayName": {
      "type": "string",
      "description": "Display name for reverse direction."
    },
    "cascadePolicy": {
      "$ref": "#/$defs/CascadePolicy",
      "description": "Behavior when linked objects are deleted."
    },
    "linkProperties": {
      "type": "array",
      "description": "Properties on the link itself (for N:N with backing table).",
      "items": {
        "$ref": "#/$defs/LinkPropertyDefinition"
      },
      "default": []
    },
    "status": {
      "$ref": "#/$defs/LinkTypeStatus",
      "description": "Lifecycle status of the LinkType.",
      "default": "EXPERIMENTAL"
    },
    "linkMerging": {
      "$ref": "#/$defs/LinkMergingConfig",
      "description": "Configuration for merging duplicate links from multiple sources."
    },
    "securityConfig": {
      "$ref": "#/$defs/LinkSecurityConfig",
      "description": "Security configuration for link visibility and access."
    },
    "metadata": {
      "$ref": "#/$defs/LinkTypeMetadata",
      "description": "Auxiliary tracking information."
    }
  },
  "required": ["apiName", "displayName", "sourceObjectType", "targetObjectType", "cardinality", "implementation"],
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "cardinality": {
            "properties": {
              "type": { "const": "MANY_TO_MANY" }
            }
          }
        }
      },
      "then": {
        "properties": {
          "implementation": {
            "properties": {
              "type": { "const": "BACKING_TABLE" }
            },
            "required": ["backingTable"]
          }
        }
      }
    }
  ],
  "$defs": {
    "ObjectTypeReference": {
      "type": "object",
      "description": "Reference to an ObjectType participating in the link.",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "apiName of the referenced ObjectType."
        },
        "rid": {
          "type": "string",
          "description": "RID of the referenced ObjectType (optional, for external references)."
        }
      },
      "required": ["apiName"],
      "additionalProperties": false
    },
    "Cardinality": {
      "type": "object",
      "description": "Cardinality specification for the relationship.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Cardinality type.",
          "enum": ["ONE_TO_ONE", "ONE_TO_MANY", "MANY_TO_ONE", "MANY_TO_MANY"]
        },
        "sourceMin": {
          "type": "integer",
          "description": "Minimum links from source (0 = optional, 1 = required).",
          "minimum": 0,
          "default": 0
        },
        "sourceMax": {
          "type": ["integer", "string"],
          "description": "Maximum links from source. Use 'N' or -1 for unlimited.",
          "default": "N"
        },
        "targetMin": {
          "type": "integer",
          "description": "Minimum links to target (0 = optional, 1 = required).",
          "minimum": 0,
          "default": 0
        },
        "targetMax": {
          "type": ["integer", "string"],
          "description": "Maximum links to target. Use 'N' or -1 for unlimited.",
          "default": "N"
        },
        "enforced": {
          "type": "boolean",
          "description": "If true, cardinality constraints are strictly enforced. Note: ONE_TO_ONE is indicator only in Palantir Foundry.",
          "default": false
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "LinkImplementation": {
      "type": "object",
      "description": "Physical implementation of the link storage.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Implementation type.",
          "enum": ["FOREIGN_KEY", "BACKING_TABLE"]
        },
        "foreignKey": {
          "$ref": "#/$defs/ForeignKeyConfig",
          "description": "For FOREIGN_KEY type, the FK configuration."
        },
        "backingTable": {
          "$ref": "#/$defs/BackingTableConfig",
          "description": "For BACKING_TABLE type (required for MANY_TO_MANY), the junction table config."
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "ForeignKeyConfig": {
      "type": "object",
      "description": "Foreign key implementation for 1:1, 1:N, N:1 relationships.",
      "properties": {
        "foreignKeyProperty": {
          "type": "string",
          "description": "Property apiName on one ObjectType that references another's primary key."
        },
        "foreignKeyLocation": {
          "type": "string",
          "description": "Which side holds the foreign key.",
          "enum": ["SOURCE", "TARGET"]
        },
        "referencedProperty": {
          "type": "string",
          "description": "Property apiName being referenced (usually primary key)."
        }
      },
      "required": ["foreignKeyProperty", "foreignKeyLocation"],
      "additionalProperties": false
    },
    "BackingTableConfig": {
      "type": "object",
      "description": "Junction/bridge table implementation for MANY_TO_MANY relationships.",
      "properties": {
        "datasetRid": {
          "type": "string",
          "description": "RID of the backing Foundry Dataset (junction table).",
          "pattern": "^ri\\.foundry\\.[a-z]+\\.dataset\\.[a-zA-Z0-9-]+$"
        },
        "sourceKeyColumn": {
          "type": "string",
          "description": "Column name in backing table containing source object's primary key."
        },
        "targetKeyColumn": {
          "type": "string",
          "description": "Column name in backing table containing target object's primary key."
        },
        "additionalColumns": {
          "type": "array",
          "description": "Additional columns for link properties.",
          "items": {
            "type": "object",
            "properties": {
              "columnName": { "type": "string" },
              "propertyApiName": { "type": "string" }
            },
            "required": ["columnName", "propertyApiName"]
          }
        }
      },
      "required": ["sourceKeyColumn", "targetKeyColumn"],
      "additionalProperties": false
    },
    "CascadePolicy": {
      "type": "object",
      "description": "Referential integrity behavior when linked objects are modified or deleted.",
      "properties": {
        "onSourceDelete": {
          "type": "string",
          "description": "Action when source object is deleted.",
          "enum": ["RESTRICT", "CASCADE", "SET_NULL", "SET_DEFAULT", "NO_ACTION"],
          "default": "CASCADE"
        },
        "onTargetDelete": {
          "type": "string",
          "description": "Action when target object is deleted.",
          "enum": ["RESTRICT", "CASCADE", "SET_NULL", "SET_DEFAULT", "NO_ACTION"],
          "default": "CASCADE"
        },
        "onSourceUpdate": {
          "type": "string",
          "description": "Action when source object's primary key is updated.",
          "enum": ["RESTRICT", "CASCADE", "SET_NULL", "SET_DEFAULT", "NO_ACTION"],
          "default": "CASCADE"
        },
        "onTargetUpdate": {
          "type": "string",
          "description": "Action when target object's primary key is updated.",
          "enum": ["RESTRICT", "CASCADE", "SET_NULL", "SET_DEFAULT", "NO_ACTION"],
          "default": "CASCADE"
        }
      },
      "additionalProperties": false
    },
    "LinkPropertyDefinition": {
      "type": "object",
      "description": "Property definition on the link itself (for N:N relationships with backing table).",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "Unique identifier for this link property.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly name."
        },
        "dataType": {
          "type": "string",
          "description": "Data type for this property.",
          "enum": ["STRING", "INTEGER", "LONG", "FLOAT", "DOUBLE", "BOOLEAN", "DATE", "TIMESTAMP"]
        },
        "backingColumn": {
          "type": "string",
          "description": "Column name in backing table."
        },
        "required": {
          "type": "boolean",
          "default": false
        }
      },
      "required": ["apiName", "displayName", "dataType"],
      "additionalProperties": false
    },
    "LinkTypeStatus": {
      "type": "string",
      "description": "Lifecycle status of the LinkType. Note: Endorsed status NOT supported for LinkType.",
      "enum": [
        "DRAFT",
        "EXPERIMENTAL",
        "ALPHA",
        "BETA",
        "ACTIVE",
        "STABLE",
        "DEPRECATED",
        "SUNSET",
        "ARCHIVED",
        "DELETED"
      ],
      "default": "EXPERIMENTAL"
    },
    "LinkMergingConfig": {
      "type": "object",
      "description": "Configuration for merging duplicate links from multiple data sources.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "If true, duplicate links are merged.",
          "default": false
        },
        "strategy": {
          "type": "string",
          "description": "Merge strategy for conflicting link properties.",
          "enum": ["FIRST_WINS", "LAST_WINS", "PRIORITY_BASED"],
          "default": "FIRST_WINS"
        },
        "priorityField": {
          "type": "string",
          "description": "For PRIORITY_BASED, the field to determine priority."
        }
      },
      "additionalProperties": false
    },
    "LinkSecurityConfig": {
      "type": "object",
      "description": "Security configuration for link access control.",
      "properties": {
        "inheritSourceSecurity": {
          "type": "boolean",
          "description": "If true, link visibility inherits from source object security.",
          "default": true
        },
        "inheritTargetSecurity": {
          "type": "boolean",
          "description": "If true, link visibility inherits from target object security.",
          "default": false
        },
        "requireBothVisible": {
          "type": "boolean",
          "description": "If true, both source and target must be visible to see the link.",
          "default": false
        },
        "linkPropertySecurity": {
          "type": "array",
          "description": "Security policies for individual link properties.",
          "items": {
            "type": "object",
            "properties": {
              "propertyApiName": { "type": "string" },
              "accessLevel": {
                "type": "string",
                "enum": ["FULL", "READ_ONLY", "MASKED", "HIDDEN"]
              }
            },
            "required": ["propertyApiName", "accessLevel"]
          }
        }
      },
      "additionalProperties": false
    },
    "LinkTypeMetadata": {
      "type": "object",
      "description": "Auxiliary tracking information for the LinkType.",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "readOnly": true
        },
        "createdBy": {
          "type": "string",
          "readOnly": true
        },
        "modifiedAt": {
          "type": "string",
          "format": "date-time",
          "readOnly": true
        },
        "modifiedBy": {
          "type": "string",
          "readOnly": true
        },
        "version": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "readOnly": true
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "apiName": "EmployeeToDepartment",
      "displayName": "Employee to Department",
      "description": "Links employees to their assigned department.",
      "sourceObjectType": { "apiName": "Employee" },
      "targetObjectType": { "apiName": "Department" },
      "cardinality": {
        "type": "MANY_TO_ONE",
        "sourceMin": 0,
        "sourceMax": 1,
        "targetMin": 0,
        "targetMax": "N"
      },
      "implementation": {
        "type": "FOREIGN_KEY",
        "foreignKey": {
          "foreignKeyProperty": "departmentId",
          "foreignKeyLocation": "SOURCE",
          "referencedProperty": "departmentId"
        }
      },
      "bidirectional": true,
      "reverseApiName": "DepartmentToEmployees",
      "reverseDisplayName": "Department to Employees",
      "cascadePolicy": {
        "onSourceDelete": "CASCADE",
        "onTargetDelete": "SET_NULL"
      },
      "status": "ACTIVE",
      "metadata": {
        "createdAt": "2026-01-17T10:00:00Z",
        "createdBy": "admin",
        "version": 1,
        "tags": ["org-structure"]
      }
    },
    {
      "apiName": "ProjectToTeamMember",
      "displayName": "Project to Team Member",
      "description": "Many-to-many relationship between projects and team members with role assignment.",
      "sourceObjectType": { "apiName": "Project" },
      "targetObjectType": { "apiName": "TeamMember" },
      "cardinality": {
        "type": "MANY_TO_MANY",
        "sourceMin": 0,
        "sourceMax": "N",
        "targetMin": 0,
        "targetMax": "N"
      },
      "implementation": {
        "type": "BACKING_TABLE",
        "backingTable": {
          "datasetRid": "ri.foundry.main.dataset.project-team-junction",
          "sourceKeyColumn": "project_id",
          "targetKeyColumn": "member_id",
          "additionalColumns": [
            { "columnName": "role", "propertyApiName": "assignedRole" },
            { "columnName": "joined_at", "propertyApiName": "joinedAt" }
          ]
        }
      },
      "linkProperties": [
        {
          "apiName": "assignedRole",
          "displayName": "Assigned Role",
          "dataType": "STRING",
          "backingColumn": "role",
          "required": true
        },
        {
          "apiName": "joinedAt",
          "displayName": "Joined At",
          "dataType": "TIMESTAMP",
          "backingColumn": "joined_at",
          "required": false
        }
      ],
      "bidirectional": true,
      "reverseApiName": "TeamMemberToProjects",
      "reverseDisplayName": "Team Member to Projects",
      "status": "ACTIVE"
    }
  ]
}
