{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://oda.palantir.local/schemas/ObjectType.schema.json",
  "title": "ObjectType Definition Schema",
  "description": "Palantir Foundry-aligned ObjectType definition for ODA system. An ObjectType is the schema definition of a real-world entity or event.",
  "type": "object",
  "properties": {
    "apiName": {
      "type": "string",
      "description": "Programmatic identifier (immutable once Active status). No spaces or special characters allowed.",
      "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["Employee", "Aircraft", "FlightLog"]
    },
    "displayName": {
      "type": "string",
      "description": "Human-friendly UI name. Allows spaces and uppercase. Mutable at any time.",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["Employee", "Aircraft", "Flight Log"]
    },
    "description": {
      "type": "string",
      "description": "Documentation describing the ObjectType's purpose and domain context.",
      "maxLength": 4096
    },
    "rid": {
      "type": "string",
      "description": "Resource ID - global unique identifier. Auto-generated by system.",
      "pattern": "^ri\\.ontology\\.[a-z]+\\.object-type\\.[a-zA-Z0-9-]+$",
      "readOnly": true,
      "examples": ["ri.ontology.main.object-type.Employee"]
    },
    "primaryKey": {
      "$ref": "#/$defs/PrimaryKeyDefinition",
      "description": "Property that uniquely identifies each Object instance. REQUIRED for all ObjectTypes."
    },
    "properties": {
      "type": "array",
      "description": "List of Property definitions for this ObjectType.",
      "items": {
        "$ref": "#/$defs/PropertyReference"
      },
      "minItems": 1
    },
    "status": {
      "$ref": "#/$defs/ObjectTypeStatus",
      "description": "Lifecycle status of the ObjectType.",
      "default": "EXPERIMENTAL"
    },
    "endorsed": {
      "type": "boolean",
      "description": "Mark as trustworthy ObjectType. Can only be set by Ontology Owner.",
      "default": false
    },
    "interfaces": {
      "type": "array",
      "description": "Interfaces this ObjectType implements (polymorphism support).",
      "items": {
        "type": "string",
        "description": "apiName of the Interface"
      },
      "default": []
    },
    "backingDataset": {
      "$ref": "#/$defs/BackingDatasetConfig",
      "description": "Foundry Dataset where Object data is stored."
    },
    "securityConfig": {
      "$ref": "#/$defs/SecurityConfig",
      "description": "Security configuration including mandatory control properties and row-level filtering."
    },
    "metadata": {
      "$ref": "#/$defs/ObjectTypeMetadata",
      "description": "Auxiliary information and tracking."
    }
  },
  "required": ["apiName", "displayName", "primaryKey", "properties"],
  "additionalProperties": false,
  "$defs": {
    "PrimaryKeyDefinition": {
      "type": "object",
      "description": "Primary key configuration for uniquely identifying Object instances.",
      "properties": {
        "propertyApiName": {
          "type": "string",
          "description": "apiName of the property used as primary key."
        },
        "backingColumn": {
          "type": "string",
          "description": "Column name in backing dataset that maps to this key."
        }
      },
      "required": ["propertyApiName"],
      "additionalProperties": false
    },
    "PropertyReference": {
      "type": "object",
      "description": "Reference to a Property definition within this ObjectType.",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "Unique identifier within this ObjectType.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly name for UI display."
        },
        "description": {
          "type": "string",
          "description": "Documentation for this property."
        },
        "dataType": {
          "$ref": "#/$defs/DataType",
          "description": "Base type or ValueType for this property."
        },
        "constraints": {
          "$ref": "#/$defs/PropertyConstraints",
          "description": "Validation rules for this property."
        },
        "backingColumn": {
          "type": "string",
          "description": "Column name in backing dataset. Null for edit-only properties."
        },
        "isEditOnly": {
          "type": "boolean",
          "description": "If true, not populated from dataset, only via user edits.",
          "default": false
        },
        "isMandatoryControl": {
          "type": "boolean",
          "description": "If true, this is a security marking property for row-level access control. Must be required and cannot have default value.",
          "default": false
        },
        "isDerived": {
          "type": "boolean",
          "description": "If true, computed in real-time by function/expression.",
          "default": false
        },
        "derivedExpression": {
          "type": "string",
          "description": "Expression or function reference for derived properties."
        },
        "sharedPropertyRef": {
          "type": "string",
          "description": "Reference to a SharedProperty definition if this uses shared schema."
        }
      },
      "required": ["apiName", "displayName", "dataType"],
      "additionalProperties": false
    },
    "DataType": {
      "type": "object",
      "description": "Data type specification for a property.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Base type identifier.",
          "enum": [
            "STRING",
            "INTEGER",
            "LONG",
            "FLOAT",
            "DOUBLE",
            "BOOLEAN",
            "DATE",
            "TIMESTAMP",
            "DATETIME",
            "ARRAY",
            "STRUCT",
            "GEOPOINT",
            "GEOSHAPE",
            "TIMESERIES",
            "MEDIA_REFERENCE",
            "VECTOR",
            "JSON",
            "MARKDOWN",
            "BINARY",
            "DECIMAL"
          ]
        },
        "arrayItemType": {
          "$ref": "#/$defs/DataType",
          "description": "For ARRAY type, the type of array elements."
        },
        "structFields": {
          "type": "array",
          "description": "For STRUCT type, the field definitions.",
          "items": {
            "$ref": "#/$defs/StructField"
          }
        },
        "valueTypeRef": {
          "type": "string",
          "description": "Reference to a custom ValueType definition."
        },
        "precision": {
          "type": "integer",
          "description": "For DECIMAL type, total number of digits.",
          "minimum": 1,
          "maximum": 38
        },
        "scale": {
          "type": "integer",
          "description": "For DECIMAL type, digits after decimal point.",
          "minimum": 0,
          "maximum": 38
        },
        "vectorDimension": {
          "type": "integer",
          "description": "For VECTOR type, the dimension size.",
          "minimum": 1
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "StructField": {
      "type": "object",
      "description": "Field definition within a STRUCT type.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Field name within the struct."
        },
        "type": {
          "$ref": "#/$defs/DataType"
        },
        "required": {
          "type": "boolean",
          "default": false
        }
      },
      "required": ["name", "type"],
      "additionalProperties": false
    },
    "PropertyConstraints": {
      "type": "object",
      "description": "Validation constraints for a property.",
      "properties": {
        "required": {
          "type": "boolean",
          "description": "If true, property cannot be null/empty.",
          "default": false
        },
        "unique": {
          "type": "boolean",
          "description": "If true, value must be unique across all instances.",
          "default": false
        },
        "immutable": {
          "type": "boolean",
          "description": "If true, value cannot be changed after initial set.",
          "default": false
        },
        "enum": {
          "type": "array",
          "description": "Allowed values for this property.",
          "items": {
            "type": ["string", "number", "boolean"]
          }
        },
        "minValue": {
          "type": "number",
          "description": "Minimum numeric value (inclusive)."
        },
        "maxValue": {
          "type": "number",
          "description": "Maximum numeric value (inclusive)."
        },
        "minLength": {
          "type": "integer",
          "description": "Minimum string length.",
          "minimum": 0
        },
        "maxLength": {
          "type": "integer",
          "description": "Maximum string length.",
          "minimum": 0
        },
        "pattern": {
          "type": "string",
          "description": "Regex pattern for string validation.",
          "format": "regex"
        },
        "ridFormat": {
          "type": "boolean",
          "description": "If true, must be valid RID format.",
          "default": false
        },
        "uuidFormat": {
          "type": "boolean",
          "description": "If true, must be valid UUID format.",
          "default": false
        },
        "arrayUnique": {
          "type": "boolean",
          "description": "For ARRAY type, if true, elements must be unique.",
          "default": false
        },
        "arrayMinItems": {
          "type": "integer",
          "description": "For ARRAY type, minimum number of items.",
          "minimum": 0
        },
        "arrayMaxItems": {
          "type": "integer",
          "description": "For ARRAY type, maximum number of items.",
          "minimum": 0
        },
        "customValidator": {
          "type": "string",
          "description": "Reference to custom validation function."
        },
        "defaultValue": {
          "description": "Default value if not provided. Cannot be set if isMandatoryControl is true."
        }
      },
      "additionalProperties": false
    },
    "ObjectTypeStatus": {
      "type": "string",
      "description": "Lifecycle status of the ObjectType.",
      "enum": [
        "DRAFT",
        "EXPERIMENTAL",
        "ALPHA",
        "BETA",
        "ACTIVE",
        "STABLE",
        "DEPRECATED",
        "SUNSET",
        "ARCHIVED",
        "DELETED"
      ],
      "default": "EXPERIMENTAL"
    },
    "BackingDatasetConfig": {
      "type": "object",
      "description": "Configuration for the Foundry Dataset backing this ObjectType.",
      "properties": {
        "datasetRid": {
          "type": "string",
          "description": "RID of the backing Foundry Dataset.",
          "pattern": "^ri\\.foundry\\.[a-z]+\\.dataset\\.[a-zA-Z0-9-]+$"
        },
        "mode": {
          "type": "string",
          "description": "Datasource mode - SINGLE for one dataset, MULTI for MDO (Multi-Dataset Objects).",
          "enum": ["SINGLE", "MULTI"],
          "default": "SINGLE"
        },
        "additionalDatasets": {
          "type": "array",
          "description": "For MULTI mode, additional dataset RIDs.",
          "items": {
            "type": "string"
          }
        },
        "restrictedViewRid": {
          "type": "string",
          "description": "RID of Restricted View for row-level security filtering.",
          "pattern": "^ri\\.foundry\\.[a-z]+\\.restricted-view\\.[a-zA-Z0-9-]+$"
        }
      },
      "additionalProperties": false
    },
    "SecurityConfig": {
      "type": "object",
      "description": "Security configuration for the ObjectType.",
      "properties": {
        "mandatoryControlProperties": {
          "type": "array",
          "description": "Properties designated as mandatory control for row-level access.",
          "items": {
            "$ref": "#/$defs/MandatoryControlConfig"
          }
        },
        "objectSecurityPolicy": {
          "$ref": "#/$defs/ObjectSecurityPolicy"
        },
        "propertySecurityPolicies": {
          "type": "array",
          "description": "Per-property security policies.",
          "items": {
            "$ref": "#/$defs/PropertySecurityPolicy"
          }
        }
      },
      "additionalProperties": false
    },
    "MandatoryControlConfig": {
      "type": "object",
      "description": "Configuration for a mandatory control property (Palantir P1-CRITICAL requirement).",
      "properties": {
        "propertyApiName": {
          "type": "string",
          "description": "apiName of the mandatory control property."
        },
        "controlType": {
          "type": "string",
          "description": "Type of mandatory control.",
          "enum": ["MARKINGS", "ORGANIZATIONS", "CLASSIFICATIONS"]
        },
        "markingColumnMapping": {
          "type": "string",
          "description": "Column in backing Restricted View containing marking IDs (STRING ARRAY of UUIDs)."
        },
        "allowedMarkings": {
          "type": "array",
          "description": "For MARKINGS type, the set of allowed marking IDs.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "allowedOrganizations": {
          "type": "array",
          "description": "For ORGANIZATIONS type, allowed organization IDs.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "maxClassificationLevel": {
          "type": "string",
          "description": "For CLASSIFICATIONS type (CBAC only), maximum classification level.",
          "enum": ["UNCLASSIFIED", "CONFIDENTIAL", "SECRET", "TOP_SECRET"]
        }
      },
      "required": ["propertyApiName", "controlType"],
      "additionalProperties": false
    },
    "ObjectSecurityPolicy": {
      "type": "object",
      "description": "Row-level security policy for this ObjectType (Restricted View integration).",
      "properties": {
        "policyType": {
          "type": "string",
          "enum": ["RESTRICTED_VIEW", "PROPERTY_BASED", "CUSTOM"]
        },
        "restrictedViewPolicy": {
          "$ref": "#/$defs/RestrictedViewPolicy"
        }
      },
      "additionalProperties": false
    },
    "RestrictedViewPolicy": {
      "type": "object",
      "description": "Policy for Restricted View-backed row-level security (Palantir P1-CRITICAL requirement).",
      "properties": {
        "logicalOperator": {
          "type": "string",
          "description": "Logical operator for combining policy terms.",
          "enum": ["AND", "OR"],
          "default": "AND"
        },
        "terms": {
          "type": "array",
          "description": "Policy terms that determine row visibility.",
          "items": {
            "$ref": "#/$defs/PolicyTerm"
          }
        },
        "userAttributeMapping": {
          "type": "object",
          "description": "Mapping of user attributes to policy evaluation.",
          "properties": {
            "identifierType": {
              "type": "string",
              "description": "User identifier type - UUID only (names not supported).",
              "enum": ["UUID"],
              "default": "UUID"
            },
            "markingsAttribute": {
              "type": "string",
              "description": "User attribute containing their markings."
            },
            "organizationsAttribute": {
              "type": "string",
              "description": "User attribute containing their organizations."
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "PolicyTerm": {
      "type": "object",
      "description": "Single term in a Restricted View policy.",
      "properties": {
        "termType": {
          "type": "string",
          "enum": ["USER_ATTRIBUTE_COMPARISON", "COLUMN_VALUE_MATCH", "MARKING_CHECK"]
        },
        "columnName": {
          "type": "string",
          "description": "Column from backing dataset to evaluate."
        },
        "userAttribute": {
          "type": "string",
          "description": "User attribute to compare against."
        },
        "comparisonOperator": {
          "type": "string",
          "enum": ["EQUALS", "CONTAINS", "IN", "NOT_IN"],
          "default": "EQUALS"
        },
        "staticValue": {
          "description": "Static value for comparison (string, boolean, number, or array)."
        }
      },
      "required": ["termType"],
      "additionalProperties": false
    },
    "PropertySecurityPolicy": {
      "type": "object",
      "description": "Column-level security for specific properties.",
      "properties": {
        "propertyApiName": {
          "type": "string",
          "description": "apiName of the property to secure."
        },
        "accessLevel": {
          "type": "string",
          "description": "Default access level for this property.",
          "enum": ["FULL", "READ_ONLY", "MASKED", "HIDDEN"],
          "default": "FULL"
        },
        "maskingPattern": {
          "type": "string",
          "description": "For MASKED access, the pattern to apply.",
          "examples": ["{last4}", "{first3}...{last3}", "***"]
        }
      },
      "required": ["propertyApiName", "accessLevel"],
      "additionalProperties": false
    },
    "ObjectTypeMetadata": {
      "type": "object",
      "description": "Auxiliary tracking and audit information.",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation.",
          "readOnly": true
        },
        "createdBy": {
          "type": "string",
          "description": "User ID or agent ID who created this ObjectType.",
          "readOnly": true
        },
        "modifiedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last modification.",
          "readOnly": true
        },
        "modifiedBy": {
          "type": "string",
          "description": "User ID or agent ID who last modified this ObjectType.",
          "readOnly": true
        },
        "version": {
          "type": "integer",
          "description": "Schema version number (increments on each change).",
          "minimum": 1,
          "default": 1,
          "readOnly": true
        },
        "tags": {
          "type": "array",
          "description": "Classification tags for organization.",
          "items": {
            "type": "string"
          }
        },
        "sourceModule": {
          "type": "string",
          "description": "Module or domain this ObjectType belongs to."
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "apiName": "Employee",
      "displayName": "Employee",
      "description": "Represents an employee in the organization.",
      "primaryKey": {
        "propertyApiName": "employeeId",
        "backingColumn": "employee_id"
      },
      "properties": [
        {
          "apiName": "employeeId",
          "displayName": "Employee ID",
          "description": "Unique identifier for the employee.",
          "dataType": { "type": "STRING" },
          "constraints": { "required": true, "unique": true }
        },
        {
          "apiName": "fullName",
          "displayName": "Full Name",
          "description": "Employee's full name.",
          "dataType": { "type": "STRING" },
          "constraints": { "required": true, "maxLength": 255 }
        },
        {
          "apiName": "department",
          "displayName": "Department",
          "description": "Department the employee belongs to.",
          "dataType": { "type": "STRING" },
          "constraints": {
            "enum": ["Engineering", "Sales", "HR", "Finance", "Operations"]
          }
        },
        {
          "apiName": "securityMarkings",
          "displayName": "Security Markings",
          "description": "Mandatory control property for row-level security.",
          "dataType": {
            "type": "ARRAY",
            "arrayItemType": { "type": "STRING" }
          },
          "constraints": { "required": true },
          "isMandatoryControl": true
        }
      ],
      "status": "ACTIVE",
      "endorsed": true,
      "backingDataset": {
        "datasetRid": "ri.foundry.main.dataset.abc123",
        "mode": "SINGLE",
        "restrictedViewRid": "ri.foundry.main.restricted-view.xyz789"
      },
      "securityConfig": {
        "mandatoryControlProperties": [
          {
            "propertyApiName": "securityMarkings",
            "controlType": "MARKINGS",
            "markingColumnMapping": "security_markings"
          }
        ],
        "objectSecurityPolicy": {
          "policyType": "RESTRICTED_VIEW",
          "restrictedViewPolicy": {
            "logicalOperator": "AND",
            "terms": [
              {
                "termType": "MARKING_CHECK",
                "columnName": "security_markings",
                "userAttribute": "user.markings"
              }
            ]
          }
        }
      },
      "metadata": {
        "createdAt": "2026-01-17T10:00:00Z",
        "createdBy": "admin",
        "modifiedAt": "2026-01-17T10:00:00Z",
        "modifiedBy": "admin",
        "version": 1,
        "tags": ["hr", "core"],
        "sourceModule": "human_resources"
      }
    }
  ]
}
