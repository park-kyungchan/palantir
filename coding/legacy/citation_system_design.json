{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "design_name": "Universal Code Learning Protocol - Citation System",
  "version": "1.0.0",
  "purpose": "구조화된 출처 추적 시스템으로 모든 설명과 코드 스니펫에 권위 있는 출처를 연결",

  "source_schema": {
    "type": "object",
    "required": ["title", "type", "language"],
    "properties": {
      "title": {
        "type": "string",
        "description": "문서 제목 또는 간략한 식별자",
        "examples": [
          "Go Blog: Error handling and Go",
          "PEP 484 - Type Hints",
          "SE-0296: Async/await",
          "Rob Pike - Less is exponentially more"
        ]
      },
      "url": {
        "type": "string",
        "format": "uri",
        "description": "원본 문서 URI (official_doc, pep, swift_evolution, blog, book의 경우 필수)",
        "examples": [
          "https://go.dev/blog/error-handling-and-go",
          "https://peps.python.org/pep-0484/",
          "https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md"
        ]
      },
      "type": {
        "type": "string",
        "enum": [
          "official_doc",
          "pep",
          "swift_evolution",
          "go_proposal",
          "creator_interview",
          "creator_talk",
          "blog",
          "book",
          "community",
          "benchmark"
        ],
        "description": "출처 유형 (권위 수준과 맥락 제공)"
      },
      "language": {
        "type": "string",
        "enum": ["go", "python", "swift", "all"],
        "description": "관련 프로그래밍 언어"
      },
      "author": {
        "type": "string",
        "description": "작성자 (creator_interview, creator_talk, blog, book에서 권장)",
        "examples": ["Rob Pike", "Guido van Rossum", "Chris Lattner"]
      },
      "accessed_date": {
        "type": "string",
        "format": "date",
        "description": "접근 날짜 (ISO 8601: YYYY-MM-DD, 선택적)",
        "examples": ["2024-01-15"]
      },
      "section": {
        "type": "string",
        "description": "문서 내 특정 섹션 또는 페이지 (선택적)",
        "examples": ["Chapter 3: Concurrency", "Error Values section"]
      },
      "quote": {
        "type": "string",
        "description": "직접 인용문 (creator_interview, creator_talk에서 권장)",
        "examples": ["Simplicity is complicated."]
      },
      "year": {
        "type": "integer",
        "description": "발행 연도 (book, talk, interview에서 권장)",
        "examples": [2009, 2015, 2021]
      }
    },
    "allOf": [
      {
        "if": {
          "properties": {
            "type": {
              "enum": ["official_doc", "pep", "swift_evolution", "go_proposal", "blog", "book"]
            }
          }
        },
        "then": {
          "required": ["url"]
        }
      },
      {
        "if": {
          "properties": {
            "type": {
              "enum": ["creator_interview", "creator_talk"]
            }
          }
        },
        "then": {
          "required": ["author"]
        }
      }
    ]
  },

  "integration_points": {
    "1_core_philosophy": {
      "description": "core_philosophy의 quotes, principles, intentionally_excluded에 sources 연결",
      "before": {
        "famous_quotes": [
          {
            "quote": "Simplicity is complicated.",
            "author": "Rob Pike"
          }
        ]
      },
      "after": {
        "famous_quotes": [
          {
            "quote": "Simplicity is complicated.",
            "author": "Rob Pike",
            "source": {
              "title": "Go at Google: Language Design in the Service of Software Engineering",
              "url": "https://go.dev/talks/2012/splash.article",
              "type": "creator_talk",
              "language": "go",
              "year": 2012
            }
          }
        ]
      },
      "modifications": [
        "famous_quotes 각 항목에 source 객체 추가 (선택적)",
        "core_principles 각 항목에 sources 배열 추가 (여러 출처 가능)",
        "intentionally_excluded 각 항목에 source 추가 (설계 결정 근거)"
      ]
    },

    "2_example_explanations": {
      "description": "example_explanations의 각 언어별 설명에 sources 배열 추가",
      "before": {
        "variable_declaration": {
          "go": {
            "syntax": "name := \"Alice\"",
            "design_decision": "':=' provides brevity...",
            "historical_context": "Influenced by Pascal/Modula...",
            "tradeoff": "Two ways to declare..."
          }
        }
      },
      "after": {
        "variable_declaration": {
          "go": {
            "syntax": "name := \"Alice\"",
            "design_decision": "':=' provides brevity...",
            "historical_context": "Influenced by Pascal/Modula...",
            "tradeoff": "Two ways to declare...",
            "sources": [
              {
                "title": "Effective Go - Variables",
                "url": "https://go.dev/doc/effective_go#variables",
                "type": "official_doc",
                "language": "go"
              },
              {
                "title": "A Tour of Go - Short variable declarations",
                "url": "https://go.dev/tour/basics/10",
                "type": "official_doc",
                "language": "go"
              }
            ]
          }
        }
      },
      "modifications": [
        "각 언어 객체 (go, python, swift)에 sources 배열 추가",
        "여러 출처 참조 가능 (공식 문서 + 블로그 + 제작자 발언 등)",
        "sources는 선택적이지만 design_decision이나 historical_context가 있으면 권장"
      ]
    },

    "3_response_template": {
      "description": "response_structure.template에 sources 섹션 추가",
      "new_optional_section": {
        "name": "sources",
        "purpose": "응답에 사용된 모든 출처를 구조화하여 제공",
        "format": "XML tag + 언어별 그룹 + Markdown links",
        "ordering": 99,
        "placement": "Always last (further_reading 다음)",
        "required": false,
        "template": "<sources>\n### Sources\n\n**Go**:\n{GO_SOURCES_LIST}\n\n**Python**:\n{PYTHON_SOURCES_LIST}\n\n**Swift**:\n{SWIFT_SOURCES_LIST}\n\n**General**:\n{GENERAL_SOURCES_LIST}\n</sources>",
        "formatting_rules": [
          "언어별로 그룹화 (Go, Python, Swift, General)",
          "각 출처는 Markdown 링크 형식: [Type: Title](URL)",
          "Type prefix로 출처 유형 표시: [Official Doc], [PEP], [Blog], [Talk] 등",
          "같은 언어 내에서는 type 우선순위로 정렬: official_doc > pep/swift_evolution > creator_talk > blog > community",
          "URL이 없는 경우 Type: Title 형식으로만 표시"
        ],
        "example": "<sources>\n### Sources\n\n**Go**:\n- [Official Doc: Effective Go - Error handling](https://go.dev/doc/effective_go#errors)\n- [Blog: Error handling and Go](https://go.dev/blog/error-handling-and-go)\n- [Talk: Rob Pike - Errors are values](https://go.dev/blog/errors-are-values)\n\n**Python**:\n- [PEP 3134: Exception Chaining](https://peps.python.org/pep-3134/)\n- [Official Doc: Built-in Exceptions](https://docs.python.org/3/library/exceptions.html)\n\n**Swift**:\n- [Swift Evolution: SE-0296 Async/await](https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md)\n- [Official Doc: Error Handling](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/errorhandling/)\n</sources>"
      },
      "inline_citation_format": {
        "description": "응답 본문 내에서 출처를 인라인으로 참조하는 형식",
        "format": "Superscript link + sources 섹션 대응",
        "example_usage": "Go's error handling follows the \"errors are values\" philosophy[^1], making every error site visible.\n\n[^1]: Go Blog: [Error handling and Go](https://go.dev/blog/error-handling-and-go)",
        "alternative": "괄호 참조 형식: (Source: Go Blog - Error handling and Go)"
      }
    },

    "4_language_implementations_section": {
      "description": "각 코드 스니펫 바로 아래 Design Decision 옆에 출처 추가",
      "before": {
        "template": "<lang name=\"Go\">\n```go\n{GO_CODE}\n```\n**Design Decision**: {GO_DESIGN_RATIONALE}\n</lang>"
      },
      "after": {
        "template": "<lang name=\"Go\">\n```go\n{GO_CODE}\n```\n**Design Decision**: {GO_DESIGN_RATIONALE}\n**Source**: [{SOURCE_TYPE}: {SOURCE_TITLE}]({SOURCE_URL})\n</lang>",
        "source_slot": "Single most relevant source per code snippet",
        "format": "Markdown link with type prefix"
      },
      "modifications": [
        "각 <lang> 태그 내 코드 블록 하단에 **Source**: 줄 추가",
        "가장 관련성 높은 출처 1개 선택 (official_doc 우선)",
        "선택적이지만 Design Decision이 있으면 권장"
      ]
    },

    "5_authoritative_sources_enhancement": {
      "description": "authoritative_sources를 단순 URL 리스트에서 구조화된 source 객체로 확장",
      "before": {
        "go": [
          "https://go.dev/doc/",
          "https://go.dev/blog/"
        ]
      },
      "after": {
        "go": [
          {
            "title": "Effective Go",
            "url": "https://go.dev/doc/effective_go",
            "type": "official_doc",
            "language": "go",
            "description": "Canonical style and idiom guide"
          },
          {
            "title": "Go Blog",
            "url": "https://go.dev/blog/",
            "type": "blog",
            "language": "go",
            "description": "Official blog with design rationales"
          },
          {
            "title": "Go Proposals",
            "url": "https://github.com/golang/proposal",
            "type": "go_proposal",
            "language": "go",
            "description": "Language change proposals and discussions"
          }
        ]
      },
      "modifications": [
        "각 URL을 source 객체로 확장",
        "description 필드로 출처 용도 설명",
        "type 필드로 출처 분류 명확화"
      ]
    }
  },

  "validation_rules": [
    {
      "rule_id": "R1",
      "description": "official_doc, pep, swift_evolution, go_proposal, blog, book 타입은 url 필수",
      "validation": "if source.type in ['official_doc', 'pep', 'swift_evolution', 'go_proposal', 'blog', 'book']: assert source.url is not None"
    },
    {
      "rule_id": "R2",
      "description": "creator_interview, creator_talk 타입은 author 필드 필수",
      "validation": "if source.type in ['creator_interview', 'creator_talk']: assert source.author is not None"
    },
    {
      "rule_id": "R3",
      "description": "language 필드는 go, python, swift, all 중 하나",
      "validation": "assert source.language in ['go', 'python', 'swift', 'all']"
    },
    {
      "rule_id": "R4",
      "description": "URL 형식 검증 (http:// 또는 https:// 시작)",
      "validation": "if source.url: assert source.url.startswith('http://') or source.url.startswith('https://')"
    },
    {
      "rule_id": "R5",
      "description": "PEP 출처는 peps.python.org 도메인 권장",
      "validation": "if source.type == 'pep': recommend 'peps.python.org' in source.url"
    },
    {
      "rule_id": "R6",
      "description": "Swift Evolution 출처는 github.com/apple/swift-evolution 권장",
      "validation": "if source.type == 'swift_evolution': recommend 'github.com/apple/swift-evolution' in source.url"
    },
    {
      "rule_id": "R7",
      "description": "Go Proposal 출처는 github.com/golang/proposal 권장",
      "validation": "if source.type == 'go_proposal': recommend 'github.com/golang/proposal' in source.url"
    },
    {
      "rule_id": "R8",
      "description": "accessed_date는 ISO 8601 형식 (YYYY-MM-DD)",
      "validation": "if source.accessed_date: assert re.match(r'^\\d{4}-\\d{2}-\\d{2}$', source.accessed_date)"
    }
  ],

  "llm_usage_guidelines": {
    "when_to_add_sources": [
      "Design Decision을 설명할 때 → 해당 설계 근거를 설명한 공식 문서나 제작자 발언 인용",
      "Historical Context를 제공할 때 → 해당 기능이 도입된 버전의 릴리스 노트나 제안서 인용",
      "Trade-offs를 논의할 때 → 설계 결정에서 희생된 것을 설명한 문서 인용",
      "Creator Quote를 포함할 때 → 원본 발언의 출처 (talk, interview, blog) 반드시 포함",
      "Evolution Timeline을 제시할 때 → 각 버전의 공식 릴리스 노트나 제안서 인용"
    ],
    "source_priority": {
      "highest": [
        "Official documentation (go.dev/doc, docs.python.org, docs.swift.org)",
        "Language proposals (PEP, Swift Evolution, Go Proposals)",
        "Creator talks and interviews (Rob Pike, Guido van Rossum, Chris Lattner)"
      ],
      "medium": [
        "Official blogs (go.dev/blog, python.org blog)",
        "Authoritative community resources (Real Python, Swift by Sundell)"
      ],
      "lowest": [
        "Community discussions (Stack Overflow, Reddit)",
        "Third-party blogs (권위 있는 저자만 선택)"
      ]
    },
    "how_to_fill_sources": [
      "1. 설명을 작성하면서 참조한 문서를 추적",
      "2. 각 주요 주장(design decision, historical context 등)에 대해 최소 1개 출처 확인",
      "3. 여러 출처가 있으면 가장 권위 있는 것을 우선 선택",
      "4. source 객체를 채울 때 required 필드 먼저 확인 (title, type, language)",
      "5. URL이 있으면 반드시 포함 (official_doc, pep, swift_evolution 등)",
      "6. 제작자 발언은 author와 quote 필드도 채우기",
      "7. 최종 응답의 <sources> 섹션에 모든 출처를 언어별로 정리"
    ],
    "example_workflow": {
      "step1": "User asks: 'Why does Go use := for variable declaration?'",
      "step2": "LLM searches core_philosophy and example_explanations for Go variable declaration",
      "step3": "LLM finds: design_decision mentions Pascal/Modula influence",
      "step4": "LLM adds source: {title: 'Effective Go - Variables', url: 'https://go.dev/doc/effective_go#variables', type: 'official_doc', language: 'go'}",
      "step5": "LLM generates response with inline citation and sources section at bottom"
    }
  },

  "migration_strategy": {
    "description": "기존 프로토콜에 citation 시스템을 점진적으로 통합하는 전략",
    "phases": [
      {
        "phase": 1,
        "name": "Schema Definition",
        "actions": [
          "source_schema를 프로토콜에 추가",
          "validation_rules 정의",
          "authoritative_sources를 구조화된 source 객체로 변환"
        ]
      },
      {
        "phase": 2,
        "name": "Core Philosophy Enhancement",
        "actions": [
          "famous_quotes에 source 추가",
          "core_principles에 sources 배열 추가",
          "intentionally_excluded에 source 추가"
        ]
      },
      {
        "phase": 3,
        "name": "Example Explanations Enhancement",
        "actions": [
          "variable_declaration 예제에 sources 추가",
          "error_handling 예제에 sources 추가",
          "concurrency 예제에 sources 추가"
        ]
      },
      {
        "phase": 4,
        "name": "Response Template Update",
        "actions": [
          "optional_sections에 sources 섹션 추가",
          "language_implementations 템플릿에 Source 줄 추가",
          "formatting_guidelines에 citation 규칙 추가"
        ]
      },
      {
        "phase": 5,
        "name": "LLM Instruction Update",
        "actions": [
          "usage_instructions.for_llm에 source 추가 규칙 포함",
          "dynamic_context.explanation_components에 sources 필드 추가"
        ]
      }
    ],
    "backward_compatibility": [
      "모든 sources 필드는 선택적 (optional)",
      "sources가 없어도 기존 응답 형식은 유효",
      "점진적으로 출처를 추가하며 프로토콜 품질 향상"
    ]
  },

  "real_world_examples": {
    "example_1_go_error_handling": {
      "quote_with_source": {
        "quote": "Errors are values.",
        "author": "Go Blog",
        "source": {
          "title": "Errors are values",
          "url": "https://go.dev/blog/errors-are-values",
          "type": "blog",
          "language": "go",
          "author": "Rob Pike",
          "year": 2015,
          "accessed_date": "2024-01-15"
        }
      },
      "design_decision_with_source": {
        "design_decision": "Go returns errors as values instead of using exceptions, making error handling explicit and visible at every call site.",
        "sources": [
          {
            "title": "Effective Go - Errors",
            "url": "https://go.dev/doc/effective_go#errors",
            "type": "official_doc",
            "language": "go"
          },
          {
            "title": "Error handling and Go",
            "url": "https://go.dev/blog/error-handling-and-go",
            "type": "blog",
            "language": "go",
            "author": "Andrew Gerrand",
            "year": 2011
          }
        ]
      }
    },
    "example_2_python_zen": {
      "principle_with_source": {
        "principle": "There should be one-- and preferably only one --obvious way to do it.",
        "source": {
          "title": "PEP 20 - The Zen of Python",
          "url": "https://peps.python.org/pep-0020/",
          "type": "pep",
          "language": "python",
          "author": "Tim Peters",
          "year": 2004
        }
      }
    },
    "example_3_swift_async_await": {
      "evolution_with_source": {
        "version": "5.5",
        "feature": "async/await, actors",
        "year": 2021,
        "source": {
          "title": "SE-0296: Async/await",
          "url": "https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md",
          "type": "swift_evolution",
          "language": "swift",
          "author": "Chris Lattner, Joe Groff"
        }
      }
    }
  },

  "complete_integration_example": {
    "description": "프로토콜에 실제로 삽입할 수 있는 완전한 예제",
    "section": "example_explanations.error_handling",
    "integrated_structure": {
      "error_handling": {
        "go": {
          "syntax": "result, err := func(); if err != nil { return err }",
          "design_decision": "Errors as values, not exceptions. Every error site is visible. 'Errors are values' philosophy.",
          "creator_quote": "Don't just check errors, handle them gracefully. - Rob Pike",
          "historical_context": "Deliberate rejection of exceptions from C++/Java. Ken Thompson: exceptions coupled to control flow make code complex.",
          "tradeoff": "Verbose (if err != nil everywhere) but control flow is always explicit.",
          "sources": [
            {
              "title": "Effective Go - Errors",
              "url": "https://go.dev/doc/effective_go#errors",
              "type": "official_doc",
              "language": "go"
            },
            {
              "title": "Error handling and Go",
              "url": "https://go.dev/blog/error-handling-and-go",
              "type": "blog",
              "language": "go",
              "author": "Andrew Gerrand",
              "year": 2011
            },
            {
              "title": "Errors are values",
              "url": "https://go.dev/blog/errors-are-values",
              "type": "blog",
              "language": "go",
              "author": "Rob Pike",
              "year": 2015
            }
          ]
        },
        "python": {
          "syntax": "try: result = func() except ValueError as e: handle(e)",
          "design_decision": "EAFP (Easier to Ask Forgiveness than Permission). Exceptions separate happy path from error handling.",
          "zen_connection": "Errors should never pass silently. Unless explicitly silenced.",
          "historical_context": "Exception-based from Python 1.0. Integral to duck typing - don't check types, catch exceptions.",
          "tradeoff": "Clean happy path but hidden control flow. Easy to over-catch with bare 'except'.",
          "sources": [
            {
              "title": "PEP 3134 - Exception Chaining and Embedded Tracebacks",
              "url": "https://peps.python.org/pep-3134/",
              "type": "pep",
              "language": "python",
              "author": "Ka-Ping Yee"
            },
            {
              "title": "Built-in Exceptions",
              "url": "https://docs.python.org/3/library/exceptions.html",
              "type": "official_doc",
              "language": "python"
            },
            {
              "title": "Python Glossary - EAFP",
              "url": "https://docs.python.org/3/glossary.html#term-EAFP",
              "type": "official_doc",
              "language": "python"
            }
          ]
        },
        "swift": {
          "syntax": "do { let data = try func() } catch FileError.notFound { handle() }",
          "design_decision": "'try' keyword makes throwing visible at call site. Compiler enforces handling.",
          "evolution": "Swift 2.0 introduced throws. Swift 5.0 added Result type. Swift 6.0 added typed throws (SE-0413).",
          "historical_context": "Learned from Go's visibility and traditional exception ergonomics. Unmarked propagation is nasty.",
          "tradeoff": "'try' everywhere adds visual noise, but all error sites are visible.",
          "sources": [
            {
              "title": "The Swift Programming Language - Error Handling",
              "url": "https://docs.swift.org/swift-book/documentation/the-swift-programming-language/errorhandling/",
              "type": "official_doc",
              "language": "swift"
            },
            {
              "title": "SE-0276: Multi-Pattern Catch Clauses",
              "url": "https://github.com/apple/swift-evolution/blob/main/proposals/0276-multi-pattern-catch-clauses.md",
              "type": "swift_evolution",
              "language": "swift"
            },
            {
              "title": "SE-0413: Typed throws",
              "url": "https://github.com/apple/swift-evolution/blob/main/proposals/0413-typed-throws.md",
              "type": "swift_evolution",
              "language": "swift",
              "year": 2024
            }
          ]
        }
      }
    }
  },

  "summary": {
    "what_changed": [
      "Source 스키마 정의 (title, url, type, language, author, accessed_date 등)",
      "core_philosophy의 quotes와 principles에 source/sources 추가",
      "example_explanations 각 언어에 sources 배열 추가",
      "response_template에 <sources> 섹션 추가 (optional)",
      "language_implementations에 **Source**: 줄 추가",
      "authoritative_sources를 구조화된 객체로 확장"
    ],
    "what_stayed_same": [
      "기존 구조 유지 (섹션, 템플릿, 순서)",
      "모든 sources 필드는 선택적 (backward compatible)",
      "응답 형식 동일 (XML + Markdown)"
    ],
    "benefits": [
      "모든 주장과 코드에 검증 가능한 출처 제공",
      "LLM이 권위 있는 문서만 참조하도록 강제",
      "사용자가 더 깊이 학습할 수 있는 경로 제공",
      "프로토콜의 신뢰성과 교육적 가치 향상",
      "제작자 발언과 공식 문서를 명확히 구분"
    ]
  }
}
