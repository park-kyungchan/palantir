# =============================================================================
# Mathpix API Reference for Claude - Core Documentation
# =============================================================================
# Version: 1.0.0
# Date: 2026-02-04
# Source: https://docs.mathpix.com/
# Purpose: Machine-Readable API reference for Claude-only usage
# =============================================================================

---
metadata:
  version: "1.0.0"
  created_at: "2026-02-04"
  source: "https://docs.mathpix.com/"
  target_reader: "claude_only"
  file_index: "01/05"

# =============================================================================
# API OVERVIEW
# =============================================================================
api_overview:
  name: "Mathpix OCR API"
  version: "v3"
  description: |
    Recognizes printed and handwritten STEM document content including
    math, text, tables, and chemistry diagrams from images, stroke data, or PDFs.

  base_urls:
    primary: "https://api.mathpix.com"
    eu_region: "https://eu-central-1.api.mathpix.com"  # GDPR compliance

  output_formats:
    - "Mathpix Markdown (MMD)"
    - "LaTeX"
    - "AsciiMath"
    - "MathML"
    - "HTML"

# =============================================================================
# ENDPOINTS
# =============================================================================
endpoints:
  v3_text:
    url: "/v3/text"
    method: "POST"
    description: "Process images - PRIMARY endpoint for OCR"
    sync: true
    supports_file_upload: true
    supports_url: true

  v3_pdf:
    url: "/v3/pdf"
    method: "POST"
    description: "Process PDF documents - ASYNC only"
    sync: false
    max_file_size: "1GB"
    supports_file_upload: true
    supports_url: true

  v3_strokes:
    url: "/v3/strokes"
    method: "POST"
    description: "Process handwritten stroke coordinates"
    sync: true
    note: "Smaller payloads, faster response than image-based"

  v3_latex:
    url: "/v3/latex"
    method: "POST"
    description: "Legacy equation image processing"
    status: "DEPRECATED"
    note: "Use v3/text instead for improved power and robustness"

  v3_converter:
    url: "/v3/converter"
    method: "POST"
    description: "Convert MMD to other formats"
    sync: false

  v3_app_tokens:
    url: "/v3/app-tokens"
    method: "POST"
    description: "Generate temporary client-side tokens"

  v3_ocr_results:
    url: "/v3/ocr-results"
    method: "GET"
    description: "Query previous OCR results"

  v3_ocr_usage:
    url: "/v3/ocr-usage"
    method: "GET"
    description: "Track API consumption"

# =============================================================================
# AUTHENTICATION
# =============================================================================
authentication:
  server_side:
    description: "Use API keys for backend implementations"
    headers:
      app_id:
        type: "string"
        required: true
        description: "Application ID from Mathpix dashboard"
      app_key:
        type: "string"
        required: true
        description: "Application secret key"
    security_warning: |
      NEVER include API keys in client-side code.
      Keys can be stolen by inspecting app binary.

    example_headers:
      app_id: "your_app_id"
      app_key: "your_app_key"
      Content-Type: "application/json"

  client_side:
    description: "Use temporary tokens for client-facing apps"
    endpoint: "/v3/app-tokens"
    method: "POST"
    request_header: "app_key"

    response_fields:
      app_token:
        type: "string"
        description: "Temporary authentication token"
      app_token_expires_at:
        type: "number"
        description: "Unix timestamp for expiration"
      strokes_session_id:
        type: "string"
        description: "Optional - for live drawing updates"

    token_parameters:
      expires:
        type: "number"
        unit: "seconds"
        range: "30-43200"
        default: 300
        description: "Token lifetime"
      include_strokes_session_id:
        type: "boolean"
        description: "Return strokes_session_id for live updates"

    limitations:
      - "Cannot access PDF functionality"
      - "Cannot access historical data"
      - "Cannot access account administration"
      - "Cannot make batch/async requests"
      - "Individual image and stroke requests ONLY"

# =============================================================================
# SUPPORTED INPUT FORMATS
# =============================================================================
supported_inputs:
  images:
    formats:
      - "JPEG"
      - "PNG"
      - "GIF"
      - "WEBP"
    upload_methods:
      - type: "url"
        parameter: "src"
        description: "HTTP URL to image"
      - type: "base64"
        parameter: "src"
        format: "data:image/png;base64,{base64_data}"
      - type: "file_upload"
        method: "multipart/form-data"
        field: "file"

  documents:
    formats:
      - "PDF"
      - "EPUB"
      - "DOCX"
      - "PPTX"
      - "DOC"
      - "ODT"
      - "MOBI"
      - "DJVU"
      - "AZW"
      - "AZW3"
      - "KFX"
      - "WPD"
    max_size: "1GB"

  strokes:
    format: "JSON with x/y coordinate arrays"
    structure:
      strokes:
        x: "[[x_coords_stroke1], [x_coords_stroke2], ...]"
        y: "[[y_coords_stroke1], [y_coords_stroke2], ...]"

# =============================================================================
# SUPPORTED OUTPUT FORMATS
# =============================================================================
supported_outputs:
  text_formats:
    mmd:
      extension: ".mmd"
      description: "Mathpix Markdown"
    md:
      extension: ".md"
      description: "Standard Markdown"
    tex:
      extension: ".tex"
      description: "LaTeX source"
    html:
      extension: ".html"
      description: "HTML rendering"

  document_formats:
    docx:
      extension: ".docx"
      description: "Microsoft Word"
    pdf:
      extension: ".pdf"
      description: "PDF with HTML rendering"
    latex_pdf:
      extension: ".latex.pdf"
      description: "PDF with selectable equations"
    pptx:
      extension: ".pptx"
      description: "PowerPoint"
    xlsx:
      extension: ".xlsx"
      description: "Excel spreadsheet (tables)"

  data_formats:
    lines_json:
      extension: ".lines.json"
      description: "Structured line data with geometry"
    lines_mmd_json:
      extension: ".lines.mmd.json"
      description: "Line data with MMD context"
      status: "DEPRECATED"

  archive_formats:
    mmd_zip:
      extension: ".mmd.zip"
      description: "MMD with images"
    md_zip:
      extension: ".md.zip"
      description: "Markdown with images"
    html_zip:
      extension: ".html.zip"
      description: "HTML with images"
    tex_zip:
      extension: ".tex.zip"
      description: "LaTeX with images"

# =============================================================================
# MATH DELIMITERS
# =============================================================================
math_delimiters:
  inline:
    default: ["\\(", "\\)"]
    common_alternative: ["$", "$"]
    parameter: "math_inline_delimiters"

  display:
    default: ["\\[", "\\]"]
    common_alternative: ["$$", "$$"]
    parameter: "math_display_delimiters"

# =============================================================================
# IMPORTANT NOTES
# =============================================================================
important_notes:
  - note: "EXIF orientation data is IGNORED"
    impact: "Images must be pre-rotated or use auto_rotate"

  - note: "Chemistry diagrams use SMILES notation"
    format: "<smiles>...</smiles>"

  - note: "PDF endpoint is ASYNC only"
    impact: "Must poll for status, cannot get immediate result"

  - note: "include_word_data and include_line_data are MUTUALLY EXCLUSIVE"
    impact: "API returns error if both are true"

  - note: "App tokens cannot access PDF, batch, or async features"
    impact: "Use full API keys for these features"
