# =============================================================================
# Mathpix API Reference for Claude - v3/pdf Endpoint
# =============================================================================
# Version: 1.0.0
# Date: 2026-02-04
# Purpose: Complete v3/pdf endpoint specification
# =============================================================================

---
metadata:
  file_index: "03/05"
  endpoint: "/v3/pdf"

# =============================================================================
# ENDPOINT INFO
# =============================================================================
endpoint:
  url: "https://api.mathpix.com/v3/pdf"
  method: "POST"
  async_only: true
  description: "Process PDF documents - ASYNC ONLY"
  max_file_size: "1GB"

# =============================================================================
# WORKFLOW
# =============================================================================
workflow:
  steps:
    1_upload:
      action: "POST /v3/pdf"
      returns: "pdf_id"
      description: "Upload PDF and receive tracking ID"

    2_poll_status:
      action: "GET /v3/pdf/{pdf_id}"
      returns: "status, percent_done, num_pages"
      description: "Poll until status=completed"
      statuses:
        - "received"
        - "loaded"
        - "split"
        - "completed"
        - "error"

    3_get_results:
      action: "GET /v3/pdf/{pdf_id}.{format}"
      formats:
        - ".mmd"
        - ".md"
        - ".docx"
        - ".tex.zip"
        - ".html"
        - ".pdf"
        - ".latex.pdf"
        - ".pptx"
        - ".lines.json"
        - ".xlsx"
      description: "Download converted results"

    4_optional_delete:
      action: "DELETE /v3/pdf/{pdf_id}"
      description: "Remove all outputs and input PDF"

# =============================================================================
# REQUEST PARAMETERS
# =============================================================================
request_parameters:
  # ---------------------------------------------------------------------------
  # INPUT PARAMETERS
  # ---------------------------------------------------------------------------
  url:
    type: "string"
    required: false
    description: "HTTP URL for file download"

  file:
    type: "binary"
    required: false
    description: "PDF file in multipart form"
    note: "Use options_json for parameters with file upload"

  page_ranges:
    type: "string"
    required: false
    description: "Specify pages to process"
    example: "2,4-6"

  streaming:
    type: "boolean"
    required: false
    default: false
    description: "Enable server-sent events for real-time results"

  # ---------------------------------------------------------------------------
  # OUTPUT FORMAT PARAMETERS
  # ---------------------------------------------------------------------------
  conversion_formats:
    type: "object"
    required: false
    description: "Output format specifications"
    example:
      docx: true
      tex.zip: true

  # ---------------------------------------------------------------------------
  # CONTENT PARAMETERS (same as v3/text)
  # ---------------------------------------------------------------------------
  alphabets_allowed:
    type: "object"
    description: "Restrict output alphabets"

  rm_spaces:
    type: "boolean"
    default: true
    description: "Remove extra whitespace"

  rm_fonts:
    type: "boolean"
    default: false
    description: "Strip font commands"

  idiomatic_eqn_arrays:
    type: "boolean"
    default: false
    description: "Use aligned/gathered/cases environments"

  include_equation_tags:
    type: "boolean"
    default: false
    description: "Add equation numbering"

  include_smiles:
    type: "boolean"
    default: true
    description: "Enable chemistry OCR"

  include_chemistry_as_image:
    type: "boolean"
    description: "Return SMILES in alt-text"

  include_diagram_text:
    type: "boolean"
    default: false
    description: "Extract text from diagrams"

  include_page_info:
    type: "boolean"
    default: false
    description: "Include page metadata"
    note: "Default is FALSE for PDF (unlike v3/text)"

  numbers_default_to_math:
    type: "boolean"
    default: false
    description: "Force numbers to math mode"

  math_inline_delimiters:
    type: "array[string, string]"
    default: '["\\(", "\\)"]'
    description: "Custom inline delimiters"

  math_display_delimiters:
    type: "array[string, string]"
    default: '["\\[", "\\]"]'
    description: "Custom display delimiters"

  enable_tables_fallback:
    type: "boolean"
    default: false
    description: "Advanced table processing"

  fullwidth_punctuation:
    type: "boolean"
    description: "East Asian punctuation control"

  # ---------------------------------------------------------------------------
  # SECTION NUMBERING PARAMETERS
  # ---------------------------------------------------------------------------
  auto_number_sections:
    type: "boolean"
    description: "Auto-number sections"
    mutual_exclusion: ["remove_section_numbering", "preserve_section_numbering"]

  remove_section_numbering:
    type: "boolean"
    description: "Strip existing numbering"
    mutual_exclusion: ["auto_number_sections", "preserve_section_numbering"]

  preserve_section_numbering:
    type: "boolean"
    default: true
    description: "Keep original numbering"
    mutual_exclusion: ["auto_number_sections", "remove_section_numbering"]

  # ---------------------------------------------------------------------------
  # METADATA PARAMETERS
  # ---------------------------------------------------------------------------
  metadata:
    type: "object"
    description: "Key-value pairs for tracking"

# =============================================================================
# RESPONSE - UPLOAD
# =============================================================================
response_upload:
  fields:
    pdf_id:
      type: "string"
      description: "Tracking identifier for status and retrieval"
      example: "5049b56d6cf916e713be03206f306f1a"

# =============================================================================
# RESPONSE - STATUS
# =============================================================================
response_status:
  endpoint: "GET /v3/pdf/{pdf_id}"
  fields:
    status:
      type: "string"
      values: ["received", "loaded", "split", "completed", "error"]
    num_pages:
      type: "integer"
      description: "Total pages in PDF"
    num_pages_completed:
      type: "integer"
      description: "Pages processed so far"
    percent_done:
      type: "number"
      description: "Processing progress percentage"

# =============================================================================
# STREAMING ENDPOINT
# =============================================================================
streaming:
  endpoint: "GET /v3/pdf/{pdf_id}/stream"
  description: "Server-sent events for real-time page results"
  requires: "streaming: true in initial POST"
  note: "Pages may arrive out of order"
  response_per_page:
    text:
      type: "string"
      description: "Mathpix Markdown output"
    page_idx:
      type: "number"
      description: "Page index (starting at 1)"
    pdf_selected_len:
      type: "number"
      description: "Total selected pages"

# =============================================================================
# LINES.JSON SCHEMA
# =============================================================================
lines_json:
  endpoint: "GET /v3/pdf/{pdf_id}.lines.json"
  description: "Structured line-by-line data with geometric information"

  structure:
    pages:
      type: "array[PdfPageData]"

  PdfPageData:
    image_id:
      type: "string"
      description: "PDF ID plus page number"
    page:
      type: "integer"
      description: "Page number"
    page_width:
      type: "integer"
      description: "Width in pixels"
    page_height:
      type: "integer"
      description: "Height in pixels"
    lines:
      type: "array[PdfLineData]"

  PdfLineData:
    id:
      type: "string"
      description: "Unique identifier"
    parent_id:
      type: "string"
      optional: true
      description: "Parent line ID"
    children_ids:
      type: "array[string]"
      optional: true
      description: "Child line IDs"
    type:
      type: "string"
      description: "Content type"
    subtype:
      type: "string"
      optional: true
      description: "Content subtype"
    text:
      type: "string"
      description: "Searchable content"
    text_display:
      type: "string"
      optional: true
      description: "Markdown rendering"
    conversion_output:
      type: "boolean"
      description: "Include in final output"
    is_printed:
      type: "boolean"
      description: "Printed content flag"
    is_handwritten:
      type: "boolean"
      description: "Handwritten content flag"
    region:
      type: "object"
      description: "Bounding box"
      fields:
        top_left_x: "integer"
        top_left_y: "integer"
        width: "integer"
        height: "integer"
    cnt:
      type: "array[[x, y]]"
      description: "Polygon coordinates"
    confidence:
      type: "number"
      description: "Accuracy probability"
    confidence_rate:
      type: "number"
      description: "Quality confidence"
    font_size:
      type: "integer"
      description: "Font size in pixels"
    line:
      type: "integer"
      description: "Line number"
    column:
      type: "integer"
      description: "Column index (0-based)"
    selected_labels:
      type: "array[string]"
      optional: true
      description: "Associated figure/table label IDs"

# =============================================================================
# CONVERSION STATUS
# =============================================================================
conversion_status:
  endpoint: "GET /v3/converter/{pdf_id}"
  description: "Monitor format conversion progress"
  response:
    status:
      type: "string"
    conversion_status:
      type: "object"
      description: "Per-format status tracking"
      example:
        docx:
          status: "completed"
        tex.zip:
          status: "processing"

# =============================================================================
# DELETE ENDPOINT
# =============================================================================
delete:
  endpoint: "DELETE /v3/pdf/{pdf_id}"
  description: "Permanently remove all outputs and input PDF"
  warning: "Deletion is irreversible"
  removes:
    - "MMD output"
    - "Converted formats"
    - "Images"
    - "lines.json"
    - "Original PDF"

# =============================================================================
# CODE EXAMPLES
# =============================================================================
examples:
  upload_url:
    description: "Upload PDF from URL"
    code: |
      curl -X POST https://api.mathpix.com/v3/pdf \
        -H 'app_id: APP_ID' \
        -H 'app_key: APP_KEY' \
        -H 'Content-Type: application/json' \
        --data '{
          "url": "https://example.com/document.pdf",
          "conversion_formats": {"docx": true}
        }'

  upload_file:
    description: "Upload PDF file"
    code: |
      curl -X POST https://api.mathpix.com/v3/pdf \
        -H 'app_id: APP_ID' \
        -H 'app_key: APP_KEY' \
        --form 'file=@"document.pdf"' \
        --form 'options_json="{\"conversion_formats\": {\"docx\": true}}"'

  check_status:
    description: "Check processing status"
    code: |
      curl -H 'app_key: APP_KEY' \
        https://api.mathpix.com/v3/pdf/{pdf_id}

  download_result:
    description: "Download converted DOCX"
    code: |
      curl -H 'app_key: APP_KEY' \
        https://api.mathpix.com/v3/pdf/{pdf_id}.docx > output.docx

  download_lines:
    description: "Download lines.json"
    code: |
      curl -H 'app_key: APP_KEY' \
        https://api.mathpix.com/v3/pdf/{pdf_id}.lines.json
