# =============================================================================
# PDF 재구현 불가능 요소 명세서 (Machine-Readable)
# =============================================================================
# Version: 2.0.0
# Date: 2026-02-04
# Stack: Mathpix API v3 + Claude Opus 4.5
# Purpose: Agent가 파싱하여 파이프라인 설계/제약 인식에 활용
# Sources: Official Anthropic Documentation, Mathpix API Docs
# =============================================================================

---
metadata:
  version: "2.0.0"
  created_at: "2026-02-04T09:55:00+09:00"
  stack:
    ocr_api: "Mathpix API v3"
    vision_model: "claude-opus-4-5-20251101"
  purpose: "machine_readable_constraint_specification"
  target_reader: "agent"

# =============================================================================
# MATHPIX API CAPABILITIES & LIMITATIONS
# =============================================================================
mathpix_api:
  capabilities:
    text_extraction:
      supported: true
      accuracy: 0.98
      includes_latex: true
      includes_asciimath: true
      includes_mathml: true

    bounding_box:
      supported: true
      accuracy: 0.95
      unit: "pixels"
      fields:
        - "top_left_x"
        - "top_left_y"
        - "width"
        - "height"

    font_size:
      supported: true
      unit: "pixels"
      accuracy: 0.95

    line_type:
      supported: true
      types_count: 30
      examples:
        - "text"
        - "section_header"
        - "math"
        - "chart"
        - "chart_info"
        - "footnote"
        - "page_info"

    column_detection:
      supported: true
      accuracy: 0.95

    page_dimensions:
      supported: true
      fields:
        - "page_width"
        - "page_height"

    image_extraction:
      supported: true
      format: "cdn_url"
      persistence: "temporary"
      expiration_hours: 24-48

  limitations:
    font_family:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    font_weight:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    font_style:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    text_color:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    background_color:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    border_style:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    letter_spacing:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

    line_height:
      supported: false
      reason: "mathpix_api_does_not_provide"
      workaround: null

# =============================================================================
# CLAUDE OPUS 4.5 VISION CAPABILITIES & LIMITATIONS (Official Documentation)
# =============================================================================
claude_opus_4_5_vision:
  capabilities:
    text_extraction:
      supported: true
      quality: "high"
      handwritten: "partial"
      accuracy_clear_images: 0.90

    document_structure:
      supported: true
      heading_recognition: true
      paragraph_detection: true
      table_detection: true
      list_detection: true

    semantic_understanding:
      supported: true
      chart_interpretation: true
      diagram_understanding: true
      form_extraction: true

    structured_output:
      supported: true
      json_schema_validation: true
      formats:
        - "json"
        - "markdown"
        - "csv"

  limitations:
    # CRITICAL: 공식 문서에서 명시한 한계

    bounding_box:
      supported: false
      official_status: "unreliable"
      official_quote: "Bounding box coordinates inconsistent across multiple runs"
      severity: "high"
      recommendation: "use_mathpix_instead"

    spatial_reasoning:
      supported: false
      official_status: "limited"
      official_quote: "Spatial reasoning abilities are LIMITED"
      severity: "high"
      affected_tasks:
        - "precise_localization"
        - "layout_reconstruction"
        - "position_description"

    font_family_detection:
      supported: false
      official_status: "not_documented"
      inference_possible: false
      severity: "absolute"

    font_weight_detection:
      supported: false
      official_status: "not_documented"
      inference_possible: "unreliable"
      severity: "high"

    font_style_detection:
      supported: false
      official_status: "not_documented"
      inference_possible: "unreliable"
      severity: "high"

    font_size_detection:
      supported: false
      official_status: "not_documented"
      inference_possible: false
      severity: "absolute"

    color_extraction:
      supported: false
      official_status: "inference_based_only"
      official_api_support: false
      inference_possible: true
      inference_accuracy: null  # No official benchmark
      severity: "high"
      note: "Can be prompted but no accuracy guarantees"

    text_style_detection:
      bold:
        supported: false
        inference_possible: "unreliable"
      italic:
        supported: false
        inference_possible: "unreliable"
      underline:
        supported: false
        inference_possible: "unreliable"

    image_metadata:
      supported: false
      official_quote: "Does not parse or receive any metadata from images"
      severity: "absolute"

    object_localization:
      supported: false
      official_status: "cannot_localize"
      official_quote: "Like most multimodal models, unable to localize objects"
      severity: "absolute"

    precise_counting:
      supported: false
      official_status: "approximate"
      severity: "medium"

# =============================================================================
# COMBINED STACK LIMITATIONS (Mathpix + Claude Opus 4.5)
# =============================================================================
combined_stack_limitations:
  absolute_impossible:
    # 어떤 조합으로도 복제 불가능
    - element: "font_family"
      mathpix: false
      claude_vision: false
      alternative_tool: "Google Document AI"
      severity: "absolute"

    - element: "font_weight"
      mathpix: false
      claude_vision: "inference_unreliable"
      alternative_tool: "Google Document AI"
      severity: "absolute"

    - element: "font_style"
      mathpix: false
      claude_vision: "inference_unreliable"
      alternative_tool: "Google Document AI"
      severity: "absolute"

    - element: "letter_spacing"
      mathpix: false
      claude_vision: false
      alternative_tool: null
      severity: "absolute"

    - element: "line_height"
      mathpix: false
      claude_vision: false
      alternative_tool: null
      severity: "absolute"

    - element: "precise_color_rgb"
      mathpix: false
      claude_vision: "inference_only_no_guarantee"
      alternative_tool: "Computer Vision APIs"
      severity: "high"

    - element: "border_style"
      mathpix: false
      claude_vision: "inference_unreliable"
      alternative_tool: null
      severity: "high"

    - element: "border_width"
      mathpix: false
      claude_vision: false
      alternative_tool: null
      severity: "absolute"

    - element: "box_shadow"
      mathpix: false
      claude_vision: false
      alternative_tool: null
      severity: "absolute"

    - element: "border_radius"
      mathpix: false
      claude_vision: false
      alternative_tool: null
      severity: "absolute"

  conditional_possible:
    # 조건부로 가능 (정확도 제한)
    - element: "image_content"
      mathpix: "cdn_url_temporary"
      claude_vision: "content_understanding_only"
      condition: "must_cache_immediately"
      expiration: "24-48_hours"
      severity: "medium"

    - element: "approximate_color"
      mathpix: false
      claude_vision: "inference_based"
      accuracy: "unknown_no_benchmark"
      severity: "medium"

  fully_possible:
    # 완전히 복제 가능
    - element: "text_content"
      mathpix: true
      accuracy: 0.98

    - element: "latex_math"
      mathpix: true
      accuracy: 0.98

    - element: "bounding_box"
      mathpix: true
      accuracy: 0.95
      note: "Use Mathpix, NOT Claude Vision"

    - element: "font_size_px"
      mathpix: true
      accuracy: 0.95

    - element: "column_layout"
      mathpix: true
      accuracy: 0.95

    - element: "page_dimensions"
      mathpix: true
      accuracy: 1.0

    - element: "line_type"
      mathpix: true
      accuracy: 0.95

    - element: "document_structure"
      mathpix: "partial"
      claude_vision: true
      combined_accuracy: 0.90

# =============================================================================
# PIXEL PERFECT RECONSTRUCTION ASSESSMENT
# =============================================================================
pixel_perfect_assessment:
  overall_verdict: "impossible"

  accuracy_breakdown:
    content_fidelity:
      score: 1.0
      description: "Text and math content 100% reproducible"

    structural_fidelity:
      score: 0.95
      description: "Document structure 95% reproducible"

    layout_fidelity:
      score: 0.90
      description: "Spatial layout 90% reproducible (bbox ±5px)"

    visual_fidelity:
      score: 0.30
      description: "Visual styling 30% reproducible without additional tools"
      with_claude_inference: 0.50
      note: "Claude inference unreliable, no guarantees"

  total_pixel_perfect_score: 0.60

  blocking_elements:
    critical:
      - "font_family"
      - "font_weight"
      - "precise_color"

    high:
      - "font_style"
      - "border_style"
      - "text_decoration"

    medium:
      - "letter_spacing"
      - "line_height"
      - "box_shadow"

# =============================================================================
# AGENT DECISION RULES
# =============================================================================
agent_decision_rules:
  when_reconstructing_pdf:
    - rule: "ALWAYS use Mathpix for bounding box coordinates"
      reason: "Claude Vision bbox is officially unreliable"

    - rule: "NEVER rely on Claude Vision for font metadata"
      reason: "Not supported, inference unreliable"

    - rule: "CACHE images immediately after Stage B"
      reason: "Mathpix CDN URLs expire in 24-48 hours"

    - rule: "ACCEPT visual fidelity loss as unavoidable"
      reason: "Absolute limitations of current stack"

    - rule: "DO NOT promise pixel-perfect reconstruction"
      reason: "Technically impossible with current tools"

  acceptable_reconstruction_goals:
    - goal: "Content-identical reproduction"
      achievable: true
      accuracy: 1.0

    - goal: "Structurally-equivalent reproduction"
      achievable: true
      accuracy: 0.95

    - goal: "Visually-similar reproduction"
      achievable: "partial"
      accuracy: 0.50-0.60

    - goal: "Pixel-perfect reproduction"
      achievable: false
      accuracy: null

# =============================================================================
# SOURCES
# =============================================================================
sources:
  official:
    - name: "Anthropic Vision Documentation"
      url: "https://platform.claude.com/docs/en/build-with-claude/vision"
      quote: "Spatial reasoning abilities are LIMITED"

    - name: "Anthropic Vision Documentation"
      url: "https://platform.claude.com/docs/en/build-with-claude/vision"
      quote: "Does not parse or receive any metadata from images"

    - name: "Mathpix API Documentation"
      url: "https://docs.mathpix.com/"
      note: "No font family/style/color fields in response schema"

  technical_tests:
    - name: "Roboflow Claude 3 Opus Vision Test"
      url: "https://blog.roboflow.com/claude-3-opus-multimodal/"
      finding: "Bounding box coordinates inconsistent across multiple runs"
