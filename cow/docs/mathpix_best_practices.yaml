# Mathpix Convert API - Best Practices
# Source: https://mathpix.com/docs/convert/best-practices
# Extracted: 2026-02-04

---
metadata:
  source_url: https://mathpix.com/docs/convert/best-practices
  title: "Convert API Best Practices"
  extraction_date: "2026-02-04"

---
# Minimizing Latency
latency_optimization:
  overview:
    primary_factor: "Image upload size"
    principle: "Response speed is roughly proportional to image size"

  image_size:
    target: "<100KB"
    description: "Target images under 100KB for optimal performance"
    techniques:
      - name: "JPEG compression"
        description: "Apply JPEG compression to reduce file size"
      - name: "Image downsizing"
        description: "Reduce image dimensions while maintaining readability"
      - name: "Cropping"
        description: "Remove unnecessary whitespace and margins"

  upload_method:
    recommended: "multipart/form-data with file upload"
    avoid: "base64 JSON encoding"
    reason: "Form uploads reduce processing overhead compared to encoded alternatives"
    implementation:
      preferred:
        method: "multipart/form-data"
        fields:
          - "file"
          - "options_json"
      alternative:
        method: "application/json"
        field: "src"
        encoding: "base64 data URI"

  user_interface:
    recommendation: "Implement cropping UI for end users"
    benefit: "Minimize the quantity of image data transmitted to the API"

---
# Server Locations
server_locations:
  available_regions:
    - region: "US East 1"
      location: "N. Virginia"
      aws_region: "us-east-1"
      base_url: "https://api.mathpix.com"
    - region: "EU Central 1"
      location: "Frankfurt"
      aws_region: "eu-central-1"
      base_url: "https://eu-central-1.api.mathpix.com"
    - region: "SE Asia"
      location: "Singapore"
      aws_region: "ap-southeast-1"

  eu_compliance:
    url: "https://eu-central-1.api.mathpix.com/"
    guarantee: "Data processing within European boundaries"
    use_case: "GDPR compliance and EU data residency requirements"

  routing_strategy:
    recommendation: "Deploy servers in multiple regions and employ latency-based routing"
    implementation:
      - "Set up load balancers in each region"
      - "Use DNS-based latency routing (e.g., AWS Route 53)"
      - "Direct users to nearest server automatically"

---
# Authorization Security
authorization:
  api_key_security:
    warning: "Never put API keys inside client-side apps"
    reason: "Risk of API key theft"
    liability: "Customers bear responsibility for any usage associated with compromised keys"

  app_tokens:
    description: "Temporary access tokens for client-side use"
    features:
      - name: "Short expiration"
        default: "5 minutes (configurable)"
      - name: "Limited scope"
        restrictions:
          - "Cannot access PDF functionality"
          - "Cannot access historical data"
          - "Cannot access account admin data"
          - "Cannot make batch/async requests"
    benefits:
      - "Safe client-side access"
      - "Protects primary API credentials"
      - "Reduces network hops"

  architecture_comparison:
    without_app_tokens:
      flow: "Client -> Your Server -> Mathpix API"
      hops: 2
      latency: "Higher"
    with_app_tokens:
      flow: "Client -> Mathpix API (with app_token)"
      hops: 1
      latency: "Lower"
      note: "Token obtained via Your Server -> Mathpix /v3/app-tokens"

---
# Batch/Indexing Jobs
batch_processing:
  recommended_approach:
    endpoint: "/v3/text"
    flag: "async: true"
    description: "Use v3/text endpoint with async flag for asynchronous processing"

  tagging_strategy:
    parameter: "tags"
    usage: "Add tags when initiating v3/text requests"
    retrieval: "Query results later using v3/ocr-results with matching tags"

  advantages:
    - "No requirement to pre-batch requests"
    - "Uses enhanced v3/text codepath"
    - "More features than v3/batch"

  legacy_alternative:
    endpoint: "/v3/batch"
    status: "Less recommended for new implementations"

---
# v3/text vs v3/latex
endpoint_comparison:
  v3_latex:
    status: "legacy"
    focus: "Mathematical LaTeX extraction"
    behavior: "Ignores textual content"

  v3_text:
    status: "recommended"
    focus: "Full-document text recognition"
    features:
      - "More features"
      - "More robust"
      - "Comprehensive OCR"

  recommendation: "New customers should use v3/text endpoint"

---
# Supported Image File Types
supported_formats:
  description: "Mathpix accepts OpenCV-compatible formats"

  common_formats:
    - extension: [".jpeg", ".jpg", ".jpe"]
      name: "JPEG"
    - extension: [".png"]
      name: "PNG"
    - extension: [".bmp", ".dib"]
      name: "BMP"
    - extension: [".webp"]
      name: "WebP"
    - extension: [".tiff", ".tif"]
      name: "TIFF"

  additional_formats:
    - extension: [".jp2"]
      name: "JPEG 2000"
    - extension: [".pbm", ".pgm", ".ppm", ".pxm", ".pnm"]
      name: "Portable image formats"
    - extension: [".pfm"]
      name: "PFM"
    - extension: [".sr", ".ras"]
      name: "Sun rasters"
    - extension: [".exr"]
      name: "OpenEXR"
    - extension: [".hdr", ".pic"]
      name: "Radiance HDR"

  geospatial:
    description: "GDAL-supported geospatial raster and vector data"

---
# Error Handling Best Practices
error_handling:
  retry_strategy:
    http_429:
      error: "Too many requests"
      action: "Implement exponential backoff"
      example:
        initial_delay: 1  # seconds
        max_delay: 60     # seconds
        multiplier: 2

  validation:
    before_request:
      - "Validate image format"
      - "Check file size"
      - "Verify URL accessibility (if using URL)"
    response_handling:
      - "Check for error field in response"
      - "Handle error_info for detailed diagnostics"

  common_errors:
    image_no_content:
      description: "No recognizable content"
      solution: "Verify image contains text/math"
    image_max_size:
      description: "Image too large"
      solution: "Resize or compress image"
    math_confidence:
      description: "Low recognition confidence"
      solution: "Improve image quality or lower threshold"

---
# Performance Optimization Checklist
optimization_checklist:
  image_preparation:
    - check: "Image size under 100KB"
      priority: high
    - check: "JPEG compression applied"
      priority: high
    - check: "Unnecessary whitespace cropped"
      priority: medium
    - check: "Image resolution appropriate (not excessive)"
      priority: medium

  api_usage:
    - check: "Using multipart/form-data for uploads"
      priority: high
    - check: "Using app_tokens for client-side"
      priority: high
    - check: "Latency-based routing configured"
      priority: medium
    - check: "Using v3/text instead of v3/latex"
      priority: medium

  batch_processing:
    - check: "Using async flag for batch jobs"
      priority: high
    - check: "Tagging requests for retrieval"
      priority: medium
    - check: "Implementing retry logic"
      priority: high

---
# Sample Optimized Request
optimized_request_example:
  description: "Example of an optimized API request"

  preparation:
    - "Compress image to <100KB JPEG"
    - "Crop to relevant content area"
    - "Use multipart/form-data upload"

  request:
    method: POST
    endpoint: "/v3/text"
    content_type: "multipart/form-data"
    headers:
      app_id: "YOUR_APP_ID"
      app_key: "YOUR_APP_KEY"
    form_data:
      file: "@optimized_image.jpg"
      options_json: |
        {
          "formats": ["text"],
          "rm_spaces": true
        }

  expected_benefits:
    - "Faster upload"
    - "Quicker processing"
    - "Lower latency response"
