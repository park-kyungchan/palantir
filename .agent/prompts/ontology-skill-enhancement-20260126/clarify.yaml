# Clarify Output: Ontology Skill Enhancement
# Workload: ontology-skill-enhancement-20260126
# Created: 2026-01-26T10:55:00Z

meta:
  workload_id: ontology-skill-enhancement-20260126
  title: "ObjectType 정의 상호작용 시스템 고도화"
  requester: user
  clarify_date: "2026-01-26"

# ============================================================================
# 1. REQUIREMENTS SUMMARY
# ============================================================================

requirements:
  primary_goal: |
    사용자가 ObjectType을 정의할 때 Claude와 상호작용하며
    의사결정을 내릴 수 있는 체계적 워크플로우 구축

  key_decisions:
    - id: REQ-001
      area: "전체 워크플로우"
      requirement: "모든 단계가 빠짐없이 안내되어야 함"
      detail: "Phase 1(Context) → 2(Entity) → 3(Link) → 4(Validation) 순차 진행"
      priority: P0-CRITICAL

    - id: REQ-002
      area: "Primary Key 전략"
      requirement: "single_column / composite / composite_hashed 선택 가이드"
      detail: "각 전략의 장단점 + Palantir 권장사항 + 선택 근거 제공"
      priority: P0-CRITICAL

    - id: REQ-003
      area: "Property 타입/제약"
      requirement: "DataType 매핑 + required/unique/nullable 상세 설정"
      detail: "20개 DataType 전체 지원, 타입별 제약조건 가이드"
      priority: P0-CRITICAL

    - id: REQ-004
      area: "Relationship 설계"
      requirement: "Cardinality 결정 + Link 구현 방식 선택"
      detail: "1:1, 1:N, N:1, M:N 각각의 FK/JoinTable 구현 가이드"
      priority: P0-CRITICAL

    - id: REQ-005
      area: "설명 수준"
      requirement: "상세 분석 - Ontology Integrity 관점 전체 분석"
      detail: "/ontology-why 강화, 실제 Palantir 문서 검색 + 사례 제공"
      priority: P1-HIGH

    - id: REQ-006
      area: "출력 형식"
      requirement: "YAML 정의 + Semantic Integrity 검증"
      detail: "코드 생성 없이 YAML만, 단 Semantic 무결성 필수 검증"
      priority: P0-CRITICAL

# ============================================================================
# 2. REFERENCE DOCUMENTS
# ============================================================================

references:
  primary:
    - path: "/home/palantir/park-kyungchan/palantir/docs/ObjectType_Reference.md"
      purpose: "목표 아키텍처 + 스키마 정의"
      key_sections:
        - "Interactive Q&A Decision Tree"
        - "Validation Gates at each workflow stage"
        - "ontology-objecttype.schema.yaml"
        - "Bilingual support (ko/en)"

  implementation:
    - path: "/home/palantir/park-kyungchan/palantir/Ontology-Definition/"
      purpose: "Python 구현 참조"
      key_files:
        - "ontology_definition/types/object_type.py"
        - "ontology_definition/types/property_def.py"
        - "ontology_definition/core/enums.py"

  existing_skills:
    - path: ".claude/skills/ontology-objecttype/SKILL.md"
      version: "1.1.0"
      status: "강화 대상"

    - path: ".claude/skills/ontology-why/SKILL.md"
      version: "1.0.0"
      status: "강화 대상"

    - path: ".claude/skills/ontology-core/SKILL.md"
      version: "1.0.0"
      status: "유지"

# ============================================================================
# 3. GAP ANALYSIS
# ============================================================================

gap_analysis:
  - id: GAP-001
    category: "Interactive Decision Tree"
    current: "L1→L2→L3 단순 진행"
    target: "Phase 1→2→3→4 체계적 질문 + 의사결정"
    impact: HIGH
    remediation: |
      ontology-objecttype SKILL.md에 Decision Tree 워크플로우 추가:
      - Phase 1: Context Clarification (소스 타입, 도메인)
      - Phase 2: Entity Discovery (후보 추출, PK 전략 선택)
      - Phase 3: Link Definition (Cardinality, 구현 방식)
      - Phase 4: Validation & Output (Gate 검증, YAML 생성)

  - id: GAP-002
    category: "Primary Key Strategy Selection"
    current: "자동 감지만"
    target: "사용자 선택 + 근거 제공"
    impact: HIGH
    remediation: |
      AskUserQuestion 기반 PK 전략 선택 UI:
      Q: Primary Key Strategy?
        [a] Single existing column
        [b] Composite key → components 입력
        [c] Composite + SHA256 hash
      + 각 선택의 장단점 + Palantir 권장사항 제공

  - id: GAP-003
    category: "Cardinality Decision Guide"
    current: "FK 감지만"
    target: "상세 의사결정 가이드"
    impact: MEDIUM
    remediation: |
      Cardinality Decision Tree 추가:
      - 1:1 → FK on either side
      - 1:N / N:1 → FK on "many" side
      - M:N → JOIN TABLE required
      + Object-Backed Link 옵션 안내

  - id: GAP-004
    category: "Validation Gates"
    current: "규칙 목록만"
    target: "Stage별 자동 검증"
    impact: HIGH
    remediation: |
      각 Phase 종료 시 Validation Gate 실행:
      - Phase 1 Gate: source_validity
      - Phase 2 Gate: candidate_extraction, pk_determinism
      - Phase 3 Gate: link_integrity
      - Phase 4 Gate: semantic_consistency

  - id: GAP-005
    category: "Ontology Integrity Explanation"
    current: "/ontology-why 형식만"
    target: "실제 Palantir 문서 검색 + 상세 분석"
    impact: HIGH
    remediation: |
      /ontology-why 강화:
      - WebSearch로 실제 Palantir 문서 검색
      - Context7 MCP로 공식 문서 쿼리
      - 5가지 Integrity 관점 분석:
        1. Immutability
        2. Determinism
        3. Referential Integrity
        4. Semantic Consistency
        5. Lifecycle Management

  - id: GAP-006
    category: "YAML Schema Output"
    current: "Python scaffold만"
    target: "YAML 정의 + Semantic 검증"
    impact: MEDIUM
    remediation: |
      출력 형식을 YAML로 변경:
      - ontology-objecttype.schema.yaml 기반
      - L1/L2/L3 Progressive Disclosure
      - Semantic Integrity 검증 Gate 추가

  - id: GAP-007
    category: "Bilingual Support"
    current: "없음"
    target: "ko/en 완전 분리"
    impact: LOW
    remediation: |
      locales/ko.yaml, locales/en.yaml 분리:
      - 모든 프롬프트 메시지
      - 검증 오류 메시지
      - 선택지 텍스트

# ============================================================================
# 4. DESIGN DECISIONS
# ============================================================================

design_decisions:
  - id: DD-001
    decision: "Phase 기반 워크플로우 채택"
    rationale: |
      ObjectType_Reference.md의 4단계 워크플로우가
      의사결정 흐름을 체계적으로 안내하는 데 최적
    alternatives:
      - "단일 프롬프트 방식" - rejected (복잡도 높음)
      - "자유 형식 대화" - rejected (일관성 부족)

  - id: DD-002
    decision: "YAML 출력 형식 채택 (코드 생성 제외)"
    rationale: |
      사용자 요구: YAML 정의만 필요
      + Semantic Integrity 검증에 YAML이 적합
    output_schema: "ontology-objecttype.schema.yaml"

  - id: DD-003
    decision: "/ontology-why를 Helper Skill로 강화"
    rationale: |
      상세 분석 요구에 맞춰 독립 헬퍼로 분리,
      다른 ontology-* 스킬에서 호출 가능하게 구성

  - id: DD-004
    decision: "Validation Gate를 PreToolUse Hook으로 구현"
    rationale: |
      Shift-Left 원칙에 따라 Write 전에 검증,
      잘못된 정의가 저장되기 전 차단

# ============================================================================
# 5. IMPLEMENTATION SCOPE
# ============================================================================

implementation_scope:
  in_scope:
    - "/ontology-objecttype SKILL.md 전면 개편"
    - "/ontology-why SKILL.md 강화"
    - "Decision Tree 워크플로우 추가"
    - "Validation Gate 규칙 정의"
    - "YAML 스키마 출력 형식"
    - "Semantic Integrity 검증"

  out_of_scope:
    - "PySpark Pipeline 코드 생성"
    - "TypeScript OSDK 클라이언트 생성"
    - "실제 Hook 스크립트 구현 (별도 작업)"
    - "locales/*.yaml 파일 생성 (Phase 2)"

  dependencies:
    - "ontology-definition 패키지 (로컬)"
    - "ObjectType_Reference.md 스키마"
    - "Context7 MCP (Palantir 문서 검색)"

# ============================================================================
# 6. SUCCESS CRITERIA
# ============================================================================

success_criteria:
  - id: SC-001
    criterion: "Phase 1→4 전체 워크플로우 완료 가능"
    verification: "테스트 시나리오로 Employee ObjectType 정의"

  - id: SC-002
    criterion: "PK 전략 선택 시 3가지 옵션 + 근거 제공"
    verification: "single/composite/hashed 각각 선택 테스트"

  - id: SC-003
    criterion: "Cardinality 결정 시 가이드 제공"
    verification: "1:N, M:N 관계 설정 시나리오 테스트"

  - id: SC-004
    criterion: "왜? 질문에 상세 Integrity 분석 제공"
    verification: "PK String 이유 질문 시 5가지 관점 분석"

  - id: SC-005
    criterion: "YAML 출력 + Semantic 검증 통과"
    verification: "생성된 YAML이 스키마 검증 통과"

# ============================================================================
# 7. NEXT STEPS
# ============================================================================

next_steps:
  - phase: "/research"
    action: "기존 스킬 구조 심층 분석 + Reference 문서 상세 매핑"

  - phase: "/planning"
    action: "SKILL.md 수정 계획 + Validation Gate 규칙 설계"

  - phase: "/orchestrate"
    action: "Task 분해 (ontology-objecttype, ontology-why)"

  - phase: "Implementation"
    action: "SKILL.md 파일 수정 + 테스트"
