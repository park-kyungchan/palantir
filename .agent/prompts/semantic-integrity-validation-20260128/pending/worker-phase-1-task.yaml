# =============================================================================
# Worker Task: Phase 1 - Semantic Integrity Shared Module
# =============================================================================
# Location: .agent/prompts/semantic-integrity-validation-20260128/pending/
# =============================================================================

taskId: "phase1-shared-module"
nativeTaskId: "9"
assignedTo: "unassigned"
orchestrator: "orchestrate"
createdAt: "2026-01-28T19:55:00+09:00"

# =============================================================================
# CONTEXT REFERENCE
# =============================================================================
workload_id: "semantic_integrity_validation_20260128_193000"
contextFile: ".agent/prompts/semantic-integrity-validation-20260128/_context.yaml"
progressFile: ".agent/prompts/semantic-integrity-validation-20260128/_progress.yaml"

# =============================================================================
# MY SCOPE
# =============================================================================
scope:
  phaseId: "phase1-shared-module"
  phaseName: "Semantic Integrity Shared Module"
  description: |
    SHA256 해시 계산, 검증, manifest 생성을 위한 공통 함수 모듈 생성.
    모든 스킬에서 재사용 가능한 형태로 설계.

# =============================================================================
# TARGET FILES (I can MODIFY these)
# =============================================================================
targetFiles:
  - path: ".claude/skills/shared/semantic-integrity.sh"
    action: "create"
    sections:
      - "compute_artifact_hash()"
      - "generate_worker_manifest()"
      - "verify_artifact_integrity()"
      - "verify_upstream_chain()"
      - "get_upstream_hash()"

# =============================================================================
# REFERENCE FILES (I can only READ these)
# =============================================================================
referenceFiles:
  - path: ".claude/skills/clarify/helpers.sh"
    reason: "yaml_compute_hash() 구현 참조 (line 381-386)"
  - path: ".claude/skills/shared/validation-feedback-loop.sh"
    reason: "P4/P5/P6 pattern functions for integration"

# =============================================================================
# DEPENDENCIES
# =============================================================================
dependencies: []
blockedBy: []
canStartImmediately: true

# =============================================================================
# COMPLETION CRITERIA
# =============================================================================
completionCriteria:
  required:
    - "compute_artifact_hash() 함수가 SHA256 해시 반환"
    - "generate_worker_manifest() 함수가 유효한 YAML manifest 생성"
    - "verify_artifact_integrity() 함수가 VERIFIED/TAMPERED/MISSING 상태 반환"
    - "verify_upstream_chain() 함수가 전체 파이프라인 체인 검증"

  verification:
    - command: "source .claude/skills/shared/semantic-integrity.sh && type compute_artifact_hash"
      expected: "function"
    - command: "echo 'test' > /tmp/test.txt && source .claude/skills/shared/semantic-integrity.sh && compute_artifact_hash /tmp/test.txt"
      expected: "SHA256 hash string (64 characters)"

# =============================================================================
# IMPLEMENTATION GUIDANCE
# =============================================================================
implementationGuidance: |
  1. Reference .claude/skills/clarify/helpers.sh for yaml_compute_hash() pattern
  2. Use sha256sum for hash computation
  3. Output manifest in YAML format with:
     - worker_id
     - completed_at (ISO 8601)
     - artifacts[] with path and sha256
     - context_hash (inherited from upstream)
  4. verify_artifact_integrity() should return:
     - "VERIFIED|" for matching hash
     - "TAMPERED|{files}" for mismatch
     - "MISSING|{files}" for not found
  5. verify_upstream_chain() should check:
     - clarify.yaml → research.md → plan.yaml → _context.yaml

# =============================================================================
# OUTPUT FORMAT
# =============================================================================
outputFormat: "L1/L2/L3"
l2OutputPath: ".agent/prompts/semantic-integrity-validation-20260128/outputs/phase1-output.md"

# =============================================================================
# ON COMPLETE
# =============================================================================
onComplete:
  - "TaskUpdate(taskId='9', status='completed')"
  - "Update _progress.yaml: phase1-shared-module.status = 'completed'"
  - "Report to Orchestrator with L1 summary"
  - "Notify phase2-worker-manifest that dependency is complete"
