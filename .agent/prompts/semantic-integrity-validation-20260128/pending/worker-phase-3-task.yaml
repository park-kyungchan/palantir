# =============================================================================
# Worker Task: Phase 3 - Replace /collect Phase 3-B
# =============================================================================

taskId: "phase3-collect-l3-replace"
nativeTaskId: "11"
assignedTo: "unassigned"
orchestrator: "orchestrate"
createdAt: "2026-01-28T19:55:00+09:00"

# =============================================================================
# CONTEXT REFERENCE
# =============================================================================
workload_id: "semantic_integrity_validation_20260128_193000"
contextFile: ".agent/prompts/semantic-integrity-validation-20260128/_context.yaml"
progressFile: ".agent/prompts/semantic-integrity-validation-20260128/_progress.yaml"

# =============================================================================
# MY SCOPE
# =============================================================================
scope:
  phaseId: "phase3-collect-l3-replace"
  phaseName: "Replace /collect Phase 3-B with Semantic Integrity"
  description: |
    /collect 스킬의 Phase 3-B (L3 Vertical Verification)를
    Semantic Integrity Validation으로 전면 교체.

    기존: 파일 존재 + 참조 확인
    신규: SHA256 해시 검증 + 체인 무결성

# =============================================================================
# TARGET FILES
# =============================================================================
targetFiles:
  - path: ".claude/skills/collect/SKILL.md"
    action: "modify"
    sections:
      - "Phase 3-B: generatePhase3BPrompt() 전면 교체"
      - "verifySemanticIntegrity() 함수 추가"
      - "aggregateL2L3Results()에 integrity 결과 통합"
      - "L2 Report에 semantic_integrity 섹션 추가"

# =============================================================================
# REFERENCE FILES
# =============================================================================
referenceFiles:
  - path: ".claude/skills/shared/semantic-integrity.sh"
    reason: "검증 함수 호출"
  - path: ".agent/prompts/enhanced-feedback-loop-pattern-20260127/plan-final.yaml"
    reason: "EFL Phase 3-B 패턴 참조"

# =============================================================================
# DEPENDENCIES
# =============================================================================
dependencies: ["phase1-shared-module", "phase2-worker-manifest"]
blockedBy: ["9", "10"]
canStartImmediately: false

waitCondition: |
  Check _progress.yaml
  If phase1-shared-module.status == 'completed' AND phase2-worker-manifest.status == 'completed', proceed
  Otherwise, wait

# =============================================================================
# COMPLETION CRITERIA
# =============================================================================
completionCriteria:
  required:
    - "Phase 3-B가 SHA256 해시 기반 검증 수행"
    - "VERIFIED/TAMPERED/MISSING/STALE 상태 분류"
    - "integrity_rate 계산 (verified / total)"
    - "chain_verification 결과 포함"
    - "L2 Report에 Semantic Integrity 섹션 출력"

  verification:
    - command: "grep -c 'semantic_integrity' .claude/skills/collect/SKILL.md"
      expected: ">= 5"
    - command: "grep 'verify_artifact_integrity\\|verify_upstream_chain' .claude/skills/collect/SKILL.md"
      expected: "Both functions referenced"

# =============================================================================
# OUTPUT FORMAT
# =============================================================================
outputFormat: "L1/L2/L3"
l2OutputPath: ".agent/prompts/semantic-integrity-validation-20260128/outputs/phase3-output.md"

# =============================================================================
# ON COMPLETE
# =============================================================================
onComplete:
  - "TaskUpdate(taskId='11', status='completed')"
  - "Update _progress.yaml: phase3-collect-l3-replace.status = 'completed'"
  - "Report to Orchestrator with L1 summary"
  - "Notify phase4-review-gate-enhance that dependency is complete"
