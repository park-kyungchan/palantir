# =============================================================================
# Worker Task: S2 - Quality Validation 수행
# =============================================================================
# Workload: cow-refactoring-20260126
# Native Task ID: 10
# =============================================================================

taskId: "S2"
nativeTaskId: "10"
assignedTo: "unassigned"
orchestrator: "Sub-Orchestrator (Terminal-B)"
createdAt: "2026-01-26T18:53:00+09:00"

# =============================================================================
# CONTEXT REFERENCE
# =============================================================================
workload_id: "cow-refactoring-20260126"
contextFile: ".agent/prompts/cow-refactoring-20260126/_context.yaml"
progressFile: ".agent/prompts/cow-refactoring-20260126/_progress.yaml"

# =============================================================================
# MY SCOPE
# =============================================================================
scope:
  phaseId: "S2"
  phaseName: "Quality Validation 수행"
  description: |
    코드 품질 검증:
    1. 타입 힌트 완비 여부
       - 모든 public 메서드에 타입 힌트 존재
       - Generic 타입 올바르게 사용
    2. 에러 처리 패턴 일관성
       - StageError 상속 계층 준수
       - try/except 블록 일관성
    3. 테스트 커버리지
       - 각 Stage별 테스트 파일 존재
       - 핵심 메서드 테스트 여부

# =============================================================================
# TARGET FILES (I can MODIFY these)
# =============================================================================
targetFiles:
  - path: ".agent/prompts/cow-refactoring-20260126/synthesis/synthesis_report.md"
    readOnly: false
    sections: ["2. Quality Metrics"]

# =============================================================================
# REFERENCE FILES (I can only READ these)
# =============================================================================
referenceFiles:
  - path: "cow/src/mathpix_pipeline/stages/base.py"
    reason: "에러 처리 패턴 기준"
  - path: "cow/tests/stages/test_text_parse_stage.py"
    reason: "Stage B 테스트 확인"
  - path: "cow/tests/stages/test_alignment_stage.py"
    reason: "Stage D 테스트 확인"
  - path: "cow/tests/stages/test_regeneration_stage.py"
    reason: "Stage F 테스트 확인"
  - path: "cow/tests/stages/test_human_review_stage.py"
    reason: "Stage G 테스트 확인"
  - path: "cow/tests/stages/test_export_stage.py"
    reason: "Stage H 테스트 확인"

# =============================================================================
# DEPENDENCIES
# =============================================================================
dependencies: ["S1"]
blockedBy: ["9"]
canStartImmediately: false

waitCondition: |
  Check _progress.yaml
  If S1.status == 'completed', proceed
  Otherwise, wait

# =============================================================================
# COMPLETION CRITERIA
# =============================================================================
completionCriteria:
  required:
    - "타입 힌트 완비 여부 검증 완료"
    - "에러 처리 패턴 일관성 검증 완료"
    - "테스트 커버리지 확인 완료"
    - "Quality Metrics 섹션 생성 완료"

# =============================================================================
# OUTPUT FORMAT
# =============================================================================
outputFormat: "L1/L2/L3"
outputPath: ".agent/prompts/cow-refactoring-20260126/synthesis/synthesis_report.md"

expectedOutputFormat: |
  ## 2. Quality Metrics

  ### 2.1 Type Hints
  | Stage | Public Methods | Typed | Coverage |
  |-------|----------------|-------|----------|
  | B     | 5              | 5     | 100%     |
  | ...   | ...            | ...   | ...      |

  ### 2.2 Error Handling
  - StageError 상속: ✅
  - 일관된 try/except 패턴: ✅

  ### 2.3 Test Coverage
  | Stage | Test File | Test Count |
  |-------|-----------|------------|
  | B     | test_text_parse_stage.py | 12 |
  | ...   | ... | ... |

# =============================================================================
# ON COMPLETE
# =============================================================================
onComplete:
  - "TaskUpdate(taskId='10', status='completed')"
  - "Update _progress.yaml: S2.status = 'completed'"
  - "Notify S3 that blocker resolved"
