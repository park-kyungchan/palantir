# =============================================================================
# Worker Task: Terminal-B - Shift Left Gates 1, 2, 5
# =============================================================================
# Read this file AFTER reading _context-shift-left-philosophy.yaml
# Location: .agent/prompts/pending/worker-terminal-b-shift-left-philosophy.yaml
# =============================================================================

assignedTo: "terminal-b"
orchestrator: "Terminal-A"
createdAt: "2026-01-25T16:40:00Z"
projectSlug: "shift-left-philosophy"

# =============================================================================
# CONTEXT REFERENCE
# =============================================================================
contextFile: ".agent/prompts/_context-shift-left-philosophy.yaml"
progressFile: ".agent/prompts/_progress-shift-left-philosophy.yaml"

# =============================================================================
# MY TASKS (2 tasks assigned)
# =============================================================================
myTasks:
  - taskId: "1"
    phaseId: "phase1-clarify-research-gates"
    name: "Gate 1-2 Integration: /clarify, /research"
    blockedBy: []
    canStartImmediately: true

  - taskId: "3"
    phaseId: "phase3-worker-gate"
    name: "Gate 5 Integration: /worker"
    blockedBy: ["1"]
    canStartImmediately: false

# =============================================================================
# TASK 1: Gate 1-2 Integration (CAN START IMMEDIATELY)
# =============================================================================
task1:
  nativeTaskId: "1"
  phaseId: "phase1-clarify-research-gates"
  name: "Gate 1-2 Integration: /clarify, /research"
  priority: "P0"

  description: |
    /clarify와 /research 스킬에 validation gates 통합.

    Gate 1 (/clarify):
    - Stop hook에서 validate_requirement_feasibility() 호출
    - Warning 시 사용자에게 알림 후 진행 허용
    - Error 시 추가 clarification 요청

    Gate 2 (/research):
    - Setup hook에서 validate_scope_access() 호출
    - Scope 경로 존재 여부 사전 검증
    - 접근 불가 시 조기 종료

  targetFiles:
    - path: ".claude/skills/clarify/SKILL.md"
      action: "modify"
      sections: ["hooks - add validation gate reference"]
    - path: ".claude/hooks/clarify-validate.sh"
      action: "create"
      template: |
        #!/bin/bash
        source .claude/skills/shared/validation-gates.sh
        validate_requirement_feasibility "$1"
    - path: ".claude/skills/research/SKILL.md"
      action: "modify"
      sections: ["hooks - add setup hook"]
    - path: ".claude/hooks/research-validate.sh"
      action: "create"
      template: |
        #!/bin/bash
        source .claude/skills/shared/validation-gates.sh
        validate_scope_access "$1"

  referenceFiles:
    - path: ".claude/skills/shared/validation-gates.sh"
      reason: "Gate 1, 2 함수 정의 확인"
    - path: ".claude/hooks/clarify-finalize.sh"
      reason: "기존 hook 패턴 참조"

  completionCriteria:
    - "/clarify hooks에 validation gate 참조 추가"
    - "clarify-validate.sh가 Gate 1 호출"
    - "/research에 Setup hook 추가"
    - "research-validate.sh가 Gate 2 호출"
    - "모든 hook 스크립트가 bash -n 통과"

  verificationSteps:
    - command: "bash -n .claude/hooks/clarify-validate.sh"
      expected: "exit 0"
    - command: "bash -n .claude/hooks/research-validate.sh"
      expected: "exit 0"

  onComplete:
    - "TaskUpdate(taskId='1', status='completed')"
    - "Task #3 (phase3-worker-gate) is now unblocked"
    - "Report L1 summary to Orchestrator"

# =============================================================================
# TASK 3: Gate 5 Integration (WAIT FOR TASK 1)
# =============================================================================
task3:
  nativeTaskId: "3"
  phaseId: "phase3-worker-gate"
  name: "Gate 5 Integration: /worker"
  priority: "P1"

  waitCondition: |
    Check TaskGet("1").status == "completed"
    Then proceed with this task

  description: |
    /worker 스킬에 pre-execution gate 통합.

    Gate 5 (/worker start):
    - Task 시작 전 pre_execution_gate() 호출
    - blockedBy 완료 여부 검증
    - Target file 접근 권한 검증
    - 실패 시 worker blocked 상태로 전환

  targetFiles:
    - path: ".claude/skills/worker/SKILL.md"
      action: "modify"
      sections: ["worker start - add pre-execution gate"]
    - path: ".claude/hooks/worker-preflight.sh"
      action: "create"
      template: |
        #!/bin/bash
        source .claude/skills/shared/validation-gates.sh
        pre_execution_gate "$1" "$2"

  referenceFiles:
    - path: ".claude/skills/shared/validation-gates.sh"
      reason: "Gate 5 함수 정의 확인"
    - path: ".claude/hooks/clarify-validate.sh"
      reason: "Task 1에서 생성한 패턴 참조"

  completionCriteria:
    - "/worker start에 pre-execution gate 추가"
    - "worker-preflight.sh가 Gate 5 호출"
    - "Gate 실패 시 명확한 에러 메시지 출력"

  verificationSteps:
    - command: "bash -n .claude/hooks/worker-preflight.sh"
      expected: "exit 0"

  onComplete:
    - "TaskUpdate(taskId='3', status='completed')"
    - "Task #5 (phase5-e2e-testing) 의존성 일부 해소"
    - "Report L1 summary to Orchestrator"

# =============================================================================
# EXECUTION SEQUENCE
# =============================================================================
executionSequence:
  - step: 1
    taskId: "1"
    action: "START IMMEDIATELY"
    blockedBy: []
  - step: 2
    taskId: "3"
    action: "Wait for Task #1, then start"
    blockedBy: ["1"]

# =============================================================================
# START COMMAND
# =============================================================================
startCommand: |
  /worker start terminal-b

# =============================================================================
# END OF WORKER PROMPT
# =============================================================================
