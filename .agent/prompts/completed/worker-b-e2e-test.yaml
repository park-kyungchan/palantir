# =============================================================================
# Worker Task: Terminal-B - E2E Verification Test
# =============================================================================
# Location: .agent/prompts/pending/worker-b-e2e-test.yaml
# Language: English (Machine-Readable)
# =============================================================================

taskId: "e2e-verification-test"
assignedTo: "Terminal-B"
orchestrator: "Terminal-A"
createdAt: "2026-01-24T01:25:00Z"
priority: "P0"

# =============================================================================
# CONTEXT
# =============================================================================
context:
  description: |
    All 3 phases are completed. Code is ready but needs E2E verification.
    This task validates the entire Session-Aware Worker Prompt System.

  completedPhases:
    - phase1: "session-start.sh - current_session.json creation"
    - phase2: "pd-task-interceptor.sh - prompt file generation"
    - phase3: "pd-task-processor.sh - lifecycle management"

# =============================================================================
# MY SCOPE
# =============================================================================
scope:
  phaseName: "E2E Verification Test"

  description: |
    Run a test Task subagent and verify the full pipeline:
    1. Session ID is read correctly
    2. Prompt file is created in pending/
    3. After completion, file moves to completed/
    4. Audit log is written

# =============================================================================
# TEST STEPS
# =============================================================================
testSteps:
  - step: 1
    action: "Run Task subagent"
    command: |
      Task(
        subagent_type="Explore",
        prompt="List files in .agent/prompts/ directory structure"
      )
    expected: "Task executes successfully"

  - step: 2
    action: "Check pending/ during execution"
    command: "ls -la .agent/prompts/pending/"
    expected: "YAML file with session prefix exists"

  - step: 3
    action: "Check completed/ after Task finishes"
    command: "ls -la .agent/prompts/completed/"
    expected: "YAML file moved from pending/"

  - step: 4
    action: "Check audit log"
    command: "cat .agent/logs/prompt_lifecycle.log"
    expected: "Log entry with timestamp, filename, sessionId"

# =============================================================================
# VERIFICATION CHECKLIST
# =============================================================================
verificationChecklist:
  - id: "V1"
    check: "current_session.json exists with valid sessionId"
    command: "cat ~/.agent/tmp/current_session.json"
    status: "pending"

  - id: "V2"
    check: "Prompt YAML created in pending/"
    command: "ls .agent/prompts/pending/*.yaml"
    status: "pending"

  - id: "V3"
    check: "Prompt YAML moved to completed/"
    command: "ls .agent/prompts/completed/*.yaml"
    status: "pending"

  - id: "V4"
    check: "Audit log contains entry"
    command: "cat .agent/logs/prompt_lifecycle.log"
    status: "pending"

# =============================================================================
# OUTPUT FORMAT
# =============================================================================
outputFormat: "L1/L2/L3"
l2OutputPath: ".agent/outputs/Explore/e2e-verification-test.md"

# =============================================================================
# ON COMPLETE
# =============================================================================
onComplete:
  - "Update verificationChecklist status for each item"
  - "Report results to Orchestrator (Terminal-A)"
  - "If all PASS: Project complete"
  - "If any FAIL: Report issue details for debugging"
