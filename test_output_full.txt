============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0 -- /home/palantir/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/palantir/orion-orchestrator-v2
configfile: pyproject.toml
plugins: asyncio-1.3.0, anyio-4.12.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 122 items

tests/aip_logic/test_logic_function.py::test_logic_engine_execution_flow PASSED [  0%]
tests/aip_logic/test_logic_function.py::test_custom_logic_function PASSED [  1%]
tests/data/test_pipeline.py::test_csv_to_json_pipeline PASSED            [  2%]
tests/data/test_pipeline.py::test_empty_source PASSED                    [  3%]
tests/data/test_pipeline.py::test_async_transform PASSED                 [  4%]
tests/e2e/test_e2e_golden_path.py::test_golden_path_data_to_action FAILED [  4%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_1_safe_action_executes_immediately PASSED [  5%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_2_hazardous_action_creates_proposal PASSED [  6%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_3_unknown_action_denied PASSED [  7%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_4_full_governance_workflow PASSED [  8%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_5_mixed_actions_workflow PASSED [  9%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_6_proposal_rejection_workflow PASSED [  9%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_7_audit_trail_verification PASSED [ 10%]
tests/e2e/test_full_integration.py::TestFullIntegrationWorkflow::test_scenario_8_concurrent_proposals PASSED [ 11%]
tests/e2e/test_full_integration.py::TestExecutionLogging::test_execution_log_populated PASSED [ 12%]
tests/e2e/test_full_integration.py::TestDatabaseIntegrity::test_wal_mode_enabled PASSED [ 13%]
tests/e2e/test_full_integration.py::TestDatabaseIntegrity::test_proposal_version_increments PASSED [ 13%]
tests/e2e/test_monolith.py::test_api_health PASSED                       [ 14%]
tests/e2e/test_monolith.py::test_static_root PASSED                      [ 15%]
tests/e2e/test_monolith.py::test_spa_routing PASSED                      [ 16%]
tests/e2e/test_monolith.py::test_api_not_found PASSED                    [ 17%]
tests/e2e/test_monolith.py::test_security_headers PASSED                 [ 18%]
tests/e2e/test_oda_v3_scenarios.py::TestOntologyObjectLifecycle::test_object_creation_generates_uuid PASSED [ 18%]
tests/e2e/test_oda_v3_scenarios.py::TestOntologyObjectLifecycle::test_object_audit_fields_populated PASSED [ 19%]
tests/e2e/test_oda_v3_scenarios.py::TestOntologyObjectLifecycle::test_touch_updates_version_and_timestamp PASSED [ 20%]
tests/e2e/test_oda_v3_scenarios.py::TestOntologyObjectLifecycle::test_soft_delete_sets_status PASSED [ 21%]
tests/e2e/test_oda_v3_scenarios.py::TestOntologyObjectLifecycle::test_archive_sets_status PASSED [ 22%]
tests/e2e/test_oda_v3_scenarios.py::TestLinkTypeDefinition::test_link_creation_with_cardinality PASSED [ 22%]
tests/e2e/test_oda_v3_scenarios.py::TestLinkTypeDefinition::test_link_type_id_validation PASSED [ 23%]
tests/e2e/test_oda_v3_scenarios.py::TestLinkTypeDefinition::test_all_cardinality_values PASSED [ 24%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_proposal_creation_defaults_to_draft PASSED [ 25%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_valid_transition_draft_to_pending PASSED [ 26%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_valid_transition_pending_to_approved PASSED [ 27%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_valid_transition_pending_to_rejected PASSED [ 27%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_valid_transition_approved_to_executed PASSED [ 28%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_invalid_transition_draft_to_approved PASSED [ 29%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_invalid_transition_rejected_to_approved PASSED [ 30%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_cancel_from_multiple_states PASSED [ 31%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_approve_requires_reviewer_id PASSED [ 31%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_reject_requires_reason PASSED [ 32%]
tests/e2e/test_oda_v3_scenarios.py::TestProposalStateMachine::test_audit_log_generation PASSED [ 33%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_required_field_passes PASSED [ 34%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_required_field_fails_empty PASSED [ 35%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_required_field_fails_missing PASSED [ 36%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_allowed_values_passes PASSED [ 36%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_allowed_values_fails PASSED [ 37%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_max_length_passes PASSED [ 38%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_max_length_fails PASSED [ 39%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_custom_validator_passes PASSED [ 40%]
tests/e2e/test_oda_v3_scenarios.py::TestSubmissionCriteria::test_custom_validator_fails PASSED [ 40%]
tests/e2e/test_oda_v3_scenarios.py::TestActionExecution::test_successful_execution PASSED [ 41%]
tests/e2e/test_oda_v3_scenarios.py::TestActionExecution::test_validation_failure PASSED [ 42%]
tests/e2e/test_oda_v3_scenarios.py::TestActionExecution::test_side_effects_execute_after_commit PASSED [ 43%]
tests/e2e/test_oda_v3_scenarios.py::TestActionExecution::test_side_effects_not_run_on_failure PASSED [ 44%]
tests/e2e/test_oda_v3_scenarios.py::TestActionRegistry::test_register_and_get PASSED [ 45%]
tests/e2e/test_oda_v3_scenarios.py::TestActionRegistry::test_list_actions PASSED [ 45%]
tests/e2e/test_oda_v3_scenarios.py::TestActionRegistry::test_get_hazardous_actions PASSED [ 46%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_simple_query_routes_local PASSED [ 47%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_critical_keyword_routes_relay PASSED [ 48%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_complex_query_routes_relay PASSED [ 49%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_explicit_local_marker PASSED [ 50%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_explicit_relay_marker PASSED [ 50%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_technical_terms_increase_complexity PASSED [ 51%]
tests/e2e/test_oda_v3_scenarios.py::TestHybridRouter::test_routing_decision_contains_metrics PASSED [ 52%]
tests/e2e/test_oda_v3_scenarios.py::TestRouterConfiguration::test_default_config PASSED [ 53%]
tests/e2e/test_oda_v3_scenarios.py::TestRouterConfiguration::test_config_from_json_file PASSED [ 54%]
tests/e2e/test_oda_v3_scenarios.py::TestRouterConfiguration::test_config_validation PASSED [ 54%]
tests/e2e/test_oda_v3_scenarios.py::TestRouterConfiguration::test_config_to_file PASSED [ 55%]
tests/e2e/test_oda_v3_scenarios.py::TestOllamaClient::test_health_check_mocked PASSED [ 56%]
tests/e2e/test_oda_v3_scenarios.py::TestOllamaClient::test_generate_mocked PASSED [ 57%]
tests/e2e/test_oda_v3_scenarios.py::TestConcurrentOperations::test_concurrent_proposal_submissions PASSED [ 58%]
tests/e2e/test_oda_v3_scenarios.py::TestConcurrentOperations::test_concurrent_object_creation PASSED [ 59%]
tests/e2e/test_oda_v3_scenarios.py::TestFullIntegration::test_full_governance_workflow PASSED [ 59%]
tests/e2e/test_proposal_repository.py::TestProposalCRUD::test_save_and_find_by_id PASSED [ 60%]
tests/e2e/test_proposal_repository.py::TestProposalCRUD::test_find_by_id_not_found PASSED [ 61%]
tests/e2e/test_proposal_repository.py::TestProposalCRUD::test_update_proposal PASSED [ 62%]
tests/e2e/test_proposal_repository.py::TestProposalCRUD::test_soft_delete PASSED [ 63%]
tests/e2e/test_proposal_repository.py::TestProposalCRUD::test_hard_delete PASSED [ 63%]
tests/e2e/test_proposal_repository.py::TestProposalCRUD::test_delete_not_found PASSED [ 64%]
tests/e2e/test_proposal_repository.py::TestOptimisticLocking::test_version_increment PASSED [ 65%]
tests/e2e/test_proposal_repository.py::TestOptimisticLocking::test_concurrent_modification_detected PASSED [ 66%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_find_by_status PASSED [ 67%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_find_pending_shortcut PASSED [ 68%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_find_by_action_type PASSED [ 68%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_find_by_creator PASSED [ 69%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_paginated_query PASSED [ 70%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_query_with_status_filter PASSED [ 71%]
tests/e2e/test_proposal_repository.py::TestProposalQueries::test_count_by_status PASSED [ 72%]
tests/e2e/test_proposal_repository.py::TestProposalHistory::test_history_on_create PASSED [ 72%]
tests/e2e/test_proposal_repository.py::TestProposalHistory::test_history_on_update PASSED [ 73%]
tests/e2e/test_proposal_repository.py::TestProposalHistory::test_get_with_history PASSED [ 74%]
tests/e2e/test_proposal_repository.py::TestProposalHistory::test_history_tracks_status_transitions PASSED [ 75%]
tests/e2e/test_proposal_repository.py::TestGovernanceHelpers::test_approve_pending_proposal PASSED [ 76%]
tests/e2e/test_proposal_repository.py::TestGovernanceHelpers::test_approve_not_found PASSED [ 77%]
tests/e2e/test_proposal_repository.py::TestGovernanceHelpers::test_approve_wrong_status PASSED [ 77%]
tests/e2e/test_proposal_repository.py::TestGovernanceHelpers::test_reject_pending_proposal PASSED [ 78%]
tests/e2e/test_proposal_repository.py::TestGovernanceHelpers::test_execute_approved_proposal PASSED [ 79%]
tests/e2e/test_proposal_repository.py::TestGovernanceHelpers::test_full_governance_workflow PASSED [ 80%]
tests/e2e/test_proposal_repository.py::TestBulkOperations::test_save_many PASSED [ 81%]
tests/e2e/test_proposal_repository.py::TestDatabase::test_wal_mode_enabled PASSED [ 81%]
tests/e2e/test_proposal_repository.py::TestDatabase::test_migrations_applied PASSED [ 82%]
tests/e2e/test_proposal_repository.py::TestDatabase::test_health_check PASSED [ 83%]
tests/e2e/test_proposal_repository.py::TestDatabase::test_transaction_rollback_on_error PASSED [ 84%]
tests/e2e/test_proposal_repository.py::TestConcurrentAccess::test_concurrent_reads PASSED [ 85%]
tests/e2e/test_proposal_repository.py::TestConcurrentAccess::test_concurrent_writes_different_proposals PASSED [ 86%]
tests/e2e/test_v3_full_stack.py::TestV3Migration::test_foundation_ontology PASSED [ 86%]
tests/e2e/test_v3_full_stack.py::TestV3Migration::test_hybrid_intelligence PASSED [ 87%]
tests/e2e/test_v3_full_stack.py::TestV3Migration::test_proposal_workflow PASSED [ 88%]
tests/e2e/test_v3_full_stack.py::TestV3Migration::test_relay_queue PASSED [ 89%]
tests/e2e/test_v3_full_stack.py::TestV3Migration::test_semantic_action PASSED [ 90%]
tests/e2e/test_v3_production.py::TestV3Migration::test_foundation_ontology PASSED [ 90%]
tests/e2e/test_v3_production.py::TestV3Migration::test_hybrid_intelligence PASSED [ 91%]
tests/e2e/test_v3_production.py::TestV3Migration::test_kernel_boot PASSED [ 92%]
tests/e2e/test_v3_production.py::TestV3Migration::test_proposal_workflow PASSED [ 93%]
tests/e2e/test_v3_production.py::TestV3Migration::test_relay_queue PASSED [ 94%]
tests/e2e/test_v3_production.py::TestV3Migration::test_semantic_action PASSED [ 95%]
tests/osdk/test_generator.py::test_generate_simple_query_class PASSED    [ 95%]
tests/osdk/test_generator.py::test_generate_multiple_objects PASSED      [ 96%]
tests/osdk/test_query_integration.py::test_object_query_execute_empty PASSED [ 97%]
tests/osdk/test_query_integration.py::test_object_query_filters PASSED   [ 98%]
tests/osdk/test_query_integration.py::test_object_query_sorting_paging PASSED [ 99%]
tests/test_result_schema.py::test_result_persistence PASSED              [100%]

=================================== FAILURES ===================================
_______________________ test_golden_path_data_to_action ________________________

self = <sqlalchemy.engine.base.Connection object at 0x7775fde69d90>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x7775fde13980>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x7775fde69fa0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7775fde69fd0>
parameters = [('t1', 'Fix Bug', 'Desc 1', 'High', 'Completed', '[]', ...), ('t2', 'Feature X', 'Desc 2', 'Low', 'In Progress', '[]', ...), ('t3', 'Critical Fix', 'Desc 3', 'High', 'Completed', '[]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,

../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1936: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:949: in do_executemany
    cursor.executemany(statement, parameters)
../.venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:195: in executemany
    self._adapt_connection._handle_exception(error)
../.venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:340: in _handle_exception
    raise error
../.venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:189: in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
../.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/aiosqlite/cursor.py:47: in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
../.venv/lib/python3.12/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/aiosqlite/core.py:133: in _execute
    return await future
           ^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x7775fde45210>

    def _connection_worker_thread(
        tx: SimpleQueue[tuple[asyncio.Future, Callable[[], Any]]],
    ):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            tx_item = tx.get()
            future, function = tx_item
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
                         ^^^^^^^^^^
E               sqlite3.IntegrityError: NOT NULL constraint failed: tasks.status

../.venv/lib/python3.12/site-packages/aiosqlite/core.py:65: IntegrityError

The above exception was the direct cause of the following exception:

tmp_path = PosixPath('/tmp/pytest-of-palantir/pytest-17/test_golden_path_data_to_actio0')

    @pytest.mark.asyncio
    async def test_golden_path_data_to_action(tmp_path):
        """
        Golden Path Scenario:
        1. Ingest Data (CSV -> DB)
        2. Read Data (OSDK Query)
        3. Analyze (AIP Logic)
        4. Propose Action (Governance)
        5. Execute Action (Kernel)
        """
    
        # 0. Setup Infrastructure
        db_path = tmp_path / "test.db"
        db_url = f"sqlite+aiosqlite:///{db_path}"
    
        # Initialize DB with Schema
        # We need to manually add TaskModel to Base.metadata or ensure it is imported
        from scripts.ontology.storage.models import Base
        # TaskModel is already defined above, ensuring it's in Base.registry
    
        # Setup Data Source File
        csv_file = tmp_path / "tasks.csv"
        with open(csv_file, "w") as f:
            writer = csv.writer(f)
            writer.writerow(["id", "title", "description", "priority", "task_status", "tags", "version", "created_at", "updated_at", "created_by"])
            writer.writerow(["t1", "Fix Bug", "Desc 1", "High", "Completed", "[]", 1, "2024-01-01T00:00:00", "2024-01-01T00:00:00", "system"])
            writer.writerow(["t2", "Feature X", "Desc 2", "Low", "In Progress", "[]", 1, "2024-01-01T00:00:00", "2024-01-01T00:00:00", "system"])
            writer.writerow(["t3", "Critical Fix", "Desc 3", "High", "Completed", "[]", 1, "2024-01-01T00:00:00", "2024-01-01T00:00:00", "system"])
    
        # 1. DATA INGESTION (ETL)
        # -------------------------------------------------------------------------
        db = Database(db_url)
/home/palantir/.venv/lib/python3.12/site-packages/_pytest/unraisableexception.py:67: PytestUnraisableExceptionWarning: Exception ignored in: <function Connection.__del__ at 0x7775fde482c0>

Traceback (most recent call last):
  File "/home/palantir/.venv/lib/python3.12/site-packages/aiosqlite/core.py", line 429, in __del__
    self._stop_running()
  File "/home/palantir/.venv/lib/python3.12/site-packages/aiosqlite/core.py", line 101, in _stop_running
    future = asyncio.get_event_loop().create_future()
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/events.py", line 702, in get_event_loop
    raise RuntimeError('There is no current event loop in thread %r.'
RuntimeError: There is no current event loop in thread 'MainThread'.

Enable tracemalloc to get traceback where the object was allocated.
See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.
  warnings.warn(pytest.PytestUnraisableExceptionWarning(msg))
        await db.initialize()
    
        # Create tables including 'tasks'
        async with db.engine.begin() as conn:
            await conn.run_sync(Base.metadata.create_all)
    
        pipeline = DataPipeline("task_ingest") \
            .extract(CSVDataSource(str(csv_file))) \
            .load(SQLAlchemyDataSource(db, table="tasks"))
    
>       await pipeline.execute()

tests/e2e/test_e2e_golden_path.py:107: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
scripts/data/pipeline.py:58: in execute
    await sink.write(data)
scripts/data/database.py:65: in write
    await session.execute(stmt, data)
../.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
../.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
../.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
../.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1936: in _exec_single_context
    self.dialect.do_executemany(
../.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:949: in do_executemany
    cursor.executemany(statement, parameters)
../.venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:195: in executemany
    self._adapt_connection._handle_exception(error)
../.venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:340: in _handle_exception
    raise error
../.venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:189: in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
../.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/aiosqlite/cursor.py:47: in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
../.venv/lib/python3.12/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../.venv/lib/python3.12/site-packages/aiosqlite/core.py:133: in _execute
    return await future
           ^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x7775fde45210>

    def _connection_worker_thread(
        tx: SimpleQueue[tuple[asyncio.Future, Callable[[], Any]]],
    ):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            tx_item = tx.get()
            future, function = tx_item
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
                         ^^^^^^^^^^
E               sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: tasks.status
E               [SQL: INSERT INTO tasks (id, title, description, priority, task_status, tags, version, created_at, updated_at, created_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E               [parameters: [('t1', 'Fix Bug', 'Desc 1', 'High', 'Completed', '[]', '1', '2024-01-01T00:00:00', '2024-01-01T00:00:00', 'system'), ('t2', 'Feature X', 'Desc 2', 'Low', 'In Progress', '[]', '1', '2024-01-01T00:00:00', '2024-01-01T00:00:00', 'system'), ('t3', 'Critical Fix', 'Desc 3', 'High', 'Completed', '[]', '1', '2024-01-01T00:00:00', '2024-01-01T00:00:00', 'system')]]
E               (Background on this error at: https://sqlalche.me/e/20/gkpj)

../.venv/lib/python3.12/site-packages/aiosqlite/core.py:65: IntegrityError
=============================== warnings summary ===============================
scripts/ontology/ontology_types.py:222
  /home/palantir/orion-orchestrator-v2/scripts/ontology/ontology_types.py:222: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class OntologyObject(BaseModel):

scripts/ontology/objects/task_actions.py:78
  /home/palantir/orion-orchestrator-v2/scripts/ontology/objects/task_actions.py:78: UserWarning: Field name "is_active" in "Agent" shadows an attribute in parent "OntologyObject"
    class Agent(OntologyObject):

tests/test_result_schema.py:7
  /home/palantir/orion-orchestrator-v2/tests/test_result_schema.py:7: DeprecationWarning: ObjectManager is deprecated. Use Repository pattern (ActionLogRepository, etc.) instead. See scripts/ontology/storage/repositories.py for the new API.
    from scripts.ontology.manager import ObjectManager

tests/e2e/test_oda_v3_scenarios.py: 8 warnings
tests/e2e/test_v3_full_stack.py: 2 warnings
tests/e2e/test_v3_production.py: 2 warnings
  <string>:8: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/e2e/test_e2e_golden_path.py::test_golden_path_data_to_action - s...
================== 1 failed, 121 passed, 15 warnings in 5.23s ==================
