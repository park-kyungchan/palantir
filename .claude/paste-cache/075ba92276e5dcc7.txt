• {
    "schema": "orion_oda_risk_register/v1",
    "generated_at": "2026-01-10",
    "scope": {
      "project_root": "park-kyungchan/palantir",
      "focus": "Orion Framework / ODA v3 architecture risks",
      "analysis_method": "static repository inspection (no execution)"
    },
    "scales": {
      "severity": ["critical", "high", "medium", "low"],
      "likelihood": ["high", "medium", "low"],
      "confidence": ["high", "medium", "low"]
    },
    "risks": [
      {
        "id": "ODA-RISK-001",
        "title": "Python 패키징이 core(lib/oda)를 포함하지 않을 가능성",
        "category": "deployment.packaging",
        "severity": "critical",
        "likelihood": "high",
        "confidence": "high",
        "summary": "패키지 빌드 시 setuptools가 scripts 계열만 포함하도록 설정되어 있어, 깨끗한 환경(컨테이너/CI/pip 설치)에서 핵심 런타임
  (lib/oda) 누락 위험이 큼.",
        "impact": [
          "컨테이너/CI에서 import 실패로 서비스 기동 불가",
          "sys.path 조작/심볼릭 링크에 의존하는 구조가 고착되어 이식성/재현성 저하"
        ],
        "scenarios": [
          "wheel/sdist 설치 후 `uvicorn scripts.api.main:app` 실행 시 `lib.oda` 관련 ModuleNotFoundError",
          "의도치 않은 경로 우선순위로 모듈 shadowing(동명이 패키지/파일) 발생"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/pyproject.toml:20",
            "note": "setuptools find_packages include가 scripts*로 제한"
          },
          {
            "ref": "park-kyungchan/palantir/scripts/orion:1",
            "note": "CWD를 sys.path에 추가해 런타임 경로 문제를 우회"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "code_change",
            "summary": "`lib/oda`를 정식 Python 패키지로 포함하고 entrypoint를 sys.path 해킹 없이 동작하도록 정리",
            "targets": [
              "park-kyungchan/palantir/pyproject.toml:20",
              "park-kyungchan/palantir/scripts/orion:1"
            ],
            "steps": [
              "패키지 디렉터리 구조를 표준(package_dir/namespace)로 정리",
              "빌드 결과물에 `lib/oda` 포함 여부를 CI에서 검증",
              "sys.path 조작을 제거하고 console_script entrypoint로 대체"
            ]
          }
        ],
        "verification": [
          {
            "type": "command",
            "cmd": "python -c \"import lib.oda; import scripts\"",
            "expected": "ImportError 없이 성공"
          }
        ]
      },
      {
        "id": "ODA-RISK-002",
        "title": "Docker 이미지가 핵심 코드/프론트엔드 경로를 충족하지 못해 런타임이 깨질 위험",
        "category": "deployment.container",
        "severity": "critical",
        "likelihood": "high",
        "confidence": "high",
        "summary": "Dockerfile이 `scripts/`와 `data/`만 복사하고(core `lib/` 미포함), 동시에 `frontend/dist`를 복사/서빙하도록 가정함. 실제
  트리/패키징 구조와 불일치 시 컨테이너 기동 실패 가능성이 큼.",
        "impact": [
          "컨테이너에서 uvicorn 기동 실패(모듈/경로 누락)",
          "SPA 서빙 기능이 항상 503 또는 빌드 단계에서 실패",
          "샌드박스/프로덕션 이미지가 동일 repo 상태에서 재현되지 않음"
        ],
        "scenarios": [
          "컨테이너 내 `scripts.api.main` import가 symlink/경로 의존으로 실패",
          "빌드 컨텍스트에 `frontend/dist`가 없어 Docker build 실패 또는 런타임 503"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/Dockerfile:46",
            "note": "backend code로 scripts/만 복사"
          },
          {
            "ref": "park-kyungchan/palantir/Dockerfile:52",
            "note": "frontend/dist 복사를 강제"
          },
          {
            "ref": "park-kyungchan/palantir/Dockerfile:70",
            "note": "엔트리포인트가 `scripts.api.main:app`"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/api/main.py:95",
            "note": "frontend/dist 기반 SPA 서빙을 가정"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "code_change",
            "summary": "컨테이너 기준으로 필요한 코드/자산을 명시적으로 포함하고, frontend는 옵션화하거나 빌드 파이프라인을 일치시킴",
            "targets": [
              "park-kyungchan/palantir/Dockerfile:41",
              "park-kyungchan/palantir/lib/oda/api/main.py:87"
            ],
            "steps": [
              "Dockerfile에 `lib/`(또는 정식 패키지 설치) 포함",
              "`frontend/dist`가 없을 때도 빌드가 성공하도록 조건화(또는 실제 frontend 추가)",
              "컨테이너 환경에서 DB 경로/agent 경로를 env로 주입"
            ]
          }
        ],
        "verification": [
          {
            "type": "command",
            "cmd": "docker build -t orion-oda:local park-kyungchan/palantir",
            "expected": "빌드 성공"
          },
          {
            "type": "command",
            "cmd": "docker run --rm -p 8000:8000 orion-oda:local",
            "expected": "/health가 200 OK"
          }
        ]
      },
      {
        "id": "ODA-RISK-003",
        "title": "샌드박스(docker-compose) 설정 드리프트 및 격리 약화(seccomp unconfined)",
        "category": "security.sandbox",
        "severity": "high",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "샌드박스 compose가 코드 마운트 대상 경로를 비정상적으로 지정하고(seccomp 비활성화 포함), 네트워크/볼륨 정책이 실제 코드
  구조와 불일치할 수 있음.",
        "impact": [
          "샌드박스가 실제 실행 코드를 포함하지 못해 '보안 우회' 목적을 달성하지 못함",
          "seccomp:unconfined로 인해 컨테이너 격리 강도가 크게 저하",
          "네트워크 허용 프로파일이 외부 의존을 무의식적으로 활성화할 위험"
        ],
        "scenarios": [
          "샌드박스 컨테이너에서 `/app/lib/oda`에 `./scripts`를 마운트하여 import/실행 경로가 붕괴",
          "보안 검증이 '샌드박스에서 돌렸으니 안전'이라는 잘못된 확신으로 전이"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/docker-compose.sandbox.yml:31",
            "note": "source ./scripts 를 target /app/lib/oda 로 바인드 마운트"
          },
          {
            "ref": "park-kyungchan/palantir/docker-compose.sandbox.yml:59",
            "note": "seccomp:unconfined"
          },
          {
            "ref": "park-kyungchan/palantir/docker-compose.sandbox.yml:108",
            "note": "네트워크 허용(sandbox-networked) 프로파일 제공"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "config_change",
            "summary": "샌드박스 마운트/보안 옵션을 실제 코드 구조와 일치시키고 seccomp를 기본값 또는 커스텀 프로파일로 강화",
            "targets": [
              "park-kyungchan/palantir/docker-compose.sandbox.yml:29"
            ],
            "steps": [
              "코드 마운트 대상 경로를 `/app/scripts` 또는 정식 패키지 설치 경로로 정렬",
              "`seccomp:unconfined` 제거(가능하면 기본 seccomp 적용)",
              "네트워크 프로파일은 명시적 opt-in + 감사로그 남기기"
            ]
          }
        ],
        "verification": [
          {
            "type": "command",
            "cmd": "docker compose -f park-kyungchan/palantir/docker-compose.sandbox.yml config",
            "expected": "마운트/보안 옵션이 의도대로 렌더링"
          }
        ]
      },
      {
        "id": "ODA-RISK-004",
        "title": "절대경로(/home/palantir/...) 하드코딩으로 이식성/재현성 저하",
        "category": "reliability.portability",
        "severity": "high",
        "likelihood": "high",
        "confidence": "high",
        "summary": "워크스페이스/DB/agent/workflow 경로가 다수의 모듈에서 `/home/palantir/...`로 고정되어 컨테이너, 다른 사용자 계정, 다른
  OS에서 실패 가능성이 큼.",
        "impact": [
          "경로가 존재하지 않거나 권한이 없어 런타임 실패",
          "테스트/운영 환경에서 상태 파일(.agent) 위치가 달라져 디버깅 난이도 증가"
        ],
        "scenarios": [
          "컨테이너 내 기본 DB 경로가 호스트 전용이라 init 실패",
          "다른 사용자 홈에서 `.agent` 경로가 어긋나 계획/메모리/로그가 분산"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/storage/database.py:220",
            "note": "default_path가 /home/palantir/... 로 하드코딩"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/workflow_runner.py:11",
            "note": "WORKFLOWS_DIR 절대경로"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/planning_hook.py:26",
            "note": "PROJECT_LEVEL_AGENT 절대경로"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/memory_sync.py:13",
            "note": "ORION_MEMORY 절대경로"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/lifecycle_manager.py:13",
            "note": "AGENTS_ROOT 절대경로"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/claude/sandbox_runner.py:71",
            "note": "workspace_root 절대경로"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/llm/config.py:64",
            "note": "WORKSPACE_ROOT 기본값 /home/palantir"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/mcp_manager.py:50",
            "note": "WORKSPACE_ROOT 기본값 /home/palantir"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "refactor",
            "summary": "경로 결정을 단일 모듈(예: `lib.oda.paths`)로 중앙화하고 env/CLI 플래그 기반으로 주입",
            "steps": [
              "ORION_WORKSPACE_ROOT/ORION_DB_PATH/ORION_AGENT_ROOT를 공식 설정으로 문서화",
              "절대경로 상수를 제거하고 `Path.home()` 또는 프로젝트 루트 기준 상대경로로 전환",
              "컨테이너에서는 /app 기준으로 동작하도록 기본값 변경"
            ]
          }
        ],
        "verification": [
          {
            "type": "command",
            "cmd": "ORION_WORKSPACE_ROOT=/tmp/orion python -c \"from lib.oda.ontology.storage.database import initialize_database; import
  asyncio; asyncio.run(initialize_database())\"",
            "expected": "/tmp/orion 기준으로 DB 초기화 가능(권한/경로 오류 없음)"
          }
        ]
      },
      {
        "id": "ODA-RISK-005",
        "title": "agent 상태 디렉터리(.agent)가 사용자/프로젝트 레벨로 혼재되어 상태 분산",
        "category": "operability.state",
        "severity": "medium",
        "likelihood": "high",
        "confidence": "high",
        "summary": "일부 로직은 `~/.agent`를, 일부는 `/home/palantir/.agent` 또는 프로젝트 내부 `.agent`를 사용하여 계획/로그/메모리의 단일
  진실원이 붕괴될 수 있음.",
        "impact": [
          "플랜 게이트가 다른 위치의 plan을 보고 통과/차단이 엇갈림",
          "메모리/로그가 여러 위치에 생겨 추적/감사 난이도 상승"
        ],
        "scenarios": [
          "PlanningHook은 `~/.agent/plans`를 보는데 MemorySync는 프로젝트 `.agent/memory`에 기록",
          "LifecycleManager가 `/home/palantir/.agent/plans`만 정리해 실제 사용되는 plan이 남거나 반대로 삭제"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/planning_hook.py:20",
            "note": "USER_LEVEL_AGENT = Path.home() / .agent"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/planning_hook.py:26",
            "note": "PROJECT_LEVEL_AGENT = /home/palantir/.../.agent"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/memory_sync.py:13",
            "note": "프로젝트 내부 .agent/memory로 고정"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/lifecycle_manager.py:13",
            "note": "AGENTS_ROOT = /home/palantir/.agent"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "design_decision",
            "summary": "단일 agent root 정책(사용자 레벨 vs 프로젝트 레벨)을 결정하고 전 모듈에 강제",
            "steps": [
              "우선순위 규칙을 명문화(예: env > 프로젝트 .agent > 사용자 .agent)",
              "중앙 경로 모듈에서만 `.agent` 경로를 계산하도록 변경",
              "마이그레이션/정리 스크립트 제공(기존 상태 이동)"
            ]
          }
        ],
        "verification": [
          {
            "type": "checklist",
            "items": [
              "plan/log/memory/artifacts가 한 루트에만 생성되는지 확인",
              "ORION_WORKSPACE_ROOT 변경 시 상태 경로가 일관되게 따라가는지 확인"
            ]
          }
        ]
      },
      {
        "id": "ODA-RISK-006",
        "title": "sys.path 조작(CWD 포함)으로 import hijacking/모듈 shadowing 위험",
        "category": "security.runtime",
        "severity": "high",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "엔트리포인트/커널이 sys.path에 CWD 또는 계산된 루트를 삽입하여, 실행 위치/파일 배치에 따라 임의 모듈이 우선 로드될 수 있
  음.",
        "impact": [
          "로컬 악성 파일(동명 모듈)로 코드 실행 흐름이 바뀔 위험",
          "재현성 저하(어떤 디렉터리에서 실행했는지에 따라 동작 상이)"
        ],
        "scenarios": [
          "작업 디렉터리에 `lib.py`/`scripts.py` 등 동명 파일 존재 시 import가 오염",
          "ORION_PROJECT_ROOT 환경변수로 예기치 않은 경로를 주입"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/scripts/orion:1",
            "note": "sys.path.append(os.getcwd())"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/kernel.py:8",
            "note": "ORION_PROJECT_ROOT fallback을 sys.path에 insert"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "hardening",
            "summary": "정식 패키징/entrypoint로 sys.path 조작 제거, 필요 시 허용 경로를 화이트리스트로 제한",
            "steps": [
              "console_script로 실행 진입점 제공",
              "ORION_PROJECT_ROOT가 프로젝트 루트 하위인지 검증",
              "CWD 추가 로직 제거"
            ]
          }
        ],
        "verification": [
          {
            "type": "test",
            "description": "CWD에 동명 모듈을 만들어도 import가 오염되지 않는지 테스트"
          }
        ]
      },
      {
        "id": "ODA-RISK-007",
        "title": "거버넌스(Action Mandate) 원칙을 우회하는 직접 파일쓰기/프로세스 실행 경로가 다수 존재",
        "category": "compliance.governance",
        "severity": "high",
        "likelihood": "high",
        "confidence": "high",
        "summary": "아키텍처 원칙상 상태 변경은 Action/Proposal 경유가 목표이나, 실제 구현에는 write_text/shutil/subprocess 등이 다수 존재하
  여 감사/승인 체인이 무력화될 수 있음.",
        "impact": [
          "감사 로그/승인 없이 상태가 변해 추적 불가",
          "샌드박스/프로덕션에서 예상치 못한 파일 변경",
          "보안 사고 시 책임 소재/재현 불가"
        ],
        "scenarios": [
          "PlanningHook이 `~/.agent/plans`를 직접 생성해 정책 밖의 상태가 생김",
          "WorkflowRunner가 마크다운에서 추출한 커맨드를 그대로 실행",
          "MemorySync가 시스템 메모리 파일을 직접 덮어써 원본 손상"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/planning_hook.py:173",
            "note": "plan_path.write_text로 직접 파일 생성"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/memory_sync.py:40",
            "note": "ORION_MEMORY.write_text로 직접 덮어쓰기"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/lifecycle_manager.py:89",
            "note": "shutil.move로 파일 이동(정리)"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/workflow_runner.py:94",
            "note": "bash -lc로 커맨드 실행"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "architecture_change",
            "summary": "파일/명령 실행을 Action으로 래핑하고, 위험도에 따라 Proposal-required로 분류",
            "steps": [
              "fs.write_file/fs.move_file/exec.run_command 등을 ActionType으로 정의",
              "API/Kernel/워크플로 모두 ToolMarshaler를 통해서만 실행되도록 제한",
              "직접 write/subprocess 경로를 점진적으로 제거(호환 레이어 제공)"
            ]
          }
        ],
        "verification": [
          {
            "type": "audit",
            "description": "상태 변경(파일쓰기/DB write)이 모두 ActionResult.edits 및 audit ledger에 남는지 확인"
          }
        ]
      },
      {
        "id": "ODA-RISK-008",
        "title": "거버넌스/프로토콜 검사가 ImportError 시 fail-open으로 동작",
        "category": "compliance.governance",
        "severity": "high",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "품질 게이트/프로토콜 프레임워크가 import 실패하면 검사를 건너뛰고 실행을 허용하는 경로가 존재하여, 배포 환경에서 모듈 누
  락 시 방어선이 사라질 수 있음.",
        "impact": [
          "의도한 안전장치가 환경 차이로 비활성화",
          "규칙 위반 액션이 프로덕션에서 실행될 가능성 증가"
        ],
        "scenarios": [
          "프로토콜 모듈이 누락된 이미지에서 `check_protocol_compliance`가 항상 허용",
          "QualityGate 모듈 누락 시 액션 등록 검증이 생략"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/actions/__init__.py:819",
            "note": "QualityGate import 실패 시 validation skip"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/actions/__init__.py:959",
            "note": "Protocol framework import 실패 시 ALLOW_IMMEDIATE"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/actions/__init__.py:915",
            "note": "dangerous param 차단이 단순 문자열 패턴 매칭"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "hardening",
            "summary": "프로덕션 모드에서는 거버넌스/프로토콜 모듈 누락 시 fail-closed(차단)로 전환",
            "steps": [
              "ORION_STRICT_GOVERNANCE=true 같은 플래그 도입",
              "ImportError 발생 시 BLOCK 또는 REQUIRE_PROPOSAL로 반환",
              "dangerous param 검사는 shell-escape/AST 파싱 기반으로 고도화"
            ]
          }
        ],
        "verification": [
          {
            "type": "test",
            "description": "거버넌스 모듈을 의도적으로 제거한 환경에서 위험 액션이 차단되는지 확인"
          }
        ]
      },
      {
        "id": "ODA-RISK-009",
        "title": "Declarative governance YAML 로더가 런타임에 연결되지 않은 정황(문서/코드 불일치)",
        "category": "maintainability.config",
        "severity": "medium",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "YAML 기반 거버넌스 로더 문서가 `registry.register_from_governance`를 언급하지만 실제 구현이 검색되지 않아, 설정이 '있는
  것처럼 보이지만 적용되지 않는' 위험이 있음.",
        "impact": [
          "운영자가 YAML 수정으로 정책이 바뀐다고 오인",
          "보안/승인 규칙이 코드와 설정 간 불일치로 drift"
        ],
        "scenarios": [
          "governance/actions.yaml 업데이트가 실제 실행 정책에 반영되지 않음"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/governance/loader.py:13",
            "note": "docstring이 register_from_governance 언급"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "implementation",
            "summary": "YAML 거버넌스를 실제 ActionRegistry/metadata에 주입하는 통합 경로를 구현하거나, 미사용이면 제거/명확화",
            "steps": [
              "ActionRegistry에 governance 로드/등록 API 추가 또는 startup 시 registry에 반영",
              "YAML 기반/코드 기반 정책 중 하나를 단일 소스로 채택",
              "문서/README에 실제 적용 경로를 명시"
            ]
          }
        ],
        "verification": [
          {
            "type": "test",
            "description": "YAML에서 requires_approval를 변경했을 때 API execute 엔드포인트의 차단 여부가 바뀌는지 확인"
          }
        ]
      },
      {
        "id": "ODA-RISK-010",
        "title": "API에 인증/인가가 없어 Proposal 승인·실행 흐름이 임의 호출에 노출될 위험",
        "category": "security.api",
        "severity": "critical",
        "likelihood": "high",
        "confidence": "high",
        "summary": "API가 사용자 인증 없이 proposal 생성/리뷰/실행을 제공하며 actor_id도 고정/사용자 제공 값에 의존함. 네트워크에 노출되면
  승인 체인이 붕괴될 수 있음.",
        "impact": [
          "임의 사용자가 proposal을 승인/거절하거나 비위험 액션을 실행",
          "감사 로그의 주체가 'api_user'로 고정되어 책임 추적 불가"
        ],
        "scenarios": [
          "공격자가 `POST /api/v1/proposals/{id}/review`로 승인 처리",
          "공격자가 `POST /api/v1/proposals/execute`로 allow된 액션을 반복 호출(DoS/데이터 오염)"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/api/routes.py:42",
            "note": "created_by가 'api_user'로 하드코딩(주석으로 auth 부재 인정)"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/api/routes.py:58",
            "note": "review 엔드포인트가 req.reviewer_id를 그대로 사용"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/api/routes.py:114",
            "note": "execute 엔드포인트 actor_id='api_user'"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "security_control",
            "summary": "API 인증/인가(RBAC) 도입 및 위험 엔드포인트 보호",
            "steps": [
              "Bearer token 또는 mTLS 기반 인증 추가",
              "review/execute는 관리자/리뷰어 역할만 허용",
              "actor_id는 인증 컨텍스트에서만 생성(요청 바디 입력 금지)",
              "rate limit 및 audit 강화"
            ]
          }
        ],
        "verification": [
          {
            "type": "test",
            "description": "인증 없는 요청이 401/403으로 차단되는지 확인"
          }
        ]
      },
      {
        "id": "ODA-RISK-011",
        "title": "API 글로벌 예외 핸들러가 내부 예외 문자열을 그대로 반환(정보 노출)",
        "category": "security.api",
        "severity": "medium",
        "likelihood": "high",
        "confidence": "high",
        "summary": "500 응답에 `details: str(exc)`를 포함해 내부 파일 경로/스택 정보/환경 정보를 노출할 수 있음.",
        "impact": [
          "정보 노출을 통한 공격 표면 확대(경로, 테이블명, 내부 상태 등)",
          "운영 환경에서 민감 정보 유출 가능"
        ],
        "scenarios": [
          "DB 경로/쿼리 오류 메시지가 API 응답으로 유출",
          "예외 메시지에 토큰/키 일부가 포함될 경우 노출"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/api/main.py:65",
            "note": "details에 str(exc) 포함(주석으로 prod에서 제거 권고)"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "hardening",
            "summary": "운영 모드에서는 details 제거 또는 trace_id만 반환",
            "steps": [
              "ORION_DEBUG=true일 때만 details 포함",
              "표준 에러 포맷 + correlation_id 로깅/반환"
            ]
          }
        ],
        "verification": [
          {
            "type": "test",
            "description": "의도적으로 예외를 발생시켰을 때 응답에 내부 메시지가 포함되지 않는지 확인"
          }
        ]
      },
      {
        "id": "ODA-RISK-012",
        "title": "DB 기본 경로 하드코딩 및 create_all 기반 스키마 관리로 운영 이슈 가능",
        "category": "data.persistence",
        "severity": "high",
        "likelihood": "high",
        "confidence": "high",
        "summary": "DB 경로가 호스트 전용 절대경로 기본값이며, ORM create_all로 스키마를 생성하는 방식은 장기 운영에서 마이그레이션/호환성
  이슈를 유발할 수 있음.",
        "impact": [
          "컨테이너/다른 환경에서 DB init 실패",
          "스키마 변경 시 데이터 마이그레이션 전략 부재",
          "동시성/락 문제(특히 SQLite)로 proposal 처리 지연/실패"
        ],
        "scenarios": [
          "운영에서 ORION_DB_PATH 미설정 시 잘못된 경로로 DB 생성/접근",
          "여러 프로세스가 SQLite DB에 접근하며 락/충돌 발생"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/ontology/storage/database.py:220",
            "note": "default_path 하드코딩"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "operational",
            "summary": "DB 경로를 필수 설정으로 격상하고(또는 프로젝트 상대 경로로 기본값 변경), 마이그레이션 도구 도입 검토",
            "steps": [
              "컨테이너/운영에서 ORION_DB_PATH를 반드시 설정",
              "기본값을 프로젝트 내 `data/ontology.db` 또는 `/app/data/...`로 변경",
              "장기 운영 시 Alembic 등 마이그레이션 도입 검토"
            ]
          }
        ],
        "verification": [
          {
            "type": "checklist",
            "items": [
              "운영 배포 매니페스트에 ORION_DB_PATH 포함",
              "DB 파일 권한/경로가 read-only 정책과 충돌하지 않는지 확인"
            ]
          }
        ]
      },
      {
        "id": "ODA-RISK-013",
        "title": "Kernel 루프가 polling+순차 처리로 확장성/지연 위험",
        "category": "reliability.runtime",
        "severity": "medium",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "Relay dequeue, cognitive 처리, 승인 proposal 처리 모두 단일 루프에서 순차 수행하며 기본 poll interval=1s. 작업량 증가 시
  지연/스타베이션이 발생할 수 있음.",
        "impact": [
          "처리량 증가 시 relay 작업/승인 실행이 지연",
          "긴 LLM 호출이 루프를 블로킹하여 다른 작업이 정체"
        ],
        "scenarios": [
          "승인 proposal이 많을 때 `_process_approved_proposals` 루프가 길어져 relay 처리 지연",
          "LLM generate_plan이 느릴 때 전체 루프 주기가 늘어남"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/kernel.py:56",
            "note": "단일 while 루프에서 dequeue/execute를 순차 수행"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/runtime/kernel.py:83",
            "note": "approved proposals를 전부 순회"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "architecture_change",
            "summary": "작업 유형별 워커 분리/동시성 제어 및 backpressure 도입",
            "steps": [
              "relay 처리와 proposal 실행을 별도 태스크/워커로 분리",
              "승인 proposal 처리에 배치/페이징 도입",
              "polling 대신 이벤트 기반(또는 adaptive backoff) 고려"
            ]
          }
        ],
        "verification": [
          {
            "type": "load_test",
            "description": "relay 100건 + approved 100건 상황에서 처리 지연/CPU 사용률을 관찰"
          }
        ]
      },
      {
        "id": "ODA-RISK-014",
        "title": "WorkflowRunner가 마크다운에서 추출한 커맨드를 bash -lc로 실행(주입/오용 위험)",
        "category": "security.execution",
        "severity": "high",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "워크플로 정의(.agent/workflows/*.md)에서 추출된 문자열을 파라미터 치환 후 `bash -lc`로 실행해, 워크플로 파일/파라미터가
  오염되면 임의 명령 실행이 가능.",
        "impact": [
          "개발자 환경에서 임의 명령 실행",
          "샌드박스 외부에서 실행될 경우 파일 시스템/자격 증명 노출"
        ],
        "scenarios": [
          "workflow 파일에 악성 명령이 삽입되어 실행",
          "params 값에 `$(...)`/`;` 등이 포함되어 의도치 않은 명령 체인 실행"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/workflow_runner.py:52",
            "note": "파라미터 치환이 단순 replace"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/workflow_runner.py:94",
            "note": "bash -lc 실행"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "hardening",
            "summary": "워크플로 실행을 샌드박스로 강제하고, 커맨드를 구조화된 argv/화이트리스트로 제한",
            "steps": [
              "shell=True/basht -lc 사용을 제거하고 subprocess argv로 실행",
              "허용 명령/옵션 화이트리스트 또는 signed workflow 도입",
              "기본 실행을 SandboxRunner로 라우팅(호스트 직접 실행 금지)"
            ]
          }
        ],
        "verification": [
          {
            "type": "security_test",
            "description": "params에 `; echo PWNED` 등을 넣었을 때 추가 명령이 실행되지 않는지 확인"
          }
        ]
      },
      {
        "id": "ODA-RISK-015",
        "title": "MCP Manager가 사용자 설정(.claude.json 등)을 수정하고 바이너리를 다운로드/설치(환경 드리프트·공급망 위험)",
        "category": "security.supply_chain",
        "severity": "medium",
        "likelihood": "medium",
        "confidence": "high",
        "summary": "MCP tooling이 기본 WORKSPACE_ROOT를 기준으로 사용자 설정 파일을 읽고/쓸 수 있으며, 네트워크로 릴리즈 자산을 내려받아 설
  치할 수 있음. 제한된 네트워크 환경에서는 실패/불안정이 발생하며, 구성 변경이 전역적으로 퍼질 수 있음.",
        "impact": [
          "사용자 전역 설정 손상/예상치 못한 동작 변화",
          "네트워크 제한 환경에서 기능 불가",
          "공급망 리스크(다운로드/압축해제/설치 경로)"
        ],
        "scenarios": [
          "실수로 다른 프로젝트의 .claude.json까지 수정",
          "다운로드/설치가 실패해 반쯤 적용된 상태가 남음"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/mcp_manager.py:50",
            "note": "WORKSPACE_ROOT가 전역 설정 파일 경로를 결정"
          },
          {
            "ref": "park-kyungchan/palantir/lib/oda/mcp_manager.py:53",
            "note": "CLAUDE_CONFIG_PATH가 ~/.claude.json을 가리킴"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "safety",
            "summary": "기본 동작을 dry-run/명시적 opt-in으로 바꾸고, 프로젝트 스코프 설정 우선 적용",
            "steps": [
              "전역 설정 파일 수정은 `--apply` 같은 명시 옵션에서만 수행",
              "설치/다운로드는 버전 pin + 경로 제한 + 결과 보고",
              "네트워크 차단 환경에서는 graceful degradation(오프라인 모드) 제공"
            ]
          }
        ],
        "verification": [
          {
            "type": "checklist",
            "items": [
              "기본 실행이 전역 파일을 변경하지 않는지 확인",
              "실패 시 롤백/원복 경로가 있는지 확인"
            ]
          }
        ]
      },
      {
        "id": "ODA-RISK-016",
        "title": "SandboxRunner 설정이 특정 워크스페이스 절대경로에 묶여 재현성 저하",
        "category": "reliability.portability",
        "severity": "medium",
        "likelihood": "high",
        "confidence": "high",
        "summary": "SandboxRunner의 기본 workspace_root가 절대경로로 고정되어 있어 다른 환경에서 즉시 실패하거나 잘못된 경로를 대상으로 실행
  할 수 있음.",
        "impact": [
          "다른 개발자/CI에서 샌드박스 실행 실패",
          "잘못된 경로에 대한 실행/마운트로 결과 왜곡"
        ],
        "scenarios": [
          "ORION_WORKSPACE_ROOT를 설정하지 않은 환경에서 기본값이 존재하지 않아 실패"
        ],
        "evidence": [
          {
            "ref": "park-kyungchan/palantir/lib/oda/claude/sandbox_runner.py:71",
            "note": "workspace_root 기본값이 /home/palantir/park-kyungchan/palantir"
          }
        ],
        "recommended_mitigations": [
          {
            "type": "refactor",
            "summary": "workspace_root를 env/현재 프로젝트 루트 기반으로 계산하고, 존재/권한 검증을 추가",
            "steps": [
              "기본값을 `Path.cwd()` 또는 repo 루트 탐지 기반으로 변경",
              "경로가 유효하지 않으면 명확한 에러 + 설정 가이드 제공",
              "docker-compose 파일 위치도 workspace_root 기준으로 해석"
            ]
          }
        ],
        "verification": [
          {
            "type": "command",
            "cmd": "python -c \"from lib.oda.claude.sandbox_runner import SandboxConfig; print(SandboxConfig().workspace_root)\"",
            "expected": "현재 프로젝트에 맞는 경로로 출력"
          }
        ]
      }
    ]
  }