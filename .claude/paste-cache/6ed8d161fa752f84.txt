● ---
  📋 Comprehensive To-Do List: CLAUDE.md 단일 시스템 프롬프트 전환

  분석 요약
  ┌───────────────┬───────────────────────────────────────────────────────┬────────┐
  │   분석 경로   │                       주요 발견                       │ 신뢰도 │
  ├───────────────┼───────────────────────────────────────────────────────┼────────┤
  │ ODA Protocol  │ 8개 enforcement 위치에서 2K+ 라인 중복 발견           │ HIGH   │
  ├───────────────┼───────────────────────────────────────────────────────┼────────┤
  │ Plan Subagent │ 2개 파일 삭제, 1개 간소화, CLAUDE.md 50라인 확장 필요 │ HIGH   │
  └───────────────┴───────────────────────────────────────────────────────┴────────┘
  ---
  Phase 1: 삭제 대상 (Redundant Enforcement)

  1.1 Context Injection Hooks (삭제)
  #: 1
  파일: /home/palantir/.claude/hooks/user-prompt-submit/context_injector.py
  이유: CLAUDE.md Section 2와 중복. 매 프롬프트마다 orchestration rules 주입
  라인: 197줄 삭제
  ────────────────────────────────────────
  #: 2
  파일: /home/palantir/.claude/hooks/subagent-start/context_sync.py
  이유: CLAUDE.md Section 3와 중복. 서브에이전트에 governance context 주입
  라인: 254줄 삭제
  1.2 Settings.json 업데이트
  ┌─────┬────────────────────────────────────────┬───────────────────────────────┐
  │  #  │                  작업                  │             설명              │
  ├─────┼────────────────────────────────────────┼───────────────────────────────┤
  │ 3   │ settings.json UserPromptSubmit 훅 제거 │ context_injector.py 참조 삭제 │
  ├─────┼────────────────────────────────────────┼───────────────────────────────┤
  │ 4   │ settings.json SubagentStart 훅 제거    │ context_sync.py 참조 삭제     │
  └─────┴────────────────────────────────────────┴───────────────────────────────┘
  ---
  Phase 2: 간소화 대상 (Simplify to Runtime-Only)

  2.1 Orchestrator Enforcement
  #: 5
  파일: /home/palantir/.claude/hooks/orchestrator_enforcement.py
  현재: 587줄, 경고 메시지 생성 + 프롬프트 주입
  변경 후: ~300줄, {"decision": "allow/block"} 반환만
  ────────────────────────────────────────
  #: 6
  파일: /home/palantir/.claude/hooks/config/enforcement_config.yaml
  현재: dangerous_patterns 중복 정의
  변경 후: CLAUDE.md Section 4 참조로 변경 또는 유지
  ---
  Phase 3: CLAUDE.md 확장 (Single Source of Truth)

  3.1 새로운 Section 추가
  ┌─────┬─────────────┬───────────────────────────────────────────────────────────────────────┬─────────────────────┐
  │  #  │   Section   │                                 내용                                  │        출처         │
  ├─────┼─────────────┼───────────────────────────────────────────────────────────────────────┼─────────────────────┤
  │ 7   │ Section 2.7 │ Subagent Context (Auto-Inherited) - Explore/Plan/general-purpose 지침 │ context_sync.py     │
  ├─────┼─────────────┼───────────────────────────────────────────────────────────────────────┼─────────────────────┤
  │ 8   │ Section 3.1 │ Evidence Schemas (Required) - Stage A/B/C 스키마 인라인               │ 3-stage-protocol.md │
  └─────┴─────────────┴───────────────────────────────────────────────────────────────────────┴─────────────────────┘
  3.2 기존 Section 확장
  ┌─────┬───────────┬──────────────────────┬───────────────────────────────────────────────────────┐
  │  #  │  Section  │         현재         │                         확장                          │
  ├─────┼───────────┼──────────────────────┼───────────────────────────────────────────────────────┤
  │ 9   │ Section 4 │ 6개 blocked patterns │ governance-check.sh, enforcement_config.yaml에서 통합 │
  ├─────┼───────────┼──────────────────────┼───────────────────────────────────────────────────────┤
  │ 10  │ Section 7 │ 15줄 quick reference │ 40줄로 확장, 도구 접근 매트릭스 추가                  │
  └─────┴───────────┴──────────────────────┴───────────────────────────────────────────────────────┘
  ---
  Phase 4: 유지 대상 (Keep As-Is)

  4.1 Runtime-Only Hooks (프롬프트 주입 없음)
  ┌─────────────────────┬────────────────────┬─────────────┐
  │        파일         │        역할        │  유지 이유  │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ governance-check.sh │ 위험 명령 차단     │ 런타임 보안 │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ audit-logger.sh     │ 도구 호출 로깅     │ 감사 추적   │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ auto-backup.sh      │ 편집 전 백업       │ 데이터 보호 │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ auto-format.sh      │ 편집 후 포맷       │ 코드 품질   │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ session-start.sh    │ 환경 설정          │ 초기화      │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ session-end.sh      │ 정리               │ 종료 처리   │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ session-health.sh   │ 상태 모니터링      │ 건강성 확인 │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ parallel-notify.sh  │ 알림               │ UX          │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ protocol-state.sh   │ 프로토콜 상태 관리 │ 런타임 상태 │
  ├─────────────────────┼────────────────────┼─────────────┤
  │ welcome.sh          │ 환영 메시지        │ UX          │
  └─────────────────────┴────────────────────┴─────────────┘
  4.2 Reference Files (On-Demand Read)
  ┌───────────────────────────────────┬──────┬───────────────────────┬─────────────────────────────────┐
  │               파일                │ 라인 │         역할          │              변경               │
  ├───────────────────────────────────┼──────┼───────────────────────┼─────────────────────────────────┤
  │ references/3-stage-protocol.md    │ 285  │ 상세 프로토콜         │ 핵심만 CLAUDE.md로, 상세는 유지 │
  ├───────────────────────────────────┼──────┼───────────────────────┼─────────────────────────────────┤
  │ references/native-capabilities.md │ 504  │ 서브에이전트 레퍼런스 │ 유지, 필요시 Read               │
  ├───────────────────────────────────┼──────┼───────────────────────┼─────────────────────────────────┤
  │ references/subagent-access.md     │ 354  │ 접근 매트릭스         │ 유지, 필요시 Read               │
  └───────────────────────────────────┴──────┴───────────────────────┴─────────────────────────────────┘
  ---
  Phase 5: 검증
  ┌─────┬───────────────────────┬───────────────────────────────────────────────┐
  │  #  │        테스트         │                     설명                      │
  ├─────┼───────────────────────┼───────────────────────────────────────────────┤
  │ 11  │ 시스템 프롬프트 로딩  │ CLAUDE.md가 유일한 시스템 프롬프트인지 확인   │
  ├─────┼───────────────────────┼───────────────────────────────────────────────┤
  │ 12  │ 서브에이전트 컨텍스트 │ 훅 없이 governance 상속 확인                  │
  ├─────┼───────────────────────┼───────────────────────────────────────────────┤
  │ 13  │ 런타임 enforcement    │ orchestrator_enforcement.py 차단 동작 확인    │
  ├─────┼───────────────────────┼───────────────────────────────────────────────┤
  │ 14  │ 참조 문서 접근        │ Read(".claude/references/...") 정상 동작 확인 │
  └─────┴───────────────────────┴───────────────────────────────────────────────┘
  ---
  📋 Master To-Do List (Implementation Order)

  Phase 1: 삭제 (4 tasks)
  □ 1. context_injector.py 삭제
  □ 2. context_sync.py 삭제
  □ 3. settings.json UserPromptSubmit 훅 제거
  □ 4. settings.json SubagentStart 훅 제거

  Phase 2: 간소화 (2 tasks)
  □ 5. orchestrator_enforcement.py 간소화 (587→~300줄)
  □ 6. enforcement_config.yaml 정리

  Phase 3: CLAUDE.md 확장 (4 tasks)
  □ 7. Section 2.7 추가 (Subagent Context)
  □ 8. Section 3.1 추가 (Evidence Schemas)
  □ 9. Section 4 확장 (Safety Rules 통합)
  □ 10. Section 7 확장 (Native Capabilities)

  Phase 4: 검증 (4 tasks)
  □ 11. 시스템 프롬프트 로딩 테스트
  □ 12. 서브에이전트 컨텍스트 테스트
  □ 13. 런타임 enforcement 테스트
  □ 14. 참조 문서 접근 테스트

  Total: 14 tasks

  ---
  영향도 분석
  ┌───────────────────────────┬───────────────────────────┬──────────────────────┐
  │           항목            │          변경 전          │       변경 후        │
  ├───────────────────────────┼───────────────────────────┼──────────────────────┤
  │ 시스템 프롬프트 주입 위치 │ 3개 (CLAUDE.md + 2 hooks) │ 1개 (CLAUDE.md only) │
  ├───────────────────────────┼───────────────────────────┼──────────────────────┤
  │ 총 enforcement 코드 라인  │ ~2000줄+                  │ ~800줄               │
  ├───────────────────────────┼───────────────────────────┼──────────────────────┤
  │ 중복 규칙 정의            │ 5개 위치                  │ 1개 위치 (CLAUDE.md) │
  ├───────────────────────────┼───────────────────────────┼──────────────────────┤
  │ CLAUDE.md 크기            │ 378줄                     │ ~430줄 (+52)         │
  └───────────────────────────┴───────────────────────────┴──────────────────────┘
  ---