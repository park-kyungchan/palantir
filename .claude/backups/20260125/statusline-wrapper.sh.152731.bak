#!/bin/bash
# =============================================================================
# Statusline Wrapper with Pastel Background Colors (High Contrast)
# =============================================================================
# Applies pastel backgrounds to ALL text with dark foreground for readability

# Pastel background colors (softer, lighter pastels)
BG_LINE1="\033[48;2;200;220;255m"     # Light Periwinkle Blue
BG_LINE2="\033[48;2;220;200;255m"     # Light Lavender

# Dark text color for high contrast (override all colors)
FG_DARK="\033[38;2;30;30;50m"         # Dark navy text
BOLD="\033[1m"
RESET="\033[0m"

# Read stdin (JSON from Claude Code)
INPUT=$(cat)

# Run original statusline and capture output
OUTPUT=$(echo "$INPUT" | ~/.claude/statusline/statusline.sh 2>/dev/null)

# If statusline fails, exit silently
if [ -z "$OUTPUT" ]; then
    exit 0
fi

# Strip all existing ANSI color codes and apply new background + dark text
strip_colors() {
    # Remove all ANSI escape sequences
    echo "$1" | sed 's/\x1b\[[0-9;]*m//g'
}

# Apply background colors to each line with stripped colors
LINE_NUM=0
while IFS= read -r line; do
    ((LINE_NUM++))

    # Skip empty lines
    if [ -z "$line" ]; then
        continue
    fi

    # Strip existing colors for clean background application
    CLEAN_LINE=$(strip_colors "$line")

    # Apply different background per line with dark text
    case $LINE_NUM in
        1) echo -e "${BG_LINE1}${FG_DARK}${BOLD} ${CLEAN_LINE} ${RESET}" ;;
        2) echo -e "${BG_LINE2}${FG_DARK}${BOLD} ${CLEAN_LINE} ${RESET}" ;;
        *) echo -e "${BG_LINE1}${FG_DARK} ${CLEAN_LINE} ${RESET}" ;;
    esac
done <<< "$OUTPUT"
