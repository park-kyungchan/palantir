---
name: worker-task
description: Execute assigned worker task from a YAML prompt file
user-invocable: true
disable-model-invocation: true
argument-hint: [task-file-path]
allowed-tools: Read, Grep, Glob, Edit, Write, Bash
version: "1.0.0"
---

# /worker-task Skill - Execute Assigned Worker Task

---

## Purpose

Execute assigned worker task from a YAML prompt file.
Used in multi-terminal orchestration for parallel task execution.

---

## Task File Path

$ARGUMENTS

Example: `/worker-task .agent/prompts/pending/worker-b-task.yaml`

---

## Execution Flow

### 1. Read Task File

```bash
# Read the assigned task file
cat $ARGUMENTS
```

Parse the YAML structure:
- `taskId`: Unique task identifier
- `assignedTo`: Terminal assignment (e.g., "Terminal-B")
- `context`: Background information
- `steps`: List of actions to perform
- `dependencies`: Tasks that must complete first
- `onComplete`: Actions to take after completion

### 2. Check Dependencies

Read `_progress.yaml` to verify dependencies:

```bash
cat .agent/prompts/_progress.yaml
```

If `blockedBy` list is non-empty, report blocked status and wait.

### 3. Update Progress (Start)

Before starting work, update `_progress.yaml`:

```yaml
terminals:
  terminal-{x}:
    status: "in_progress"
    startedAt: "{timestamp}"
```

### 4. Execute Task Steps

Follow the `steps` section in the task file:
- Each step has `action` and optionally `command`
- Use appropriate tools (Read, Edit, Write, Bash)
- Log progress for each completed step

### 5. Update Progress (Complete)

After completing all steps, update `_progress.yaml`:

```yaml
terminals:
  terminal-{x}:
    status: "completed"
    completedAt: "{timestamp}"

phases:
  phase{n}:
    status: "completed"
    completedAt: "{timestamp}"
```

### 6. Report in L1/L2/L3 Format

Return completion summary:

```yaml
taskId: {taskId}
agentType: Worker
summary: "Completed {taskId}: {brief description}"
status: success | partial | failed
priority: HIGH
recommendedRead:
  - anchor: "#changes-made"
    reason: "list of files modified"
l2Index:
  - anchor: "#changes-made"
    tokens: {number}
    priority: HIGH
    description: "Files created/modified"
  - anchor: "#verification"
    tokens: {number}
    priority: MEDIUM
    description: "Test results and verification"
l2Path: .agent/outputs/Worker/{taskId}.md
requiresL2Read: false
nextActionHint: "Phase {n} complete. Terminal-{x} ready for next task."
```

---

## Tools Allowed

- Read
- Grep
- Glob
- Edit
- Write
- Bash

---

## Error Handling

### Dependency Not Met
```yaml
taskId: {taskId}
status: blocked
blockedBy: ["phase1"]
message: "Waiting for phase1 to complete"
```

### Step Failed
```yaml
taskId: {taskId}
status: partial
completedSteps: [1, 2, 3]
failedStep: 4
error: "File not found: .claude/hooks/target.sh"
```

### Conflict Detected
```yaml
taskId: {taskId}
status: conflict
conflictWith: "Terminal-B"
message: "Both terminals attempting to modify same file"
action: "Notify Orchestrator immediately"
```

---

## Example Usage

### Invocation
```
/worker-task .agent/prompts/pending/worker-c-phase2-skills.yaml
```

### Task File Structure
```yaml
taskId: "phase2-skills-e2"
assignedTo: "Terminal-C"
orchestrator: "Terminal-A"

context:
  description: "Create L1/L2/L3 skills"

steps:
  - step: 1
    action: "Create skills directory"
    command: "mkdir -p .claude/skills/{explore-l1l2l3,plan-l1l2l3}"

  - step: 2
    action: "Write explore-l1l2l3/SKILL.md"

dependencies: []
blockedBy: []

onComplete:
  - "Update _progress.yaml"
  - "Report to Orchestrator"
```

---

## Integration with Multi-Terminal System

### Orchestrator (Terminal-A)
- Creates task files in `.agent/prompts/pending/`
- Monitors `_progress.yaml` for updates
- Resolves dependencies and conflicts

### Workers (Terminal-B, C, D)
- Read assigned task files
- Execute steps independently
- Update `_progress.yaml` on completion

### File Locations
| File | Purpose |
|------|---------|
| `.agent/prompts/_context.yaml` | Global project context |
| `.agent/prompts/_progress.yaml` | Real-time progress tracker |
| `.agent/prompts/pending/*.yaml` | Pending task files |
| `.agent/prompts/completed/*.yaml` | Archived tasks |

---

## Notes

- Always read the task file FIRST before any action
- Check dependencies BEFORE starting work
- Update `_progress.yaml` at start AND completion
- Report conflicts immediately to Orchestrator
- Never modify files outside your `targetFiles` list
