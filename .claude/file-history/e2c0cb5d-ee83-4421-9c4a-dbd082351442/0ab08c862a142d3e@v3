---
name: worker-done
description: |
  Report task completion and update progress tracker.
  Move task file from pending to completed, update _progress.yaml.
  Generate L1 completion report for Orchestrator (Terminal-A).
  Use in worker terminals after completing assigned task.
user-invocable: true
disable-model-invocation: true
model: haiku
allowed-tools: Read, Edit, Write, Bash
version: "1.1.0"
---

# Worker Task Completion

Report your task completion and update the progress tracker.

## Usage
```
/worker-done <terminal-id> [summary]
```
Example: `/worker-done b "E1+E4 implemented in session-start.sh"`

## Input
$ARGUMENTS

## Step 1: Parse Arguments

```bash
# First word is terminal ID, rest is summary
ARGS="$ARGUMENTS"
TERMINAL_ID=$(echo "$ARGS" | awk '{print tolower($1)}')
SUMMARY=$(echo "$ARGS" | cut -d' ' -f2-)
echo "Terminal: $TERMINAL_ID"
echo "Summary: $SUMMARY"
```

## Step 2: Find My Task File

```bash
TERMINAL_ID=$(echo "$ARGUMENTS" | awk '{print tolower($1)}')
TASK_FILE=$(ls .agent/prompts/pending/worker-${TERMINAL_ID}-*.yaml 2>/dev/null | head -1)
echo "Task file: $TASK_FILE"
```

## Step 3: Move Task to Completed

```bash
TERMINAL_ID=$(echo "$ARGUMENTS" | awk '{print tolower($1)}')
TASK_FILE=$(ls .agent/prompts/pending/worker-${TERMINAL_ID}-*.yaml 2>/dev/null | head -1)
if [ -n "$TASK_FILE" ]; then
    mkdir -p .agent/prompts/completed
    mv "$TASK_FILE" .agent/prompts/completed/
    echo "Moved to completed: $(basename $TASK_FILE)"
fi
```

## Step 4: Update Progress YAML

Read current `_progress.yaml` and update:

1. Set `terminal-{x}.status` to `"completed"`
2. Set `terminal-{x}.completedAt` to current ISO timestamp
3. Update corresponding `phase.status` to `"completed"`

### Current Progress
```bash
cat .agent/prompts/_progress.yaml
```

### Required Edits

Edit `.agent/prompts/_progress.yaml`:
- Find `terminal-{x}:` section
- Change `status: "assigned"` → `status: "completed"`
- Add `completedAt: "{ISO timestamp}"`

## Step 5: Log Completion

```bash
TERMINAL_ID=$(echo "$ARGUMENTS" | awk '{print tolower($1)}')
TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)
mkdir -p .agent/logs
echo "$TIMESTAMP | terminal-${TERMINAL_ID} | COMPLETED | $ARGUMENTS" >> .agent/logs/prompt_lifecycle.log
```

## Step 6: Output L1 Report

Generate completion report for Orchestrator:

```yaml
workerId: "terminal-{x}"
taskId: "{extracted from task file}"
status: "completed"
completedAt: "{ISO timestamp}"
summary: "{from arguments or auto-generated}"

deliverables:
  - "{list files created/modified}"

verification:
  - "{completion criterion 1}": "PASS"
  - "{completion criterion 2}": "PASS"

message: |
  Task completed successfully.
  Progress tracker updated.
  Ready for next assignment or E2E verification.
```

## Notify Orchestrator

Final message format for Orchestrator (Terminal-A):

```
═══════════════════════════════════════════════════
  WORKER COMPLETION REPORT
═══════════════════════════════════════════════════
  Terminal: {X}
  Task: {task name}
  Status: COMPLETED
  Time: {timestamp}

  Summary: {summary}

  Files Modified:
    - {file1}
    - {file2}

  Next: Awaiting new assignment or E2E verification
═══════════════════════════════════════════════════
```
