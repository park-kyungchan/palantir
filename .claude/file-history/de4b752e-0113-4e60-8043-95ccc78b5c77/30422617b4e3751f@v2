# =============================================================================
# Worker Task: Terminal-C - Ontology-Definition Enhancement
# =============================================================================
# Read this file AFTER reading _context.yaml
#
# Location: .agent/prompts/pending/worker-terminal-c-ontology.yaml
# Language: English (Machine-Readable)
# =============================================================================

version: "1.0"
assignedTo: "Terminal-C"
orchestrator: "Terminal-A"
createdAt: "2026-01-25T14:40:00Z"

# =============================================================================
# CONTEXT REFERENCE
# =============================================================================
contextFile: ".agent/prompts/_context.yaml"
progressFile: ".agent/prompts/_progress.yaml"
planFile: ".agent/plans/ontology_definition_enhancement_20260125.yaml"
docsReference: "/home/palantir/park-kyungchan/palantir/docs/Ontology.md"

# =============================================================================
# CODEBASE LOCATION
# =============================================================================
codebase:
  rootPath: "/home/palantir/park-kyungchan/palantir/Ontology-Definition"
  modulePath: "ontology_definition"
  testsPath: "tests"

# =============================================================================
# MY ASSIGNED TASKS (순서대로 실행)
# =============================================================================
assignedTasks:

  # ---------------------------------------------------------------------------
  # TASK 2: Function 타입 정의 추가 (P0 - Task #1 완료 대기)
  # ---------------------------------------------------------------------------
  - taskId: "2"
    nativeTaskId: "2"
    name: "Phase 2: Function 타입 정의 추가"
    priority: "P0"
    blockedBy: ["1"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 6 기준 Function 타입 구현:
      - FunctionType: @Function, @OntologyEditFunction, @Query 데코레이터 지원
      - FunctionSignature: 입력/출력 타입 정의
      - FunctionMetadata: className, methodName, version, apiName
      - Edits declaration for @OntologyEditFunction

    targetFiles:
      - path: "ontology_definition/types/function.py"
        action: "create"
        sections:
          - "FunctionDecorator enum (@Function, @OntologyEditFunction, @Query)"
          - "FunctionParameter model"
          - "FunctionSignature model"
          - "Function model (OntologyEntity 상속)"

      - path: "ontology_definition/core/enums.py"
        action: "modify"
        sections:
          - "Add FunctionType enum"
          - "Add FunctionLanguage enum (TYPESCRIPT, PYTHON)"

      - path: "ontology_definition/types/__init__.py"
        action: "modify"
        sections:
          - "Export Function, FunctionSignature"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "620-711"
        reason: "Function 스펙 참조"

      - path: "ontology_definition/core/base.py"
        reason: "OntologyEntity base class 참조"

    completionCriteria:
      - "Function 모델이 모든 데코레이터 타입 지원"
      - "FunctionSignature로 입출력 타입 정의 가능"
      - "@Edits 데코레이터 지원"
      - "to_foundry_dict() / from_foundry_dict() 구현"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.function import Function; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='2', status='completed')"
      - "Unblocks Task #4 (partial), Task #8"

  # ---------------------------------------------------------------------------
  # TASK 4: Automation 타입 정의 추가 (P1 - Task #2, #3 완료 대기)
  # ---------------------------------------------------------------------------
  - taskId: "4"
    nativeTaskId: "4"
    name: "Phase 4: Automation 타입 정의 추가"
    priority: "P1"
    blockedBy: ["2", "3"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 8 기준 Automation 타입 구현:
      - AutomationCondition: TIME 또는 OBJECT_SET 기반 트리거
      - AutomationEffect: ACTION, NOTIFICATION, FALLBACK
      - RetryPolicy: CONSTANT, EXPONENTIAL
      - Automation 메인 모델

    targetFiles:
      - path: "ontology_definition/types/automation.py"
        action: "create"
        sections:
          - "ConditionType enum (TIME, OBJECT_SET)"
          - "TimeCondition model (cron, timezone)"
          - "ObjectSetCondition model"
          - "EffectType enum"
          - "ActionEffect, NotificationEffect models"
          - "RetryPolicy model"
          - "Automation model (OntologyEntity 상속)"

      - path: "ontology_definition/core/enums.py"
        action: "modify"
        sections:
          - "Add AutomationConditionType enum"
          - "Add AutomationEffectType enum"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "825-916"
        reason: "Automation 스펙 참조"

      - path: "ontology_definition/types/objectset.py"
        reason: "ObjectSetDefinition 참조 (Terminal-B Task #3에서 생성)"

    completionCriteria:
      - "TIME 및 OBJECT_SET 조건 타입 지원"
      - "ACTION, NOTIFICATION, FALLBACK 효과 타입 지원"
      - "Cron 표현식 및 시간대 설정 지원"
      - "재시도 정책 지원"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.automation import Automation; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='4', status='completed')"
      - "Unblocks Task #6"

  # ---------------------------------------------------------------------------
  # TASK 6: Writeback 설정 타입 추가 (P1 - Task #4 완료 대기)
  # ---------------------------------------------------------------------------
  - taskId: "6"
    nativeTaskId: "6"
    name: "Phase 6: Writeback 설정 타입 추가"
    priority: "P1"
    blockedBy: ["4"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 10 기준 Writeback 구현:
      - WritebackDataset: 내부 쓰기-백 데이터셋 설정
      - WebhookConfig: writeback_webhook, side_effect_webhook
      - ExportConfig: file_export, streaming_export, table_export

    targetFiles:
      - path: "ontology_definition/types/writeback.py"
        action: "create"
        sections:
          - "WritebackDatasetConfig model"
          - "WebhookType enum (WRITEBACK, SIDE_EFFECT)"
          - "WritebackWebhookConfig model"
          - "ExportTarget enum (S3, GCS, Azure_Blob, Kafka, etc.)"
          - "ExportConfig model"
          - "Writeback model"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "1001-1053"
        reason: "Writeback 스펙 참조"

    completionCriteria:
      - "Internal writeback dataset 설정 지원"
      - "Writeback/Side effect webhook 구분"
      - "File/Streaming/Table export 설정 지원"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.writeback import Writeback; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='6', status='completed')"

  # ---------------------------------------------------------------------------
  # TASK 8: ActionType ValueSource 정교화 (P2 - Task #2 완료 대기)
  # ---------------------------------------------------------------------------
  - taskId: "8"
    nativeTaskId: "8"
    name: "Phase 8: ActionType ValueSource 정교화"
    priority: "P2"
    blockedBy: ["2"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 5 기준 ValueSource 완전 구현:
      - fromParameter: 파라미터에서 값 가져오기
      - objectParameterProperty: 객체 파라미터의 속성 값
      - staticValue: 정적 값
      - currentUser: userId, groupIds, multipassAttribute
      - currentTime: timestamp

    targetFiles:
      - path: "ontology_definition/types/action_type.py"
        action: "modify"
        sections:
          - "Add ValueSourceType enum"
          - "Add ValueSource model"
          - "Add CurrentUserSource model (userId, groupIds, multipassAttribute)"
          - "Update PropertyMapping to use ValueSource"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "569-576"
        reason: "ValueSource 옵션 참조"

      - path: "ontology_definition/types/action_type.py"
        reason: "현재 ActionType 모델 확인"

    completionCriteria:
      - "5가지 ValueSource 타입 모두 지원"
      - "PropertyMapping이 ValueSource 모델 사용"
      - "currentUser 옵션 완전 지원"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.action_type import ValueSource; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='8', status='completed')"
      - "All Terminal-C tasks complete"

# =============================================================================
# AUTONOMOUS EXECUTION SEQUENCE
# =============================================================================
executionSequence:
  - step: 1
    taskId: "2"
    name: "Function 타입 추가"
    waitFor: ["1"]
    action: "Wait for Terminal-B Task #1 to complete, then start"
    onComplete: "Unblocks Task #4 (partial), Task #8"

  - step: 2
    taskId: "4"
    name: "Automation 타입 추가"
    waitFor: ["2", "3"]
    action: "Wait for Task #2 AND Terminal-B Task #3 to complete"
    onComplete: "Unblocks Task #6"

  - step: 3
    taskId: "6"
    name: "Writeback 타입 추가"
    waitFor: ["4"]
    action: "Wait for Task #4, then start"

  - step: 4
    taskId: "8"
    name: "ValueSource 정교화"
    waitFor: ["2"]
    action: "Can run parallel with Task #4, #6 after Task #2 completes"
    note: "Task #2 완료 후 바로 시작 가능 (Task #4, #6와 병렬 가능)"

# =============================================================================
# PARALLELIZATION NOTES
# =============================================================================
parallelization:
  afterTask2:
    - "Task #4 (Automation) - 단, Terminal-B Task #3 완료도 필요"
    - "Task #8 (ValueSource) - Task #2만 필요"
    note: "Task #8은 Task #2 완료 후 바로 시작 가능"

  recommendedOrder:
    option1: "Task #2 → Task #4 → Task #6 (sequential), Task #8 parallel"
    option2: "Task #2 → Task #8 먼저, Task #4 대기 (Task #3 blocker)"

# =============================================================================
# CROSS-TERMINAL DEPENDENCIES
# =============================================================================
crossTerminalDeps:
  iWaitFor:
    - "Task #1 (Terminal-B) → my Task #2"
    - "Task #3 (Terminal-B) → my Task #4"

  myTasksUnblock: []

# =============================================================================
# ON TERMINAL COMPLETE
# =============================================================================
onAllTasksComplete:
  - "Report: Terminal-C completed all assigned tasks"
  - "Check Task #9 (Testing) - can help if needed"
