# =============================================================================
# Worker Task: Terminal-B - Ontology-Definition Enhancement
# =============================================================================
# Read this file AFTER reading _context.yaml
#
# Location: .agent/prompts/pending/worker-terminal-b-ontology.yaml
# Language: English (Machine-Readable)
# =============================================================================

version: "1.0"
assignedTo: "Terminal-B"
orchestrator: "Terminal-A"
createdAt: "2026-01-25T14:40:00Z"

# =============================================================================
# CONTEXT REFERENCE
# =============================================================================
contextFile: ".agent/prompts/_context.yaml"
progressFile: ".agent/prompts/_progress.yaml"
planFile: ".agent/plans/ontology_definition_enhancement_20260125.yaml"
docsReference: "/home/palantir/park-kyungchan/palantir/docs/Ontology.md"

# =============================================================================
# CODEBASE LOCATION
# =============================================================================
codebase:
  rootPath: "/home/palantir/park-kyungchan/palantir/Ontology-Definition"
  modulePath: "ontology_definition"
  testsPath: "tests"

# =============================================================================
# MY ASSIGNED TASKS (순서대로 실행)
# =============================================================================
assignedTasks:

  # ---------------------------------------------------------------------------
  # TASK 1: PropertyType 정교화 (P0 - 즉시 시작 가능)
  # ---------------------------------------------------------------------------
  - taskId: "1"
    nativeTaskId: "1"
    name: "Phase 1: PropertyType 정교화"
    priority: "P0"
    blockedBy: []
    canStartImmediately: true

    description: |
      docs/Ontology.md의 PropertyType 스펙에 맞게 PropertyDefinition 모델을 정교화:
      - isPrimaryKey: boolean 추가
      - isTitleKey: boolean 추가
      - searchable: boolean 추가
      - sortable: boolean 추가
      - nullable: boolean (기본값 true) 추가
      - visibility: enum (NORMAL | PROMINENT | HIDDEN) 추가

    targetFiles:
      - path: "ontology_definition/types/property_def.py"
        action: "modify"
        sections:
          - "PropertyDefinition class에 새 필드 추가"
          - "to_foundry_dict() 업데이트"
          - "from_foundry_dict() 업데이트"

      - path: "ontology_definition/core/enums.py"
        action: "modify"
        sections:
          - "PropertyVisibility enum 추가 (NORMAL, PROMINENT, HIDDEN)"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "127-141"
        reason: "PropertyType 스펙 참조"

      - path: "ontology_definition/types/property_def.py"
        reason: "현재 PropertyDefinition 모델 확인"

    completionCriteria:
      - "PropertyDefinition에 isPrimaryKey, isTitleKey, searchable, sortable, nullable, visibility 필드 추가"
      - "PropertyVisibility enum 추가"
      - "to_foundry_dict() 업데이트"
      - "from_foundry_dict() 업데이트"
      - "기존 테스트 통과"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.property_def import PropertyDefinition; from ontology_definition.core.enums import PropertyVisibility; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='1', status='completed')"
      - "Notify Terminal-C that blockers cleared for Task #2, #8"

  # ---------------------------------------------------------------------------
  # TASK 3: ObjectSet 타입 정의 추가 (P0 - Task #1 완료 후)
  # ---------------------------------------------------------------------------
  - taskId: "3"
    nativeTaskId: "3"
    name: "Phase 3: ObjectSet 타입 정의 추가"
    priority: "P0"
    blockedBy: ["1"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 7 기준 ObjectSet 연산자 구현:
      - FilterOperator: exactMatch, hasProperty, phrase, range 등
      - SetOperation: union, intersect, subtract
      - Aggregation: count, average, max, min, sum
      - ObjectSetDefinition: 필터 체인 정의 모델

    targetFiles:
      - path: "ontology_definition/types/objectset.py"
        action: "create"
        sections:
          - "FilterOperator enum"
          - "SetOperation enum"
          - "AggregationType enum"
          - "FilterCondition model"
          - "ObjectSetDefinition model"

      - path: "ontology_definition/types/__init__.py"
        action: "modify"
        sections:
          - "Export ObjectSetDefinition, FilterCondition"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "714-822"
        reason: "ObjectSet operators 스펙 참조"

    completionCriteria:
      - "모든 filter_operators 지원 (all_types, string, numeric_date, boolean, geo, array)"
      - "Set operations (union, intersect, subtract) 지원"
      - "Aggregation 연산 지원"
      - "Ordering 및 retrieval 옵션 지원"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.objectset import ObjectSetDefinition; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='3', status='completed')"
      - "Notify Terminal-C that blocker cleared for Task #4"

  # ---------------------------------------------------------------------------
  # TASK 5: Rules Engine 타입 정의 추가 (P1 - Task #3 완료 후)
  # ---------------------------------------------------------------------------
  - taskId: "5"
    nativeTaskId: "5"
    name: "Phase 5: Rules Engine 타입 정의 추가"
    priority: "P1"
    blockedBy: ["3"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 9 기준 Rules Engine 구현:
      - LogicBoard: filter_board, aggregation_board, join_board, expression_board 등
      - ActionRule: createObject, modifyObject, deleteObject 등 10가지 규칙 타입
      - FoundryRule 메인 모델

    targetFiles:
      - path: "ontology_definition/types/rules_engine.py"
        action: "create"
        sections:
          - "LogicBoardType enum"
          - "FilterBoard, AggregationBoard, JoinBoard models"
          - "ExpressionBoard, WindowBoard models"
          - "ActionRuleType enum (10 types)"
          - "FoundryRule model"

      - path: "ontology_definition/types/__init__.py"
        action: "modify"
        sections:
          - "Export FoundryRule, LogicBoard"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "920-997"
        reason: "Rules Engine 스펙 참조"

    completionCriteria:
      - "모든 Logic Board 타입 지원"
      - "10가지 Action Rule 타입 지원"
      - "입출력 데이터셋 정의 지원"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.types.rules_engine import FoundryRule; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='5', status='completed')"

  # ---------------------------------------------------------------------------
  # TASK 7: Versioning & Governance 지원 추가 (P1 - Task #1 완료 후)
  # ---------------------------------------------------------------------------
  - taskId: "7"
    nativeTaskId: "7"
    name: "Phase 7: Versioning & Governance 지원 추가"
    priority: "P1"
    blockedBy: ["1"]
    canStartImmediately: false

    description: |
      docs/Ontology.md Section 11 기준 버전 관리 구현:
      - SchemaChange: breaking_changes, non_breaking_changes 분류
      - Migration: drop_property_edits, cast_property_type 등 지원
      - TypeCast: 허용 타입 변환 매트릭스
      - ProposalWorkflow: branch, proposal, review, merge 단계

    targetFiles:
      - path: "ontology_definition/versioning/__init__.py"
        action: "create"
        sections:
          - "Module initialization"
          - "Export SchemaChange, Migration, OntologyProposal"

      - path: "ontology_definition/versioning/schema_change.py"
        action: "create"
        sections:
          - "ChangeType enum (BREAKING, NON_BREAKING)"
          - "SchemaChange model"
          - "BreakingChangeDetector class"

      - path: "ontology_definition/versioning/migration.py"
        action: "create"
        sections:
          - "MigrationType enum"
          - "Migration model"
          - "TypeCastMatrix"

      - path: "ontology_definition/versioning/proposal.py"
        action: "create"
        sections:
          - "ProposalStatus enum"
          - "ProposalTask model"
          - "OntologyProposal model"

    referenceFiles:
      - path: "docs/Ontology.md"
        lines: "1057-1128"
        reason: "Versioning 스펙 참조"

    completionCriteria:
      - "Breaking/Non-breaking 변경 사항 분류 지원"
      - "6가지 마이그레이션 타입 지원"
      - "타입 캐스트 매트릭스 구현"
      - "Proposal 워크플로우 상태 관리"

    verificationSteps:
      - command: "cd /home/palantir/park-kyungchan/palantir/Ontology-Definition && python -c \"from ontology_definition.versioning import SchemaChange, Migration; print('OK')\""
        expected: "OK"

    onComplete:
      - "TaskUpdate(taskId='7', status='completed')"
      - "All Terminal-B tasks complete"

# =============================================================================
# AUTONOMOUS EXECUTION SEQUENCE
# =============================================================================
executionSequence:
  - step: 1
    taskId: "1"
    name: "PropertyType 정교화"
    action: "START IMMEDIATELY"
    onComplete: "Unblocks Task #2 (Terminal-C), Task #3, Task #7"

  - step: 2
    taskId: "3"
    name: "ObjectSet 타입 추가"
    waitFor: ["1"]
    action: "Wait for Task #1, then start"
    onComplete: "Unblocks Task #4 (partial), Task #5"

  - step: 3
    taskId: "5"
    name: "Rules Engine 타입 추가"
    waitFor: ["3"]
    action: "Wait for Task #3, then start"

  - step: 4
    taskId: "7"
    name: "Versioning 지원 추가"
    waitFor: ["1"]
    action: "Can run parallel with Task #3, #5"
    note: "이 Task는 Task #1 완료 후 바로 시작 가능 (Task #3, #5와 병렬)"

# =============================================================================
# PARALLELIZATION NOTES
# =============================================================================
parallelization:
  afterTask1:
    - "Task #3 (ObjectSet) - 이 터미널이 담당"
    - "Task #7 (Versioning) - 이 터미널이 담당"
    note: "Task #1 완료 후 Task #3와 Task #7을 순차적으로 진행"

  recommendedOrder:
    - "Task #1 → Task #3 → Task #5"
    - "Task #7 can be done in parallel with Task #3 if desired"

# =============================================================================
# CROSS-TERMINAL DEPENDENCIES
# =============================================================================
crossTerminalDeps:
  myTasksUnblock:
    - "Task #1 → Terminal-C Task #2"
    - "Task #3 → Terminal-C Task #4 (partial)"

  iWaitFor: []

# =============================================================================
# ON TERMINAL COMPLETE
# =============================================================================
onAllTasksComplete:
  - "Report: Terminal-B completed all assigned tasks"
  - "Check Task #9 (Testing) - can help if needed"
