# Orchestrator Enforcement Configuration
# =======================================
# Version: 1.0
# Last Updated: 2026-01-10

# Enforcement Mode
# ----------------
# WARN:      Log violations, show warnings, but allow all operations (default)
# BLOCK:     Block complex operations that should be delegated
# AUTO_WRAP: Automatically suggest Task delegation wrapper (advisory with template)
enforcement_mode: WARN

# Complexity Thresholds
# ---------------------
thresholds:
  bash_command_length: 150       # Characters - commands longer trigger complexity check (강화: 200→150)
  bash_pipe_count: 2             # Number of pipes before flagging (강화: 3→2)
  edit_line_count: 30            # Lines being changed before flagging (강화: 50→30)
  write_line_count: 80           # Lines being written before flagging (강화: 100→80)
  multi_function_count: 2        # Functions in a single file write (강화: 3→2)

# Simple Operations (Never flagged)
# ----------------------------------
# These patterns are considered simple and will NOT trigger enforcement
simple_bash_patterns:
  - ls
  - pwd
  - cat
  - head
  - tail
  - wc
  - git status
  - git log
  - git diff
  - git branch
  - git add
  - git commit
  - pytest
  - python -c
  - which
  - type
  - echo
  - mkdir -p
  - touch
  - cp
  - mv

# Allowed Direct Commands (Bypass enforcement)
# --------------------------------------------
# These commands are ALWAYS allowed even in BLOCK mode
allowed_direct_commands:
  # Read-only operations
  - "grep"
  - "find"
  - "rg"
  - "fd"
  # Git read operations
  - "git status"
  - "git log"
  - "git diff"
  - "git branch"
  - "git show"
  # Test execution
  - "pytest"
  - "python -m pytest"
  - "npm test"
  - "yarn test"
  # Type checking
  - "mypy"
  - "pyright"
  - "tsc --noEmit"
  # Linting
  - "ruff check"
  - "eslint"
  - "flake8"
  # Package info
  - "pip show"
  - "npm list"
  - "pip list"

# Dangerous Patterns (Always flagged regardless of mode)
# ------------------------------------------------------
dangerous_patterns:
  - "rm -rf"
  - "sudo rm"
  - "sudo"
  - "chmod 777"
  - "find . -exec"
  - "DROP TABLE"
  - "DROP DATABASE"
  - "TRUNCATE"
  - "DELETE FROM"
  - "eval("
  - "exec("

# Auto-Wrap Suggestions
# ---------------------
# Mapping of operation types to suggested subagent types
auto_wrap_suggestions:
  dangerous_operation: general-purpose
  complex_analysis: Explore
  multi_pipe_command: Explore
  structural_change: Plan
  multi_file_change: Plan
  large_write: general-purpose
  default: general-purpose

# Fallback Behavior
# -----------------
# On configuration errors or hook failures, fall back to WARN mode
fallback_mode: WARN
fallback_on_error: true

# Logging
# -------
logging:
  enabled: true
  log_dir: /home/palantir/park-kyungchan/palantir/.agent/logs
  log_file: orchestrator_violations.log
  include_tool_input: true     # Log tool input summaries
  max_summary_length: 100      # Truncate summaries to this length

# V2.1.9+ Hook Execution Settings
# -------------------------------
# These settings control the new V2.1.9 hook output features
hook_execution:
  # Enable hookSpecificOutput in responses
  use_hook_specific_output: true

  # Permission decision defaults by category
  # Values: deny (always block), ask (prompt user), allow (just warn)
  permission_categories:
    dangerous_operation: deny     # rm -rf, sudo, DROP TABLE - NEVER allow
    complex_analysis: ask         # Long commands, loops - user can override
    multi_pipe_command: ask       # 3+ pipes - may be intentional
    structural_change: ask        # Class/function modifications
    multi_file_change: ask        # Multiple file operations
    large_write: ask              # 100+ lines - may be intentional
    default: allow                # Unknown categories - just warn

  # Include delegation template in additionalContext
  include_delegation_template: true

  # additionalContext content settings
  additional_context:
    include_category: true        # Include violation category
    include_reasons: true         # Include specific reasons
    include_reference: true       # Include CLAUDE.md reference
    max_template_length: 1500     # Truncate delegation template if too long
