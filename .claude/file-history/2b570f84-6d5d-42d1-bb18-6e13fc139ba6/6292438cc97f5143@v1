# =============================================================================
# Global Context for Skill Pipeline Enhancement Project
# =============================================================================
# This file provides the BIG PICTURE for all Workers.
# Every Worker MUST read this file BEFORE starting their task.
#
# Location: .agent/prompts/_context.yaml
# Language: English (Machine-Readable)
# =============================================================================

version: "2.0"
project: "skill-pipeline-enhancement"
projectName: "E2E Skill Pipeline Implementation"
orchestrator: "Terminal-A"
createdAt: "2026-01-24T18:15:00Z"
lastUpdated: "2026-01-24T18:15:00Z"

# =============================================================================
# PROJECT OBJECTIVES
# =============================================================================
objectives:
  primary:
    - "Complete E2E skill pipeline by implementing missing skills"
    - "/collect (P0) - Aggregate worker results, verify completion"
    - "/synthesis (P0) - Traceability matrix, quality validation"
    - "/worker (P1) - Worker self-service commands"

  constraints:
    - "All skills must use V2.1.19 frontmatter format"
    - "Documentation must follow existing pattern (/assign as reference)"
    - "Must integrate with Native Task System"
    - "Must NOT break existing skills"

# =============================================================================
# ARCHITECTURE OVERVIEW
# =============================================================================
architecture:
  currentPipeline: |
    /clarify → /orchestrate → /assign → Workers → ??? → ???  → /commit-push-pr
                                         ↑
                                    [BROKEN HERE]

  targetPipeline: |
    /clarify → /orchestrate → /assign → Workers → /collect → /synthesis → /commit-push-pr
                                                      ↑            ↑
                                                 [Task #2]    [Task #3]

  skillsDirectory: ".claude/skills/"
  outputDirectory: ".agent/outputs/"
  referenceSkill: ".claude/skills/assign/SKILL.md"

# =============================================================================
# DEPENDENCY GRAPH
# =============================================================================
dependencyGraph: |
  Task #2 (/collect)  ─────────►  Task #3 (/synthesis)  ─────────►  Task #4 (/worker)
       │                               │                                │
       │                               │                                │
       └── No blockers                 └── Blocked by #2                └── Blocked by #3
           Terminal-B                      (unassigned)                     (unassigned)

# =============================================================================
# IMPLEMENTATION TASKS
# =============================================================================
tasks:
  task2:
    id: "2"
    subject: "Implement /collect skill (P0)"
    owner: "terminal-b"
    status: "pending"
    priority: "P0"
    promptFile: ".agent/prompts/pending/worker-b-collect.yaml"
    blockedBy: []

    requirements:
      - "TaskList integration - verify all tasks completed"
      - "Output aggregation from .agent/outputs/Worker/"
      - "Blocker detection logic"
      - "Collection report generation"

    deliverables:
      - ".claude/skills/collect/SKILL.md"
      - "Documentation with examples"

  task3:
    id: "3"
    subject: "Implement /synthesis skill (P0)"
    owner: null
    status: "pending"
    priority: "P0"
    blockedBy: ["2"]

    requirements:
      - "Read /clarify log (original requirements)"
      - "Read /collect report (aggregated results)"
      - "Cross-reference: requirements ↔ deliverables"
      - "Quality checks (consistency, completeness)"
      - "Generate traceability matrix"
      - "Decision: COMPLETE or ITERATE"

    deliverables:
      - ".claude/skills/synthesis/SKILL.md"
      - "Documentation with examples"

  task4:
    id: "4"
    subject: "Implement /worker skill (P1)"
    owner: null
    status: "pending"
    priority: "P1"
    blockedBy: ["3"]

    requirements:
      - "/worker start - Claim assigned task"
      - "/worker done - Mark complete"
      - "/worker status - Show current task"
      - "/worker block <taskId> - Report blocker"

    deliverables:
      - ".claude/skills/worker/SKILL.md"
      - "Documentation with examples"

# =============================================================================
# REFERENCE FILES
# =============================================================================
referenceFiles:
  - path: ".claude/skills/assign/SKILL.md"
    reason: "Primary reference for skill documentation pattern"

  - path: ".claude/skills/orchestrate/SKILL.md"
    reason: "See file generation patterns"

  - path: ".claude/CLAUDE.md"
    reason: "Section 3.1 E2E Pipeline reference"

  - path: ".agent/outputs/Worker/"
    reason: "Where worker outputs are stored"

# =============================================================================
# WORKER PROTOCOL
# =============================================================================
workerProtocol:
  onStart:
    - "TaskGet(taskId) - Get full task details"
    - "Verify blockedBy is empty"
    - "TaskUpdate(status='in_progress')"
    - "Read _context.yaml (this file)"
    - "Read assigned promptFile"

  onComplete:
    - "TaskUpdate(status='completed')"
    - "Output to .agent/outputs/Worker/"
    - "Notify Orchestrator"

  onBlocked:
    - "DO NOT start blocked tasks"
    - "Wait for blockers to complete"
    - "Report to Orchestrator if critical"

# =============================================================================
# QUALITY CRITERIA
# =============================================================================
qualityCriteria:
  - "V2.1.19 frontmatter compliance"
  - "Documentation follows /assign pattern"
  - "Error handling section included"
  - "Testing checklist included"
  - "Example usage with outputs"
