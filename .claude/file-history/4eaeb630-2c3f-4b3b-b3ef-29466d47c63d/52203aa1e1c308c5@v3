# =============================================================================
# Worker Task: Terminal-C - E2E Integration Test Script
# =============================================================================
# Project: V2.1.19 Pipeline Compliance Enhancement
# Read this file AFTER reading _context.yaml
# =============================================================================

assignedTo: "terminal-c"
orchestrator: "Terminal-A"
createdAt: "2026-01-25T15:00:00Z"

# =============================================================================
# NATIVE TASK REFERENCE
# =============================================================================
nativeTaskId: "2"
phaseId: "phase4-e2e-test"
phaseName: "Create E2E Integration Test Script"

# =============================================================================
# CONTEXT REFERENCE (Separate from main project)
# =============================================================================
contextFile: ".agent/prompts/_context-v2119-pipeline.yaml"
progressFile: ".agent/prompts/_progress.yaml"
planningDocument: ".agent/plans/v2.1.19-pipeline-review-20260125.yaml"
researchDocument: ".agent/research/v2.1.19-pipeline-review-20260125.md"
note: "This project uses separate context file to avoid conflicts with Ontology-Definition project"

# =============================================================================
# MY SCOPE
# =============================================================================
scope: |
  E2E 파이프라인 통합 테스트 스크립트 작성:

  테스트 범위:
  1. 스킬 파일 존재 확인 (13개)
  2. Frontmatter 유효성 검증 (name, description, version)
  3. 데이터 핸드오프 경로 확인

# =============================================================================
# TARGET FILES (I will CREATE these)
# =============================================================================
targetFiles:
  - path: ".claude/tests/e2e-pipeline-test.sh"
    action: "create"
    readOnly: false

  - path: ".claude/tests/README.md"
    action: "create"
    readOnly: false

# =============================================================================
# REFERENCE FILES (I can only READ these)
# =============================================================================
referenceFiles:
  - path: ".agent/research/v2.1.19-pipeline-review-20260125.md"
    reason: "Test scenarios documented in L3 section"

  - path: ".agent/plans/v2.1.19-pipeline-review-20260125.yaml"
    reason: "Phase specifications and verification steps"

# =============================================================================
# DETAILED INSTRUCTIONS
# =============================================================================
detailedInstructions: |
  ## Step 1: Ensure directory exists
  ```bash
  mkdir -p .claude/tests
  ```

  ## Step 2: Create e2e-pipeline-test.sh
  The script should test:

  ### 2.1 Skill File Existence (13 skills)
  ```bash
  SKILLS=(
    "clarify"
    "research"
    "planning"
    "orchestrate"
    "assign"
    "worker"
    "collect"
    "synthesis"
    "rsil-plan"
    "build"
    "build-research"
    "commit-push-pr"
    "docx-automation"
  )

  for skill in "${SKILLS[@]}"; do
    if [[ -f ".claude/skills/${skill}/SKILL.md" ]]; then
      echo "✅ ${skill}: Found"
    else
      echo "❌ ${skill}: MISSING"
      FAILED=1
    fi
  done
  ```

  ### 2.2 Frontmatter Validation
  For each skill file, verify:
  - `name:` field exists
  - `description:` field exists
  - `version:` field exists

  ### 2.3 Data Handoff Paths
  Check directory structure:
  - `.agent/clarify/` exists or can be created
  - `.agent/research/` exists or can be created
  - `.agent/plans/` exists or can be created

  ## Step 3: Create README.md
  Document:
  - How to run the test: `bash .claude/tests/e2e-pipeline-test.sh`
  - What the test validates
  - Expected output format

# =============================================================================
# SCRIPT TEMPLATE
# =============================================================================
scriptTemplate: |
  #!/bin/bash
  # =============================================================================
  # E2E Pipeline Test Script
  # =============================================================================
  # Tests Claude Code CLI V2.1.19 pipeline compliance
  # Run: bash .claude/tests/e2e-pipeline-test.sh
  # =============================================================================

  set -e

  FAILED=0
  PASSED=0
  TOTAL=0

  echo "=========================================="
  echo " E2E Pipeline Compliance Test"
  echo " V2.1.19"
  echo "=========================================="
  echo ""

  # ---------------------------------------------------------------------------
  # Test 1: Skill File Existence
  # ---------------------------------------------------------------------------
  echo "## Test 1: Skill File Existence"
  echo ""

  SKILLS=(
    "clarify"
    "research"
    "planning"
    "orchestrate"
    "assign"
    "worker"
    "collect"
    "synthesis"
    "rsil-plan"
    "build"
    "build-research"
    "commit-push-pr"
    "docx-automation"
  )

  for skill in "${SKILLS[@]}"; do
    ((TOTAL++))
    if [[ -f ".claude/skills/${skill}/SKILL.md" ]]; then
      echo "  ✅ ${skill}"
      ((PASSED++))
    else
      echo "  ❌ ${skill}: MISSING"
      ((FAILED++))
    fi
  done
  echo ""

  # ---------------------------------------------------------------------------
  # Test 2: Frontmatter Validation
  # ---------------------------------------------------------------------------
  echo "## Test 2: Frontmatter Validation"
  echo ""

  for skill in "${SKILLS[@]}"; do
    SKILL_FILE=".claude/skills/${skill}/SKILL.md"
    if [[ -f "$SKILL_FILE" ]]; then
      ((TOTAL++))

      # Check for required fields
      HAS_NAME=$(grep -c '^name:' "$SKILL_FILE" 2>/dev/null || echo 0)
      HAS_DESC=$(grep -c '^description:' "$SKILL_FILE" 2>/dev/null || echo 0)
      HAS_VERSION=$(grep -c '^version:' "$SKILL_FILE" 2>/dev/null || echo 0)

      if [[ "$HAS_NAME" -gt 0 && "$HAS_DESC" -gt 0 && "$HAS_VERSION" -gt 0 ]]; then
        echo "  ✅ ${skill}: name, description, version present"
        ((PASSED++))
      else
        MISSING=""
        [[ "$HAS_NAME" -eq 0 ]] && MISSING="${MISSING}name "
        [[ "$HAS_DESC" -eq 0 ]] && MISSING="${MISSING}description "
        [[ "$HAS_VERSION" -eq 0 ]] && MISSING="${MISSING}version "
        echo "  ❌ ${skill}: Missing ${MISSING}"
        ((FAILED++))
      fi
    fi
  done
  echo ""

  # ---------------------------------------------------------------------------
  # Test 3: Data Handoff Paths
  # ---------------------------------------------------------------------------
  echo "## Test 3: Data Handoff Paths"
  echo ""

  PATHS=(
    ".agent/clarify"
    ".agent/research"
    ".agent/plans"
    ".agent/prompts"
    ".agent/outputs"
  )

  for path in "${PATHS[@]}"; do
    ((TOTAL++))
    if [[ -d "$path" ]]; then
      echo "  ✅ ${path}"
      ((PASSED++))
    else
      echo "  ⚠️  ${path}: Not found (will be created on first use)"
      ((PASSED++))  # Not a failure, just not created yet
    fi
  done
  echo ""

  # ---------------------------------------------------------------------------
  # Summary
  # ---------------------------------------------------------------------------
  echo "=========================================="
  echo " Summary"
  echo "=========================================="
  echo "  Total:  ${TOTAL}"
  echo "  Passed: ${PASSED}"
  echo "  Failed: ${FAILED}"
  echo ""

  if [[ $FAILED -eq 0 ]]; then
    echo "✅ All tests passed!"
    exit 0
  else
    echo "❌ Some tests failed"
    exit 1
  fi

# =============================================================================
# DEPENDENCIES
# =============================================================================
dependencies: []
blockedBy: []
canStartImmediately: true

# =============================================================================
# COMPLETION CRITERIA
# =============================================================================
completionCriteria:
  required:
    - "Directory .claude/tests/ exists"
    - "e2e-pipeline-test.sh validates all 13 skill files exist"
    - "e2e-pipeline-test.sh verifies required frontmatter fields"
    - "README.md documents test execution"

  verification:
    - command: "bash -n .claude/tests/e2e-pipeline-test.sh"
      expected: "No syntax errors (exit 0)"

# =============================================================================
# ON COMPLETE
# =============================================================================
onComplete:
  - "TaskUpdate(taskId='2', status='completed')"
  - "Update _progress.yaml: terminal-c.status = 'completed'"
  - "Update _progress.yaml: phases.phase4-e2e-test.status = 'completed'"
  - "Report to Orchestrator with L1 summary"
  - "Notify: Task #3 (phase5-validation) may now be partially unblocked"

# =============================================================================
# AUTONOMOUS EXECUTION
# =============================================================================
autonomousExecution:
  enabled: true
  myTerminal: "terminal-c"
  myTasks: ["2"]

  executionSequence:
    - step: 1
      taskId: "2"
      name: "Create E2E Integration Test Script"
      blockedBy: []
      action: "START IMMEDIATELY"
      estimatedTime: "~20 min"

# =============================================================================
# OUTPUT FORMAT
# =============================================================================
outputFormat: "L1/L2/L3"
reportPath: ".agent/outputs/terminal-c/v2119-e2e-test-report.md"

# =============================================================================
# END OF WORKER PROMPT
# =============================================================================
