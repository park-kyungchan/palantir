# Worker Prompt: Implement /worker Skill
# Task ID: #4
# Assigned To: terminal-b (after #3 completes)
# Priority: P1 (UX Improvement)
# Created: 2026-01-24
# Status: PRE-PREPARED (waiting for #3 to complete)

---
nativeTaskId: "4"
terminalId: "terminal-b"
status: pending
createdAt: "2026-01-24T18:25:00Z"
blockedBy: ["3"]  # Will be unblocked when #3 completes

---

## Objective

Implement the `/worker` skill that provides self-service commands for workers.

## Location

Create: `.claude/skills/worker/SKILL.md`

## Reference Files

1. **Previously Created Skills (Your Work):**
   - `.claude/skills/collect/SKILL.md` - Task integration pattern
   - `.claude/skills/synthesis/SKILL.md` - Decision logic pattern

2. **Existing Skill Structure:**
   - `.claude/skills/assign/SKILL.md` - Shows what workers receive

3. **Progress Tracking:**
   - `.agent/prompts/_progress.yaml` - Worker status format
   - `.agent/prompts/pending/` - Prompt file location

## Implementation Requirements

### 1. Frontmatter (V2.1.19 Compliant)

```yaml
---
name: worker
description: Worker self-service commands (start, done, status, block)
user-invocable: true
disable-model-invocation: false
context: standard
model: haiku  # Fast responses for worker commands
version: 1.0.0
argument-hint: "<start|done|status|block> [taskId]"
---
```

### 2. Subcommands

| Command | Action | Updates |
|---------|--------|---------|
| `/worker start` | Claim assigned task, show prompt | TaskUpdate(status="in_progress") |
| `/worker done` | Mark complete, show next task | TaskUpdate(status="completed") |
| `/worker status` | Show current task details | Read-only |
| `/worker block <reason>` | Report blocker to orchestrator | Add to blockers list |

### 3. Core Functions

```javascript
// 1. workerStart()
//    - TaskList() to find my assigned tasks (filter by owner)
//    - Select first unblocked pending task
//    - TaskUpdate(status="in_progress")
//    - Read and display prompt file
//    - Show task details and instructions

// 2. workerDone()
//    - Get current in_progress task
//    - TaskUpdate(status="completed")
//    - Move prompt file: pending ‚Üí completed
//    - Check for next assigned task
//    - If exists, show preview; else "All done!"

// 3. workerStatus()
//    - Show current task info
//    - Show progress (X of Y tasks complete)
//    - Show blockers if any

// 4. workerBlock(reason)
//    - Add blocker to current task
//    - Update _progress.yaml blockers section
//    - Notify orchestrator pattern (console output)
```

### 4. Worker Identification

```javascript
// Get worker identity from environment or context
function getWorkerId() {
  // Option 1: Environment variable
  if (process.env.WORKER_ID) return process.env.WORKER_ID

  // Option 2: Ask user on first run
  // Option 3: Auto-generate from terminal context

  return "terminal-b"  // Default fallback
}

// Filter tasks by my ownership
function getMyTasks() {
  let workerId = getWorkerId()
  let allTasks = TaskList()
  return allTasks.filter(t => t.owner === workerId)
}
```

### 5. Output Examples

#### /worker start
```
üöÄ Starting task...

=== Task #3: Implement /synthesis skill ===

Priority: P0
Status: in_progress (just updated)

üìã Instructions:
(Displays content from prompt file)

Next steps:
1. Read the reference files listed above
2. Implement the skill following the pattern
3. When done, run: /worker done
```

#### /worker done
```
‚úÖ Task #3 marked as completed!

üìä Progress: 2/3 tasks complete (66.7%)

üîú Next Task Available:
   Task #4: Implement /worker skill (P1)

Run `/worker start` to begin next task.
```

#### /worker status
```
=== Worker Status: terminal-b ===

Current Task: #3 Implement /synthesis skill
Status: in_progress
Started: 2026-01-24T18:20:00Z

Progress:
  ‚úÖ Completed: 1 task
  üîÑ In Progress: 1 task
  ‚è≥ Pending: 1 task

No blockers reported.
```

#### /worker block
```
/worker block "Missing API documentation for auth module"

‚ö†Ô∏è Blocker Reported!

Task: #3 Implement /synthesis skill
Blocker: Missing API documentation for auth module
Reported: 2026-01-24T18:25:00Z

üì¢ Orchestrator has been notified.
   Waiting for resolution...
```

### 6. Prompt File Management

```javascript
function movePromptFile(taskId, fromDir, toDir) {
  // Find prompt file for task
  let promptFiles = Glob(`.agent/prompts/${fromDir}/*-task${taskId}.yaml`)

  if (promptFiles.length === 0) {
    warn(`No prompt file found for task #${taskId}`)
    return false
  }

  let srcFile = promptFiles[0]
  let filename = srcFile.split('/').pop()
  let destFile = `.agent/prompts/${toDir}/${filename}`

  // Move file
  Bash(`mv ${srcFile} ${destFile}`)

  return true
}

// On /worker done
movePromptFile(taskId, "pending", "completed")
```

## Completion Criteria

- [ ] SKILL.md file created
- [ ] Frontmatter V2.1.19 compliant
- [ ] `/worker start` - Claims task, shows instructions
- [ ] `/worker done` - Marks complete, suggests next
- [ ] `/worker status` - Shows current state
- [ ] `/worker block` - Reports blockers
- [ ] TaskUpdate integration for all commands
- [ ] Prompt file lifecycle management
- [ ] Example usage with outputs
- [ ] Error handling section
- [ ] Testing checklist

## Workflow

1. Wait for Task #3 to complete
2. Orchestrator unblocks and assigns #4
3. `TaskUpdate(taskId="4", status="in_progress")`
4. Implement /worker skill
5. `TaskUpdate(taskId="4", status="completed")`
6. Notify Orchestrator - PIPELINE COMPLETE!

## Notes

- Use haiku model for fast responses (worker commands should be quick)
- This skill enables Workers to be more autonomous
- Focus on clear, actionable output
- Include progress tracking to motivate workers
- Error messages should suggest recovery actions
