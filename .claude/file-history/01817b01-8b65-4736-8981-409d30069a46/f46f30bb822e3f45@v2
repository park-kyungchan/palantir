# Worker Prompt: Implement /synthesis Skill
# Task ID: #3
# Assigned To: terminal-b
# Priority: P0 (Critical)
# Created: 2026-01-24

---
nativeTaskId: "3"
terminalId: "terminal-b"
status: pending
createdAt: "2026-01-24T18:20:00Z"
blockedBy: ["2"]  # Now unblocked

---

## Objective

Implement the `/synthesis` skill that creates traceability matrix, validates quality, and decides COMPLETE or ITERATE.

## Location

Create: `.claude/skills/synthesis/SKILL.md`

## Reference Files

Read these files for context and patterns:

1. **Newly Created Skill (Your Previous Work):**
   - `.claude/skills/collect/SKILL.md` - Reference for structure and patterns
   - `.agent/outputs/collection_report.md` - Input format you'll consume

2. **Existing Skill Structure:**
   - `.claude/skills/assign/SKILL.md` - Documentation pattern reference

3. **Clarify Log Location:**
   - `.agent/plans/clarify_*.md` - Where /clarify logs requirements
   - `.agent/outputs/synthesis/` - Where synthesis output goes

4. **Architecture Reference:**
   - `.claude/CLAUDE.md` - Section 3.1 E2E Pipeline

## Implementation Requirements

### 1. Frontmatter (V2.1.19 Compliant)

```yaml
---
name: synthesis
description: Traceability matrix, quality validation, completion decision
user-invocable: true
disable-model-invocation: false
context: standard
model: opus  # Use opus for quality analysis
version: 1.0.0
argument-hint: "[--strict | --lenient]"
---
```

### 2. Core Functions

```javascript
// 1. readRequirements()
//    - Find latest /clarify log in .agent/plans/clarify_*.md
//    - Parse original requirements and success criteria
//    - Return structured requirements list

// 2. readCollectionReport()
//    - Read .agent/outputs/collection_report.md
//    - Parse task summaries and deliverables
//    - Return structured deliverables list

// 3. buildTraceabilityMatrix()
//    - Map requirements ‚Üî deliverables
//    - Identify: covered, partial, missing requirements
//    - Return matrix with coverage percentage

// 4. validateQuality()
//    - Check consistency: No conflicting deliverables
//    - Check completeness: All requirements have deliverables
//    - Check coherence: Deliverables work together
//    - Return validation results

// 5. makeDecision()
//    - If coverage >= 80% and no critical issues ‚Üí COMPLETE
//    - If coverage < 80% or critical issues ‚Üí ITERATE
//    - Return decision with rationale

// 6. generateSynthesisReport()
//    - Output: .agent/outputs/synthesis/synthesis_report.md
//    - Include: matrix, validation, decision, next steps
```

### 3. Decision Logic

```javascript
// Decision Matrix
if (coverage >= 80% && criticalIssues === 0 && validationPassed) {
  return { decision: "COMPLETE", nextAction: "/commit-push-pr" }
}

if (coverage >= 60% && criticalIssues === 0) {
  return { decision: "COMPLETE_WITH_WARNINGS", nextAction: "/commit-push-pr" }
}

if (coverage < 60% || criticalIssues > 0) {
  return {
    decision: "ITERATE",
    nextAction: "/clarify",
    gaps: missingRequirements
  }
}
```

### 4. Output Format: Traceability Matrix

```markdown
## Traceability Matrix

| Requirement | Status | Deliverable(s) | Notes |
|-------------|--------|----------------|-------|
| REQ-001: User auth | ‚úÖ Covered | auth.ts, login.tsx | Fully implemented |
| REQ-002: Data validation | ‚ö†Ô∏è Partial | validator.ts | Missing edge cases |
| REQ-003: Error handling | ‚ùå Missing | - | Not addressed |

**Coverage: 66.7%** (2/3 requirements covered)
```

### 5. Output Format: Quality Validation

```markdown
## Quality Validation

### Consistency Check
- [ ] No conflicting implementations
- [ ] API contracts match
- [ ] Data types compatible

### Completeness Check
- [ ] All P0 requirements addressed
- [ ] Test coverage adequate
- [ ] Documentation complete

### Coherence Check
- [ ] Components integrate properly
- [ ] Error flows handled
- [ ] Edge cases considered
```

### 6. Output Format: Decision

```markdown
## Decision

**Status: COMPLETE** ‚úÖ

**Rationale:**
- Coverage: 85% (above 80% threshold)
- Critical Issues: 0
- Quality Validation: PASSED

**Next Action:**
```bash
/commit-push-pr
```

---

OR

---

**Status: ITERATE** üîÑ

**Rationale:**
- Coverage: 60% (below 80% threshold)
- Critical Issues: 1 (Missing error handling)
- Quality Validation: FAILED (consistency)

**Gaps to Address:**
1. REQ-003: Error handling not implemented
2. REQ-005: Edge cases missing

**Next Action:**
```bash
/clarify "Address missing requirements: error handling, edge cases"
```
```

### 7. Invocation Examples

```bash
/synthesis              # Standard synthesis (80% threshold)
/synthesis --strict     # Strict mode (95% threshold)
/synthesis --lenient    # Lenient mode (60% threshold)
```

## Completion Criteria

- [ ] SKILL.md file created at correct location
- [ ] Frontmatter V2.1.19 compliant
- [ ] Reads /clarify logs for requirements
- [ ] Reads collection_report.md for deliverables
- [ ] Generates traceability matrix
- [ ] Quality validation with 3 checks
- [ ] Decision logic with COMPLETE/ITERATE
- [ ] Example usage with outputs
- [ ] Error handling section
- [ ] Testing checklist

## Workflow

1. `TaskUpdate(taskId="3", status="in_progress")`
2. Read reference files (especially /collect SKILL.md)
3. Create `.claude/skills/synthesis/` directory
4. Implement SKILL.md
5. Test decision logic scenarios
6. `TaskUpdate(taskId="3", status="completed")`
7. Notify Orchestrator

## Notes

- This skill is the DECISION GATE in the E2E pipeline
- It must be conservative (prefer ITERATE over premature COMPLETE)
- Use opus model for better quality analysis
- Include clear rationale in decisions
- Support different strictness levels
