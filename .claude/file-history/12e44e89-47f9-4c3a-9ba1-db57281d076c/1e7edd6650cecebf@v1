---
name: execute
description: |
  Execute approved plan with Orchestrator-mode enforcement.
  Ensures Main Agent delegates all work to Subagents.
  Includes automatic result verification and recovery gate.
allowed-tools: Read, Grep, Glob, Bash, TodoWrite, Task, AskUserQuestion
argument-hint: [plan-file-path]
---

# /execute Command (Orchestrator Enforcement)

Execute an approved plan while **enforcing Orchestrator-only behavior**.
Main Agent is **prohibited from direct execution** - all work delegated to Subagents.

## Core Principle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ ORCHESTRATOR MODE                                           â”‚
â”‚                                                                 â”‚
â”‚  Main Agent = Conductor                                         â”‚
â”‚  - Reads plan                                                   â”‚
â”‚  - Assigns Subagents                                            â”‚
â”‚  - Verifies results                                             â”‚
â”‚  - NEVER executes directly                                      â”‚
â”‚                                                                 â”‚
â”‚  Subagents = Performers                                         â”‚
â”‚  - Explore: Analysis (15K budget)                               â”‚
â”‚  - Plan: Design (25K budget)                                    â”‚
â”‚  - general-purpose: Implementation (32K budget)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Arguments

$ARGUMENTS - Optional path to plan file (defaults to most recent IN_PROGRESS plan)

---

## 7-Step Execution Flow

### Step 1: ROLE DECLARATION (ì—­í•  ì„ ì–¸)

**Purpose:** Inject Orchestrator identity into TodoWrite as persistent reminder.

**Mandatory First Todo Item:**
```markdown
ğŸ¯ ORCHESTRATOR MODE ACTIVE
   â”œâ”€ ì§ì ‘ ì‹¤í–‰ ê¸ˆì§€: Edit, Write, ë³µì¡í•œ Bash ì‚¬ìš© ë¶ˆê°€
   â”œâ”€ ëª¨ë“  ì‘ì—…ì€ Task()ë¡œ Subagentì— ìœ„ì„
   â””â”€ ê²°ê³¼ ê²€ì¦ í•„ìˆ˜: ìš”ì•½ë§Œìœ¼ë¡œ ì§„í–‰ ê¸ˆì§€
```

### Step 2: PLAN RETRIEVAL (Plan ì½ê¸°)

**Purpose:** Load the approved plan file for execution.

**Plan File Resolution:**
1. Explicit argument (if provided)
2. Most recent IN_PROGRESS plan in `.agent/plans/`
3. Ask user to select

### Step 3: DELEGATION MAPPING (Subagent í• ë‹¹)

| Task Type | Keywords | Subagent | Budget |
|-----------|----------|----------|--------|
| Analysis | ë¶„ì„, íƒìƒ‰, ê²€í† , analyze, explore, audit | Explore | 15K |
| Design | ì„¤ê³„, ê³„íš, ì•„í‚¤í…ì²˜, design, plan, architecture | Plan | 25K |
| Implementation | êµ¬í˜„, ì‘ì„±, ìˆ˜ì •, implement, write, modify | general-purpose | 32K |
| Verification | ê²€ì¦, í…ŒìŠ¤íŠ¸, í™•ì¸, verify, test, check | general-purpose | 32K |

### Step 4: TODOWRITE GENERATION (TodoWrite ìƒì„±)

**Todo Item Format:**
```
[Phase N] {ì‘ì—… ì„¤ëª…}
  â†’ Delegate to: {Subagent}:pending | Budget: {N}K
  â†’ Verify: {ê²€ì¦ ìš”êµ¬ì‚¬í•­}
```

### Step 5: ORCHESTRATED EXECUTION (ì‹¤í–‰)

Deploy Subagents for each Phase, track Agent IDs in todo items.

### Step 6: RESULT VERIFICATION (ê²°ê³¼ ê²€ì¦) â˜… CRITICAL

**Reference:** `lib/oda/planning/output_layer_manager.py`

**HARD RULE:** Summary-only ê²°ê³¼ëŠ” ê±°ë¶€. L2/L3 ì ‘ê·¼í•˜ì—¬ ì „ì²´ ê²°ê³¼ í™•ë³´ í•„ìˆ˜.

### Step 7: RECOVERY GATE (ë³µêµ¬ ê²Œì´íŠ¸) â˜… BLOCKING

**BLOCKING GATE:** ì „ì²´ ê²°ê³¼ ì—†ì´ ë‹¤ìŒ Phase ì§„í–‰ ë¶ˆê°€.

---

## Orchestrator Enforcement Rules

### Main Agent ALLOWED Actions

| Action | Allowed | Reason |
|--------|---------|--------|
| `Read` | âœ… | Information gathering |
| `Grep`, `Glob` | âœ… | Search |
| `TodoWrite` | âœ… | Progress tracking |
| `Task()` | âœ… | Subagent delegation |
| `AskUserQuestion` | âœ… | User interaction |

### Main Agent PROHIBITED Actions

| Action | Prohibited | Redirect |
|--------|------------|----------|
| `Edit` | âŒ | `Task(subagent_type="general-purpose")` |
| `Write` | âŒ | `Task(subagent_type="general-purpose")` |
| Complex `Bash` | âŒ | `Task(subagent_type="general-purpose")` |

---

## Usage Examples

### Basic Usage (Auto-detect Plan)
```
/execute
```
â†’ Finds most recent IN_PROGRESS plan and executes

### Specific Plan
```
/execute l1_l2_orchestrating_loop
```
â†’ Executes `.agent/plans/l1_l2_orchestrating_loop.md`

### After /plan Approval
```
User: /plan ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ ì¶”ê°€
[Plan generated, awaiting approval]
User: ìŠ¹ì¸
User: /execute
[Orchestrator mode activated, executing plan...]
```

---

## Integration with /plan

| Workflow Step | Command | Output |
|---------------|---------|--------|
| 1. Requirements | `/ask` | Clarified requirements |
| 2. Planning | `/plan` | Approved plan file |
| 3. Execution | `/execute` | Implemented changes |
| 4. Verification | `/quality-check` | Quality gates passed |

---

## Error Handling

| Error | Cause | Resolution |
|-------|-------|------------|
| No plan found | No IN_PROGRESS plans | Ask user to run `/plan` first |
| Verification failed | Summary-only result | Resume agent or re-execute |
| Subagent timeout | Long-running task | Check L2/L3 for partial results |

---

## Evidence Requirements

- Each Phase MUST produce `files_viewed` evidence
- Results without evidence trigger verification failure
- Summary-only results are BLOCKED, not accepted
