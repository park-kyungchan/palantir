# /ask Skill Details Reference

> **Version:** 2.1.8 | **Purpose:** Extended documentation for /ask skill
> **Note:** Core protocol is in `.claude/skills/ask.md`. This file contains detailed implementation patterns.

---

## 1. Prompt Engineering Technique Detection

### Technique-Keyword Mapping

| Technique | Keywords (KO) | Keywords (EN) | WebSearch Query |
|-----------|---------------|---------------|-----------------|
| Chain-of-Thought | 단계별, 논리적, 순서대로 | step-by-step, logical, sequential | "chain of thought prompting 2026" |
| Few-Shot | 예시, 예를 들면, 샘플 | example, show me, sample | "few-shot learning prompting" |
| ReAct | 행동, 반복, 시도 | action, iterate, try | "ReAct prompting pattern" |
| Tree-of-Thought | 대안, 비교, 여러 방법 | alternative, compare, options | "tree of thought reasoning" |
| Self-Consistency | 확인, 검증, 일관성 | verify, validate, consistent | "self-consistency prompting" |
| Zero-Shot CoT | 생각해보면, 따져보면 | let's think, reasoning | "zero-shot chain of thought" |

### Detection Implementation

```python
TECHNIQUE_KEYWORDS = {
    "chain_of_thought": {
        "ko": ["단계별", "논리적", "순서대로", "차근차근"],
        "en": ["step-by-step", "logical", "sequential", "methodically"]
    },
    "few_shot": {
        "ko": ["예시", "예를 들면", "샘플", "보여줘"],
        "en": ["example", "show me", "sample", "demonstrate"]
    },
    "react": {
        "ko": ["행동", "반복", "시도", "실행하면서"],
        "en": ["action", "iterate", "try", "execute"]
    },
    "tree_of_thought": {
        "ko": ["대안", "비교", "여러 방법", "옵션"],
        "en": ["alternative", "compare", "options", "multiple ways"]
    }
}

def detect_technique(user_input: str) -> str | None:
    user_input_lower = user_input.lower()
    for technique, keywords in TECHNIQUE_KEYWORDS.items():
        for lang_keywords in keywords.values():
            for keyword in lang_keywords:
                if keyword in user_input_lower:
                    return technique
    return None
```

---

## 2. WebSearch Fallback

### When to Trigger

WebSearch is triggered when:
1. Prompt engineering technique keyword detected
2. User explicitly asks about prompting techniques
3. Latest best practices needed for specific task

### Query Templates

| Scenario | Query Template |
|----------|---------------|
| CoT Technique | "chain of thought prompting best practices 2026" |
| Few-Shot | "few-shot learning prompting examples 2026" |
| ReAct | "ReAct prompting agent pattern implementation" |
| General | "prompt engineering techniques {topic} 2026" |

### Integration

```python
if detected_technique := detect_technique(user_input):
    query = WEBSEARCH_QUERIES[detected_technique]

    WebSearch(
        query=query,
        prompt="Extract the latest best practices and implementation patterns"
    )
```

### Source Citation Requirement

After WebSearch, MUST include:

```markdown
Sources:
- [Title 1](URL1)
- [Title 2](URL2)
```

---

## 3. Full Routing Decision Tree

### Intent-to-Route Mapping

| Intent Category | Detection Keywords | Route Target |
|----------------|-------------------|--------------|
| Exploration | 분석, 이해, 설명, 구조, 탐색 | Explore Agent |
| Modification | 수정, 고쳐, 변경, 바꿔, 추가 | /plan -> Plan Mode |
| Review | 검사, 리뷰, 확인, 체크, 감사 | /audit |
| Deep Analysis | 심층, 깊이, 상세, 철저히 | /deep-audit |
| Planning | 계획, 설계, 아키텍처, 구현 | /plan |
| Ambiguous | (none matched) | /ask (continue) |

### Recommendation Matrix

```
User Intent + Complexity = Recommendation

┌────────────────┬───────────┬───────────┬───────────┐
│                │   Low     │  Medium   │   High    │
├────────────────┼───────────┼───────────┼───────────┤
│ Read/Analyze   │ Direct    │ Explore   │ Explore   │
│                │ Read      │ Agent     │ + /plan   │
├────────────────┼───────────┼───────────┼───────────┤
│ Write/Modify   │ Direct    │ /plan     │ /plan +   │
│                │ Edit      │           │ /audit    │
├────────────────┼───────────┼───────────┼───────────┤
│ Review/Check   │ /audit    │ /audit    │ /deep-    │
│                │           │           │ audit     │
└────────────────┴───────────┴───────────┴───────────┘
```

### Routing Implementation

```python
def recommend_skill(intent: str, complexity: str) -> str:
    """Recommend appropriate skill based on intent and complexity."""

    RECOMMENDATIONS = {
        ("explore", "low"): "Direct Read",
        ("explore", "medium"): "Explore Agent",
        ("explore", "high"): "Explore Agent + /plan",

        ("modify", "low"): "Direct Edit",
        ("modify", "medium"): "/plan",
        ("modify", "high"): "/plan + /audit",

        ("review", "low"): "/audit",
        ("review", "medium"): "/audit",
        ("review", "high"): "/deep-audit",
    }

    return RECOMMENDATIONS.get((intent, complexity), "/ask")
```

---

## 4. Proposal Integration

### Mutation Detection in Routing

When /ask routes to a skill that will modify files, include Proposal requirement in the routing context.

### When Proposal is Required

- Routing to `/plan` for implementation
- Routing to modification operations via Plan Mode
- Any intent classified as "modify", "fix", "change", "add"

### Intent-to-Proposal Mapping

| Intent Category | Route Target | Proposal Required | Proposal Type |
|----------------|--------------|-------------------|---------------|
| explore/analyze | Explore Agent | No | N/A |
| modify/fix | /plan → Implementation | Yes | file.modify |
| add/create | /plan → Implementation | Yes | file.write |
| remove/delete | /plan → Implementation | Yes | file.delete |
| review/check | /audit | Maybe | Auto-fix only |
| deep analysis | /deep-audit | Yes (if CRITICAL) | remediation |
| plan/design | /plan | Yes (on approval) | implementation |

### Routing with Proposal Context

```python
def route_with_proposal_context(intent: str, complexity: str, target: str) -> dict:
    """Route to appropriate skill with Proposal requirement awareness."""
    route_target = recommend_skill(intent, complexity)

    requires_proposal = intent in ["modify", "fix", "change", "add", "update", "remove"]

    routing_context = {
        "target_skill": route_target,
        "scope": target,
        "intent": intent,
        "complexity": complexity,
        "proposal_required": requires_proposal,
    }

    if requires_proposal:
        routing_context["proposal_notice"] = (
            "Changes from this operation will require Proposal approval."
        )

    return routing_context
```

---

## 5. Clarification Question Templates

### Scope Clarification

```markdown
## Scope
질문: "어떤 파일/모듈을 대상으로 할까요?"

Options:
- 특정 파일: [파일 경로 입력]
- 특정 모듈: [모듈명 입력]
- 전체 프로젝트
- 현재 작업 디렉토리
```

### Goal Clarification

```markdown
## Goal
질문: "최종 목표가 무엇인가요?"

Options:
- 코드 분석/이해
- 버그 수정
- 새 기능 구현
- 리팩토링/개선
- 문서화
- 테스트 작성
```

### Priority Clarification

```markdown
## Priority
질문: "우선순위가 있나요?"

Options:
- 긴급 (즉시 처리 필요)
- 높음 (오늘 내 완료)
- 보통 (일주일 내)
- 낮음 (시간 여유 있음)
```

### Task Type Clarification

```markdown
## Task Type
질문: "어떤 종류의 작업인가요?"

Options:
- 탐색/분석 (읽기 전용)
- 수정/변경 (파일 변경 필요)
- 검사/리뷰 (품질 확인)
- 계획/설계 (구현 전 계획)
```

### AskUserQuestion Implementation

```python
AskUserQuestion(
    questions=[{
        "question": "어떤 작업을 원하시나요?",
        "header": "Task Clarification",
        "options": [
            {"label": "코드 분석", "description": "코드 구조 이해 및 탐색"},
            {"label": "버그 수정", "description": "문제 진단 및 해결"},
            {"label": "기능 구현", "description": "새로운 기능 추가"},
            {"label": "리팩토링", "description": "코드 개선 및 정리"},
            {"label": "테스트", "description": "테스트 작성 또는 실행"}
        ],
        "multiSelect": false
    }]
)
```

---

## 6. Error Handling

### Common Scenarios

| Scenario | Handling |
|----------|----------|
| User refuses to answer | Proceed with best-effort routing |
| Ambiguity persists | Escalate to more specific questions |
| Technique not found | Use default prompting strategy |
| WebSearch fails | Fall back to built-in knowledge |

### Graceful Degradation

```python
try:
    technique = detect_technique(user_input)
    if technique:
        results = WebSearch(query=QUERIES[technique])
except WebSearchError:
    # Fallback to built-in patterns
    results = BUILTIN_PATTERNS[technique]
```

---

## 7. Modification Confirmation Template

For operations requiring file changes:

```python
AskUserQuestion(
    questions=[{
        "question": "이 작업은 파일을 수정합니다. 어떻게 진행할까요?",
        "header": "Modification Confirmation",
        "options": [
            {
                "label": "계획 검토 후 진행",
                "description": "/plan으로 먼저 계획을 세우고 Proposal 생성"
            },
            {
                "label": "감사 후 진행",
                "description": "/audit으로 먼저 품질 확인 후 Proposal 생성"
            },
            {
                "label": "직접 수정 (주의)",
                "description": "Proposal 없이 직접 수정 (권장하지 않음)"
            }
        ],
        "multiSelect": false
    }]
)
```

---

## 8. Routing Evidence Schema

```yaml
# /ask includes routing decision in evidence
ask_result:
  user_intent_parsed: true
  detected_intent: "modify"
  routed_to: "/plan"
  proposal_context:
    required: true
    reason: "Modification intent detected"
    expected_proposals:
      - type: "file.modify"
        scope: "lib/oda/ontology/"
  questions_asked: ["scope", "goal", "confirmation"]
  user_responses: ["specific_module", "bug_fix", "proceed_with_plan"]
```

---

> **Module Reference:** `lib/oda/planning/clarification_tracker.py`
