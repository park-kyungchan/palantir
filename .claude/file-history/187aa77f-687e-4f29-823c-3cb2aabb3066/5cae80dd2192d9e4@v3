"""
Orion ODA v3.0 - Planning Package
=================================

This package provides planning and execution orchestration modules
for the ODA (Ontology-Driven Architecture) system.

Modules:
    - output_layer_manager: 3-Layer Progressive-Disclosure (L1/L2/L3)
    - task_decomposer: Task decomposition for 32K token compliance
    - context_budget_manager: V2.1.7 effective context window management
    - agent_registry: Agent lifecycle tracking with resume support
    - l2_synthesizer: Multi-L2 report synthesis
    - output_schemas: Pydantic schemas for structured outputs
    - prompt_templates: Prompt generation utilities
    - deterministic_planner: Deterministic execution planning

Usage:
    from lib.oda.planning import (
        TaskDecomposer,
        ContextBudgetManager,
        OutputLayerManager,
        is_summary_only,
        verify_subagent_result,
    )
"""

from __future__ import annotations

# =============================================================================
# Task Decomposer - 32K Token Compliance
# =============================================================================
from .task_decomposer import (
    SubagentType,
    TokenBudget,
    SubTask,
    TaskDecomposer,
    should_decompose_task,
    decompose_task,
)

# =============================================================================
# Context Budget Manager - V2.1.7 Effective Window
# =============================================================================
from .context_budget_manager import (
    ThinkingMode,
    DelegationDecision,
    ContextWindow,
    SubagentBudget,
    AgentRecord,
    BudgetReport,
    ContextBudgetManager,
    get_session_manager,
    reset_session_manager,
    check_context_before_task,
    get_ultrathink_budget,
)

# =============================================================================
# Output Layer Manager - 3-Layer Progressive-Disclosure
# =============================================================================
from .output_layer_manager import (
    OutputLayer,
    TaskType,
    AgentStatus,
    HeadlineResult,
    StructuredReport,
    LayerAccessDecision,
    OutputLayerManager,
    # Utility functions
    format_agent_headline,
    save_structured_output,
    get_layer_for_task,
    get_output_manager,
    # V2.1.7 additions
    is_summary_only,
    read_layer_auto,
    verify_subagent_result,
    extract_agent_id_from_result,
)

# =============================================================================
# Agent Registry - Lifecycle Tracking
# =============================================================================
from .agent_registry import (
    AgentEntry,
    AgentRegistry,
    get_registry,
    register_agent,
    can_resume_agent,
    get_resumable_agents,
)

# =============================================================================
# L2 Synthesizer - Multi-Report Synthesis
# =============================================================================
from .l2_synthesizer import (
    L2Synthesizer,
    SynthesisOutput as L2SynthesisOutput,
    synthesize_l2_files,
    get_l2_base_path,
    get_agent_type_directory,
)

# =============================================================================
# Output Schemas - Pydantic Models
# =============================================================================
from .output_schemas import (
    Severity,
    Finding,
    DependencyInfo,
    ExploreOutput,
    PlanPhase,
    RiskItem,
    PlanOutput,
    AgentSummary,
    SynthesisOutput,
    ExecutionOutput,
    SCHEMA_REGISTRY,
    get_schema,
    get_json_schema,
    get_schema_prompt_block,
    validate_output,
    extract_structured_output,
)

# =============================================================================
# Prompt Templates
# =============================================================================
from .prompt_templates import (
    PromptTemplateBuilder,
    build_structured_prompt,
    get_template_path,
    list_available_templates,
    get_recommended_budget as get_prompt_recommended_budget,
)

# =============================================================================
# Deterministic Planner
# =============================================================================
from .deterministic_planner import (
    DeterministicPlan,
    Job,
    Plan,
    generate_deterministic_plan,
)

# =============================================================================
# Execution Orchestrator - Main Integration Facade
# =============================================================================
from .execution_orchestrator import (
    RecoveryDecision,
    ExecutionStatus,
    RecoveryOption,
    VerificationResult,
    PhaseResult,
    ExecutionResult,
    ExecutionOrchestrator,
    get_orchestrator,
    reset_orchestrator,
)

# =============================================================================
# Plan File - Bidirectional Markdown Sync
# =============================================================================
from .plan_file import (
    PlanStatus,
    PhaseStatus,
    AgentStatus as PlanAgentStatus,  # Alias to avoid conflict with output_layer_manager
    PlanMetadata,
    Overview,
    Requirement,
    PhaseTask,
    Phase,
    AgentEntry as PlanAgentEntry,  # Alias to avoid conflict with agent_registry
    ProgressEntry,
    PlanFile,
    load_plan,
    create_plan,
)

# =============================================================================
# TodoWrite Tracker - V2.1.8 Agent ID Lifecycle (NEW)
# =============================================================================
from .todowrite_tracker import (
    AgentLifecycleState,
    TrackedTodo,
    TodoWriteTracker,
    create_tracker,
    format_phase_todo,
)

# =============================================================================
# Package Metadata
# =============================================================================
__version__ = "3.1.0"  # V2.1.8 TodoWrite Tracker added
__all__ = [
    # Task Decomposer
    "SubagentType",
    "TokenBudget",
    "SubTask",
    "TaskDecomposer",
    "should_decompose_task",
    "decompose_task",
    # Context Budget Manager
    "ThinkingMode",
    "DelegationDecision",
    "ContextWindow",
    "SubagentBudget",
    "AgentRecord",
    "BudgetReport",
    "ContextBudgetManager",
    "get_session_manager",
    "reset_session_manager",
    "check_context_before_task",
    "get_ultrathink_budget",
    # Output Layer Manager
    "OutputLayer",
    "TaskType",
    "AgentStatus",
    "HeadlineResult",
    "StructuredReport",
    "LayerAccessDecision",
    "OutputLayerManager",
    "format_agent_headline",
    "save_structured_output",
    "get_layer_for_task",
    "get_output_manager",
    "is_summary_only",
    "read_layer_auto",
    "verify_subagent_result",
    "extract_agent_id_from_result",
    # Agent Registry
    "AgentEntry",
    "AgentRegistry",
    "get_registry",
    "register_agent",
    "can_resume_agent",
    "get_resumable_agents",
    # L2 Synthesizer
    "L2Synthesizer",
    "L2SynthesisOutput",
    "synthesize_l2_files",
    "get_l2_base_path",
    "get_agent_type_directory",
    # Output Schemas
    "Severity",
    "Finding",
    "DependencyInfo",
    "ExploreOutput",
    "PlanPhase",
    "RiskItem",
    "PlanOutput",
    "AgentSummary",
    "SynthesisOutput",
    "ExecutionOutput",
    "SCHEMA_REGISTRY",
    "get_schema",
    "get_json_schema",
    "get_schema_prompt_block",
    "validate_output",
    "extract_structured_output",
    # Prompt Templates
    "PromptTemplateBuilder",
    "build_structured_prompt",
    "get_template_path",
    "list_available_templates",
    "get_prompt_recommended_budget",
    # Deterministic Planner
    "DeterministicPlan",
    "Job",
    "Plan",
    "generate_deterministic_plan",
    # Execution Orchestrator
    "RecoveryDecision",
    "ExecutionStatus",
    "RecoveryOption",
    "VerificationResult",
    "PhaseResult",
    "ExecutionResult",
    "ExecutionOrchestrator",
    "get_orchestrator",
    "reset_orchestrator",
    # Plan File
    "PlanStatus",
    "PhaseStatus",
    "PlanAgentStatus",
    "PlanMetadata",
    "Overview",
    "Requirement",
    "PhaseTask",
    "Phase",
    "PlanAgentEntry",
    "ProgressEntry",
    "PlanFile",
    "load_plan",
    "create_plan",
    # TodoWrite Tracker (V2.1.8)
    "AgentLifecycleState",
    "TrackedTodo",
    "TodoWriteTracker",
    "create_tracker",
    "format_phase_todo",
]
