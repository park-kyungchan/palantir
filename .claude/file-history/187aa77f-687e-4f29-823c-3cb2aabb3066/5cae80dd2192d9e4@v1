"""
Orion ODA v3.0 - Planning Package
=================================

This package provides planning and execution orchestration modules
for the ODA (Ontology-Driven Architecture) system.

Modules:
    - output_layer_manager: 3-Layer Progressive-Disclosure (L1/L2/L3)
    - task_decomposer: Task decomposition for 32K token compliance
    - context_budget_manager: V2.1.7 effective context window management
    - agent_registry: Agent lifecycle tracking with resume support
    - l2_synthesizer: Multi-L2 report synthesis
    - output_schemas: Pydantic schemas for structured outputs
    - prompt_templates: Prompt generation utilities
    - deterministic_planner: Deterministic execution planning

Usage:
    from lib.oda.planning import (
        ExecutionOrchestrator,  # Main orchestration facade (Phase 3)
        PlanFile,               # Plan file model (Phase 2)
        TaskDecomposer,
        ContextBudgetManager,
        OutputLayerManager,
    )
"""

from __future__ import annotations

# =============================================================================
# Task Decomposer - 32K Token Compliance
# =============================================================================
from .task_decomposer import (
    SubagentType,
    TokenBudget,
    SubTask,
    TaskDecomposer,
    should_decompose_task,
    decompose_task,
)

# =============================================================================
# Context Budget Manager - V2.1.7 Effective Window
# =============================================================================
from .context_budget_manager import (
    ThinkingMode,
    DelegationDecision,
    ContextWindow,
    SubagentBudget,
    AgentRecord,
    BudgetReport,
    ContextBudgetManager,
    get_budget_manager,
)

# =============================================================================
# Output Layer Manager - 3-Layer Progressive-Disclosure
# =============================================================================
from .output_layer_manager import (
    OutputLayer,
    TaskType,
    AgentStatus,
    HeadlineResult,
    StructuredReport,
    LayerAccessDecision,
    OutputLayerManager,
    # Utility functions
    format_agent_headline,
    save_structured_output,
    get_layer_for_task,
    get_output_manager,
    # V2.1.7 additions
    is_summary_only,
    read_layer_auto,
    verify_subagent_result,
    extract_agent_id_from_result,
)

# =============================================================================
# Agent Registry - Lifecycle Tracking
# =============================================================================
from .agent_registry import (
    AgentEntry,
    AgentRegistry,
    get_agent_registry,
)

# =============================================================================
# L2 Synthesizer - Multi-Report Synthesis
# =============================================================================
from .l2_synthesizer import (
    L2Report,
    SynthesisResult,
    L2Synthesizer,
    synthesize_l2_reports,
)

# =============================================================================
# Output Schemas - Pydantic Models
# =============================================================================
from .output_schemas import (
    Severity,
    Finding,
    DependencyInfo,
    ExploreOutput,
    PlanPhase,
    RiskItem,
    PlanOutput,
    AgentSummary,
    SynthesisOutput,
    ExecutionOutput,
    SCHEMA_REGISTRY,
    get_schema,
    get_json_schema,
    get_schema_prompt_block,
    validate_output,
    extract_structured_output,
)

# =============================================================================
# Prompt Templates
# =============================================================================
from .prompt_templates import (
    PromptTemplate,
    PromptBuilder,
    get_subagent_prompt,
)

# =============================================================================
# Deterministic Planner
# =============================================================================
from .deterministic_planner import (
    DeterministicPlanner,
    PlanStep,
)

# =============================================================================
# Package Metadata
# =============================================================================
__version__ = "3.0.0"
__all__ = [
    # Task Decomposer
    "SubagentType",
    "TokenBudget",
    "SubTask",
    "TaskDecomposer",
    "should_decompose_task",
    "decompose_task",
    # Context Budget Manager
    "ThinkingMode",
    "DelegationDecision",
    "ContextWindow",
    "SubagentBudget",
    "AgentRecord",
    "BudgetReport",
    "ContextBudgetManager",
    "get_budget_manager",
    # Output Layer Manager
    "OutputLayer",
    "TaskType",
    "AgentStatus",
    "HeadlineResult",
    "StructuredReport",
    "LayerAccessDecision",
    "OutputLayerManager",
    "format_agent_headline",
    "save_structured_output",
    "get_layer_for_task",
    "get_output_manager",
    "is_summary_only",
    "read_layer_auto",
    "verify_subagent_result",
    "extract_agent_id_from_result",
    # Agent Registry
    "AgentEntry",
    "AgentRegistry",
    "get_agent_registry",
    # L2 Synthesizer
    "L2Report",
    "SynthesisResult",
    "L2Synthesizer",
    "synthesize_l2_reports",
    # Output Schemas
    "Severity",
    "Finding",
    "DependencyInfo",
    "ExploreOutput",
    "PlanPhase",
    "RiskItem",
    "PlanOutput",
    "AgentSummary",
    "SynthesisOutput",
    "ExecutionOutput",
    "SCHEMA_REGISTRY",
    "get_schema",
    "get_json_schema",
    "get_schema_prompt_block",
    "validate_output",
    "extract_structured_output",
    # Prompt Templates
    "PromptTemplate",
    "PromptBuilder",
    "get_subagent_prompt",
    # Deterministic Planner
    "DeterministicPlanner",
    "PlanStep",
]
