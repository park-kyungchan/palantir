# /build Command - Unified System Component Builder

> **Version:** 2.0.0 | **Type:** Interactive Q&A Builder
> **Scope:** Agent, Skill, Hook creation via progressive Q&A rounds
> **Claude Code Compatibility:** V2.1.15+

---

## Purpose

Create new system components (Agents, Skills, Hooks) through an interactive Q&A workflow that guides users through all required and optional fields.

## Usage

```
/build                    # Start interactive builder
/build agent              # Start Agent builder directly
/build skill              # Start Skill builder directly
/build hook               # Start Hook builder directly
/build --resume <name>    # Resume an incomplete draft
```

## Arguments

- `$ARGUMENTS` - Optional: component type (agent/skill/hook) or --resume flag

---

## Execution Flow

### Phase 1: Type Selection

If no type specified, present selection:

```
AskUserQuestion(
  questions=[{
    "question": "어떤 컴포넌트를 생성하시겠습니까?",
    "header": "Component",
    "options": [
      {"label": "Agent", "description": "Specialized subagent with tools and context"},
      {"label": "Skill", "description": "Reusable workflow invoked via /command"},
      {"label": "Hook", "description": "Event-driven script (12 event types supported)"}
    ],
    "multiSelect": false
  }]
)
```

### Phase 2: Q&A Rounds

Based on selected type, proceed through comprehensive Q&A rounds.

Reference: `.agent/plans/draft_create_command_v1.md#qa-patterns` for full Q&A specifications.

### Phase 3: Draft Generation

After Q&A completion:
1. Save draft to `.agent/plans/create_drafts/{type}_{name}.md`
2. Show preview of generated file
3. Ask for confirmation

### Phase 4: File Generation

On confirmation:
1. Generate actual file(s) to target location
2. Register in appropriate registry if applicable
3. Provide test command

---

## Q&A Pattern References

### Agent (15 Rounds)

| Category | Rounds | Fields |
|----------|--------|--------|
| Core Identity | 1-3 | name, description, disable-model-invocation |
| Tool Config | 4-6 | tools, disallowedTools, mcp_tools |
| Context | 7-9 | model, context, permissionMode |
| Integration | 10-12 | skills, hooks, customInstructions |
| Advanced | 13-15 | maxTurns, timeout, v21x_features |

**Agent Fields Reference:**
```yaml
# Core (Required)
name: string              # Unique agent identifier
description: string       # What this agent does

# Tools
tools: string[]           # Allowed tools (Read, Grep, Glob, Task, etc.)
disallowedTools: string[] # Explicitly denied tools
mcp_tools: string[]       # MCP server tools (mcp__server__tool format)

# Execution
model: enum               # sonnet | opus | haiku
context: enum             # standard | fork (V2.1.x+)
permissionMode: enum      # auto | confirm | deny

# Optional
disable-model-invocation: bool  # Prevent direct model calls
skills: string[]          # Skills this agent can invoke
hooks: string[]           # Associated hooks
maxTurns: number          # Max turns before stopping
```

### Skill (13 Rounds)

| Category | Rounds | Fields |
|----------|--------|--------|
| Identity | 1-3 | name, description, user-invocable |
| Execution | 4-6 | context, agent, model |
| Tools | 7-9 | allowed-tools, argument-hint, hooks |
| Control | 10-11 | disable-model-invocation, once |
| Features | 12-13 | content-type, ultrathink |

**Skill Fields Reference:**
```yaml
# Core (Required)
name: string              # Skill name (becomes /name command)
description: string       # Displayed in skill list

# Execution
user-invocable: bool      # Can user invoke directly? (default: true)
context: enum             # standard | fork
agent: string             # Agent to use when context: fork
model: enum               # sonnet | opus | haiku

# Tools
allowed-tools: string[]   # Tools available during skill execution
argument-hint: string     # Autocomplete hint for arguments

# Control (V2.1.x+)
disable-model-invocation: bool  # Prevent model from invoking this skill
once: bool                # Run only once per session

# Hooks
hooks: object             # Associated hooks
  PreToolUse: string[]
  PostToolUse: string[]
```

### Hook (16 Rounds)

| Category | Rounds | Fields |
|----------|--------|--------|
| Identity | 1-3 | name, event-type, language |
| Trigger | 4-6 | matcher, timeout, type |
| Input/Output | 7-10 | permission, updatedInput, additionalContext, input-fields |
| Output Schema | 11-13 | output-fields, blocking, json-schema |
| Advanced | 14-16 | env-vars, logging, once |

**Hook Event Types (12 Total):**

| Event Type | Trigger Point | Use Cases |
|------------|---------------|-----------|
| `SessionStart` | Session begins | Init, env setup |
| `SessionEnd` | Session ends | Cleanup, logging |
| `Setup` | Repository initialization | Project setup |
| `UserPromptSubmit` | User sends prompt | Input validation, logging |
| `PreToolUse` | Before tool execution | Permission gate, validation |
| `PostToolUse` | After successful tool | Audit, transformation |
| `PostToolUseFailure` | After tool failure | Error handling, retry logic |
| `PermissionRequest` | Permission prompt | Auto-approve, custom prompts |
| `PreCompact` | Before context compact | State preservation |
| `Notification` | System notification | Custom alerts |
| `SubagentStart` | Subagent begins | Monitoring, context injection |
| `SubagentStop` | Subagent ends | Result capture, cleanup |
| `Stop` | Session/agent stops | Final cleanup |

**Hook Type (V2.1.x+):**

| Type | Description | Use Case |
|------|-------------|----------|
| `command` | Shell command execution | Script-based hooks |
| `prompt` | LLM-based evaluation | Intelligent decision hooks |

**Hook Fields Reference:**
```yaml
# Identity
name: string              # Hook identifier
event: enum               # One of 12 event types above

# Trigger
matcher: string           # Regex pattern (e.g., "Bash|Edit|Write")
timeout: number           # Milliseconds (default: 60000)
type: enum                # command | prompt (V2.1.x+)

# For type: command
command: string           # Shell command to execute

# For type: prompt (V2.1.x+)
prompt: string            # LLM prompt for evaluation

# Output (JSON)
output_schema:
  continue: bool          # Continue execution?
  stopReason: string      # Why stopped (if continue: false)
  suppressOutput: bool    # Hide tool output?
  systemMessage: string   # Inject system message
  permissionDecision: enum # allow | deny | ask (PreToolUse only)
  additionalContext: string # Add context to conversation
  updatedInput: object    # Modify tool input

# Control
blocking: bool            # Block until complete?
once: bool                # Run only once per session
```

---

## Output Locations

| Type | Target Path |
|------|-------------|
| Agent | `.claude/agents/{name}.md` |
| Skill | `.claude/skills/{name}.md` |
| Hook (bash) | `.claude/hooks/{path}/{name}.sh` |
| Hook (python) | `.claude/hooks/{path}/{name}.py` |
| Draft | `.agent/plans/create_drafts/{type}_{name}.md` |

---

## Integration

### With /plan
After draft creation, use `/plan --draft create_{type}_{name}` for Plan Agent review.

### With Templates
Templates at `.claude/templates/` provide baseline structure:
- `agent.yaml`
- `skill.yaml`
- `hook-bash.sh`
- `hook-python.py`

---

## Examples

### Create Security Validator Agent
```
/build agent
→ Q1: "security-validator"
→ Q2: "Validates security patterns in code changes"
→ Q4: [Read, Grep, Glob]
→ Q7: "sonnet"
→ Q8: "fork"
→ ...
```

### Create Audit Skill
```
/build skill
→ Q1: "quick-audit"
→ Q2: "Fast code quality check"
→ Q3: user-invocable: true
→ Q10: disable-model-invocation: false
→ ...
```

### Create PreToolUse Hook (Command Type)
```
/build hook
→ Q1: "permission-gate"
→ Q2: "PreToolUse"
→ Q3: "Python"
→ Q4: "Bash|Edit|Write"
→ Q6: "command"
→ ...
```

### Create Prompt-based Hook (V2.1.x+)
```
/build hook
→ Q1: "smart-reviewer"
→ Q2: "PostToolUse"
→ Q3: "N/A (prompt type)"
→ Q4: "Edit|Write"
→ Q6: "prompt"
→ Q7: "Review this code change for security issues..."
→ ...
```

### Create PostToolUseFailure Hook
```
/build hook
→ Q1: "error-handler"
→ Q2: "PostToolUseFailure"
→ Q3: "Python"
→ Q4: ".*"  # Match all tools
→ ...
```

---

## V2.1.x+ New Features

### Prompt-based Hooks
Instead of shell scripts, use LLM to evaluate conditions:

```yaml
hooks:
  - matcher: "Edit|Write"
    type: prompt
    prompt: |
      Evaluate if this code change follows our security guidelines.
      Return JSON: {"continue": true/false, "reason": "..."}
```

### PostToolUseFailure Event
Handle tool execution failures gracefully:

```yaml
hooks:
  - matcher: "Bash"
    type: command
    command: "python .claude/hooks/handle_bash_failure.py"
```

### once Flag
Run a hook only once per session:

```yaml
hooks:
  - matcher: ".*"
    type: command
    command: "python .claude/hooks/session_init.py"
    once: true
```

---

## Notes

- All Q&A can be skipped with defaults where applicable
- Draft saves automatically after each round
- Use `--resume` to continue incomplete builds
- Generated files include all required fields for V2.1.x compatibility
- Hook JSON output schema is validated automatically
