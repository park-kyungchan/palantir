{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://oda.palantir.local/schemas/ActionType.schema.json",
  "title": "ActionType Definition Schema",
  "description": "Palantir Foundry-aligned ActionType definition for ODA system. An ActionType is the schema definition of a set of changes or edits to objects, property values, and links that a user can take at once.",
  "type": "object",
  "properties": {
    "apiName": {
      "type": "string",
      "description": "Programmatic identifier (immutable once Active). No spaces or special characters.",
      "pattern": "^[a-zA-Z][a-zA-Z0-9_.]*$",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["createEmployee", "file.modify", "branch.merge", "assignToProject"]
    },
    "displayName": {
      "type": "string",
      "description": "Human-friendly UI name for this action.",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["Create Employee", "Modify File", "Merge Branch"]
    },
    "description": {
      "type": "string",
      "description": "Documentation describing what this action does and when to use it.",
      "maxLength": 4096
    },
    "rid": {
      "type": "string",
      "description": "Resource ID - global unique identifier. Auto-generated by system.",
      "pattern": "^ri\\.ontology\\.[a-z]+\\.action-type\\.[a-zA-Z0-9-]+$",
      "readOnly": true
    },
    "category": {
      "type": "string",
      "description": "Action category for organization and filtering.",
      "examples": ["file", "branch", "rbac", "quality", "memory"]
    },
    "hazardous": {
      "type": "boolean",
      "description": "If true, this action requires Proposal approval workflow before execution.",
      "default": false
    },
    "parameters": {
      "type": "array",
      "description": "User inputs required for this action.",
      "items": {
        "$ref": "#/$defs/ActionParameter"
      },
      "default": []
    },
    "affectedObjectTypes": {
      "type": "array",
      "description": "ObjectTypes that this action can create, modify, or delete.",
      "items": {
        "$ref": "#/$defs/AffectedObjectType"
      },
      "minItems": 1
    },
    "editSpecifications": {
      "type": "array",
      "description": "Declarative edit operations (rules) that define what changes occur.",
      "items": {
        "$ref": "#/$defs/EditSpecification"
      }
    },
    "submissionCriteria": {
      "type": "array",
      "description": "Boolean conditions that must be true to submit/execute this action.",
      "items": {
        "$ref": "#/$defs/SubmissionCriterion"
      },
      "default": []
    },
    "sideEffects": {
      "type": "array",
      "description": "Post-execution effects (notifications, webhooks, etc.).",
      "items": {
        "$ref": "#/$defs/SideEffect"
      },
      "default": []
    },
    "implementation": {
      "$ref": "#/$defs/ActionImplementation",
      "description": "How the action is implemented (declarative rules or function-backed)."
    },
    "permissions": {
      "$ref": "#/$defs/ActionPermissions",
      "description": "Permission requirements to execute this action."
    },
    "status": {
      "$ref": "#/$defs/ActionTypeStatus",
      "description": "Lifecycle status of the ActionType.",
      "default": "EXPERIMENTAL"
    },
    "auditConfig": {
      "$ref": "#/$defs/AuditConfig",
      "description": "Configuration for action logging and tracking."
    },
    "undoConfig": {
      "$ref": "#/$defs/UndoConfig",
      "description": "Configuration for undo/revert capability."
    },
    "metadata": {
      "$ref": "#/$defs/ActionTypeMetadata",
      "description": "Auxiliary tracking information."
    }
  },
  "required": ["apiName", "displayName", "affectedObjectTypes", "implementation"],
  "additionalProperties": false,
  "$defs": {
    "ActionParameter": {
      "type": "object",
      "description": "Input parameter definition for the action.",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "Unique parameter identifier.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly parameter name."
        },
        "description": {
          "type": "string",
          "description": "Parameter documentation."
        },
        "dataType": {
          "$ref": "#/$defs/ParameterDataType",
          "description": "Data type for this parameter."
        },
        "required": {
          "type": "boolean",
          "description": "If true, parameter must be provided.",
          "default": false
        },
        "defaultValue": {
          "description": "Default value if not provided."
        },
        "constraints": {
          "$ref": "#/$defs/ParameterConstraints",
          "description": "Validation constraints for this parameter."
        },
        "uiHints": {
          "$ref": "#/$defs/ParameterUIHints",
          "description": "UI rendering hints."
        }
      },
      "required": ["apiName", "displayName", "dataType"],
      "additionalProperties": false
    },
    "ParameterDataType": {
      "type": "object",
      "description": "Data type specification for action parameter.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Base type.",
          "enum": [
            "STRING",
            "INTEGER",
            "LONG",
            "FLOAT",
            "DOUBLE",
            "BOOLEAN",
            "DATE",
            "TIMESTAMP",
            "ARRAY",
            "OBJECT_PICKER",
            "OBJECT_SET",
            "ATTACHMENT",
            "STRUCT"
          ]
        },
        "objectTypeRef": {
          "type": "string",
          "description": "For OBJECT_PICKER/OBJECT_SET, the ObjectType apiName to pick from."
        },
        "arrayItemType": {
          "$ref": "#/$defs/ParameterDataType",
          "description": "For ARRAY type, the item type."
        },
        "structDefinition": {
          "type": "object",
          "description": "For STRUCT type, the field definitions."
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "ParameterConstraints": {
      "type": "object",
      "description": "Validation constraints for action parameter.",
      "properties": {
        "enum": {
          "type": "array",
          "description": "Allowed values.",
          "items": {}
        },
        "minValue": { "type": "number" },
        "maxValue": { "type": "number" },
        "minLength": { "type": "integer", "minimum": 0 },
        "maxLength": { "type": "integer", "minimum": 0 },
        "pattern": { "type": "string", "format": "regex" },
        "objectFilter": {
          "type": "string",
          "description": "For OBJECT_PICKER, filter expression to limit selectable objects."
        }
      },
      "additionalProperties": false
    },
    "ParameterUIHints": {
      "type": "object",
      "description": "UI rendering hints for parameter input.",
      "properties": {
        "inputType": {
          "type": "string",
          "enum": ["text", "textarea", "number", "select", "multiselect", "datepicker", "filepicker", "objectpicker"]
        },
        "placeholder": { "type": "string" },
        "helperText": { "type": "string" },
        "order": { "type": "integer", "description": "Display order in form." }
      },
      "additionalProperties": false
    },
    "AffectedObjectType": {
      "type": "object",
      "description": "ObjectType affected by this action.",
      "properties": {
        "objectTypeApiName": {
          "type": "string",
          "description": "apiName of the affected ObjectType."
        },
        "operations": {
          "type": "array",
          "description": "Operations this action can perform on this ObjectType.",
          "items": {
            "type": "string",
            "enum": ["CREATE", "MODIFY", "DELETE"]
          }
        },
        "modifiableProperties": {
          "type": "array",
          "description": "For MODIFY, which properties can be changed. Empty = all.",
          "items": { "type": "string" }
        }
      },
      "required": ["objectTypeApiName", "operations"],
      "additionalProperties": false
    },
    "EditSpecification": {
      "type": "object",
      "description": "Declarative edit operation that defines a specific change.",
      "properties": {
        "operationType": {
          "type": "string",
          "description": "Type of edit operation.",
          "enum": [
            "CREATE_OBJECT",
            "MODIFY_OBJECT",
            "DELETE_OBJECT",
            "CREATE_LINK",
            "DELETE_LINK",
            "MODIFY_PROPERTY"
          ]
        },
        "targetObjectType": {
          "type": "string",
          "description": "ObjectType being affected."
        },
        "targetLinkType": {
          "type": "string",
          "description": "For link operations, the LinkType being affected."
        },
        "propertyMappings": {
          "type": "array",
          "description": "How parameter values map to object properties.",
          "items": {
            "$ref": "#/$defs/PropertyMapping"
          }
        },
        "objectSelection": {
          "$ref": "#/$defs/ObjectSelection",
          "description": "How to select which object(s) to modify/delete."
        },
        "linkSelection": {
          "$ref": "#/$defs/LinkSelection",
          "description": "For link operations, how to select the objects to link."
        },
        "conditional": {
          "$ref": "#/$defs/EditCondition",
          "description": "Condition that must be true for this edit to apply."
        }
      },
      "required": ["operationType"],
      "additionalProperties": false
    },
    "PropertyMapping": {
      "type": "object",
      "description": "Mapping from action parameter to object property.",
      "properties": {
        "targetProperty": {
          "type": "string",
          "description": "apiName of the property to set."
        },
        "sourceParameter": {
          "type": "string",
          "description": "apiName of the parameter providing the value."
        },
        "staticValue": {
          "description": "Static value to set (instead of parameter)."
        },
        "expression": {
          "type": "string",
          "description": "Expression to compute the value."
        }
      },
      "required": ["targetProperty"],
      "additionalProperties": false
    },
    "ObjectSelection": {
      "type": "object",
      "description": "How to select object(s) for modification/deletion.",
      "properties": {
        "selectionType": {
          "type": "string",
          "enum": ["PARAMETER", "QUERY", "CURRENT"]
        },
        "parameterRef": {
          "type": "string",
          "description": "For PARAMETER, the parameter containing the object reference."
        },
        "queryExpression": {
          "type": "string",
          "description": "For QUERY, expression to find objects."
        }
      },
      "required": ["selectionType"],
      "additionalProperties": false
    },
    "LinkSelection": {
      "type": "object",
      "description": "How to select objects for link creation/deletion.",
      "properties": {
        "sourceObjectParameter": {
          "type": "string",
          "description": "Parameter containing source object reference."
        },
        "targetObjectParameter": {
          "type": "string",
          "description": "Parameter containing target object reference."
        },
        "sourceObjectQuery": {
          "type": "string",
          "description": "Query to find source object(s)."
        },
        "targetObjectQuery": {
          "type": "string",
          "description": "Query to find target object(s)."
        }
      },
      "additionalProperties": false
    },
    "EditCondition": {
      "type": "object",
      "description": "Condition for conditional edit execution.",
      "properties": {
        "conditionType": {
          "type": "string",
          "enum": ["PARAMETER_EQUALS", "PARAMETER_NOT_NULL", "OBJECT_STATE", "EXPRESSION"]
        },
        "parameterRef": { "type": "string" },
        "expectedValue": {},
        "expression": { "type": "string" }
      },
      "required": ["conditionType"],
      "additionalProperties": false
    },
    "SubmissionCriterion": {
      "type": "object",
      "description": "Precondition that must be satisfied to execute the action.",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "Unique identifier for this criterion."
        },
        "displayName": {
          "type": "string",
          "description": "Human-readable criterion name."
        },
        "description": {
          "type": "string",
          "description": "Explanation of what this criterion checks."
        },
        "criterionType": {
          "type": "string",
          "enum": [
            "PARAMETER_VALIDATION",
            "OBJECT_STATE_CHECK",
            "PERMISSION_CHECK",
            "CARDINALITY_CHECK",
            "CUSTOM_FUNCTION"
          ]
        },
        "expression": {
          "type": "string",
          "description": "Boolean expression that must evaluate to true."
        },
        "errorMessage": {
          "type": "string",
          "description": "Message to display if criterion fails."
        },
        "severity": {
          "type": "string",
          "enum": ["ERROR", "WARNING"],
          "default": "ERROR"
        }
      },
      "required": ["apiName", "criterionType"],
      "additionalProperties": false
    },
    "SideEffect": {
      "type": "object",
      "description": "Post-execution effect that occurs after successful action completion.",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "Unique identifier for this side effect."
        },
        "effectType": {
          "type": "string",
          "description": "Type of side effect.",
          "enum": ["NOTIFICATION", "WEBHOOK", "EMAIL", "AUDIT_LOG", "TRIGGER_ACTION", "CUSTOM_FUNCTION"]
        },
        "configuration": {
          "$ref": "#/$defs/SideEffectConfig",
          "description": "Configuration specific to the effect type."
        },
        "conditional": {
          "$ref": "#/$defs/EditCondition",
          "description": "Condition for when this side effect should trigger."
        },
        "async": {
          "type": "boolean",
          "description": "If true, side effect runs asynchronously.",
          "default": true
        }
      },
      "required": ["apiName", "effectType", "configuration"],
      "additionalProperties": false
    },
    "SideEffectConfig": {
      "type": "object",
      "description": "Configuration for side effect execution.",
      "properties": {
        "notificationConfig": {
          "type": "object",
          "properties": {
            "recipients": {
              "type": "array",
              "items": { "type": "string" },
              "description": "User IDs or group IDs to notify."
            },
            "recipientExpression": {
              "type": "string",
              "description": "Expression to compute recipients dynamically."
            },
            "messageTemplate": {
              "type": "string",
              "description": "Notification message template with parameter placeholders."
            },
            "channel": {
              "type": "string",
              "enum": ["IN_APP", "EMAIL", "SLACK", "TEAMS"],
              "default": "IN_APP"
            }
          }
        },
        "webhookConfig": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "format": "uri",
              "description": "Webhook endpoint URL."
            },
            "method": {
              "type": "string",
              "enum": ["POST", "PUT", "PATCH"],
              "default": "POST"
            },
            "headers": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            },
            "payloadTemplate": {
              "type": "string",
              "description": "JSON template for request body."
            },
            "retryPolicy": {
              "type": "object",
              "properties": {
                "maxRetries": { "type": "integer", "default": 3 },
                "retryDelay": { "type": "integer", "description": "Delay in milliseconds", "default": 1000 }
              }
            }
          }
        },
        "triggerActionConfig": {
          "type": "object",
          "properties": {
            "actionApiName": {
              "type": "string",
              "description": "apiName of action to trigger."
            },
            "parameterMappings": {
              "type": "object",
              "additionalProperties": { "type": "string" },
              "description": "Map current action parameters to triggered action parameters."
            }
          }
        }
      },
      "additionalProperties": false
    },
    "ActionImplementation": {
      "type": "object",
      "description": "How the action logic is implemented.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Implementation type.",
          "enum": ["DECLARATIVE", "FUNCTION_BACKED", "INLINE_EDIT"]
        },
        "functionRef": {
          "type": "string",
          "description": "For FUNCTION_BACKED, reference to the implementing function."
        },
        "functionLanguage": {
          "type": "string",
          "description": "For FUNCTION_BACKED, the implementation language.",
          "enum": ["TYPESCRIPT", "PYTHON"]
        },
        "functionConfig": {
          "type": "object",
          "description": "Additional function configuration.",
          "properties": {
            "timeout": { "type": "integer", "description": "Timeout in milliseconds", "default": 30000 },
            "retries": { "type": "integer", "default": 0 }
          }
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "ActionPermissions": {
      "type": "object",
      "description": "Permission requirements for action execution.",
      "properties": {
        "requiredRoles": {
          "type": "array",
          "description": "Roles that can execute this action.",
          "items": { "type": "string" }
        },
        "requiredPermissions": {
          "type": "array",
          "description": "Specific permissions required.",
          "items": { "type": "string" }
        },
        "objectTypePermissions": {
          "type": "array",
          "description": "Required permissions on affected ObjectTypes.",
          "items": {
            "type": "object",
            "properties": {
              "objectTypeApiName": { "type": "string" },
              "requiredAccess": {
                "type": "string",
                "enum": ["READ", "WRITE", "DELETE", "ADMIN"]
              }
            },
            "required": ["objectTypeApiName", "requiredAccess"]
          }
        }
      },
      "additionalProperties": false
    },
    "ActionTypeStatus": {
      "type": "string",
      "description": "Lifecycle status of the ActionType. Note: Endorsed status NOT supported for ActionType.",
      "enum": [
        "DRAFT",
        "EXPERIMENTAL",
        "ALPHA",
        "BETA",
        "ACTIVE",
        "STABLE",
        "DEPRECATED",
        "SUNSET",
        "ARCHIVED",
        "DELETED"
      ],
      "default": "EXPERIMENTAL"
    },
    "AuditConfig": {
      "type": "object",
      "description": "Configuration for action execution audit trail.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "If true, all executions are logged.",
          "default": true
        },
        "logLevel": {
          "type": "string",
          "description": "Detail level for audit logs.",
          "enum": ["MINIMAL", "STANDARD", "DETAILED"],
          "default": "STANDARD"
        },
        "includeParameters": {
          "type": "boolean",
          "description": "If true, parameter values are logged.",
          "default": true
        },
        "includeBeforeAfter": {
          "type": "boolean",
          "description": "If true, before/after state snapshots are logged.",
          "default": true
        },
        "sensitiveParameters": {
          "type": "array",
          "description": "Parameter apiNames to mask in logs.",
          "items": { "type": "string" }
        },
        "retentionDays": {
          "type": "integer",
          "description": "Days to retain audit logs.",
          "minimum": 1,
          "default": 365
        }
      },
      "additionalProperties": false
    },
    "UndoConfig": {
      "type": "object",
      "description": "Configuration for undo/revert capability.",
      "properties": {
        "undoable": {
          "type": "boolean",
          "description": "If true, action can be undone/reverted.",
          "default": false
        },
        "undoWindowMinutes": {
          "type": "integer",
          "description": "Time window in minutes during which undo is allowed.",
          "minimum": 0,
          "default": 60
        },
        "undoStrategy": {
          "type": "string",
          "description": "How undo is performed.",
          "enum": ["INVERSE_ACTION", "RESTORE_SNAPSHOT", "CUSTOM_FUNCTION"],
          "default": "RESTORE_SNAPSHOT"
        },
        "inverseActionRef": {
          "type": "string",
          "description": "For INVERSE_ACTION, the action to execute for undo."
        }
      },
      "additionalProperties": false
    },
    "ActionTypeMetadata": {
      "type": "object",
      "description": "Auxiliary tracking information.",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "readOnly": true
        },
        "createdBy": {
          "type": "string",
          "readOnly": true
        },
        "modifiedAt": {
          "type": "string",
          "format": "date-time",
          "readOnly": true
        },
        "modifiedBy": {
          "type": "string",
          "readOnly": true
        },
        "version": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "readOnly": true
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "module": {
          "type": "string",
          "description": "Module or domain this action belongs to."
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "apiName": "file.modify",
      "displayName": "Modify File",
      "description": "Modifies an existing file in the repository.",
      "category": "file",
      "hazardous": true,
      "parameters": [
        {
          "apiName": "filePath",
          "displayName": "File Path",
          "description": "Path to the file to modify.",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": { "pattern": "^[a-zA-Z0-9/_.-]+$" }
        },
        {
          "apiName": "content",
          "displayName": "New Content",
          "description": "New content for the file.",
          "dataType": { "type": "STRING" },
          "required": true,
          "uiHints": { "inputType": "textarea" }
        },
        {
          "apiName": "reason",
          "displayName": "Reason",
          "description": "Reason for the modification.",
          "dataType": { "type": "STRING" },
          "required": true
        }
      ],
      "affectedObjectTypes": [
        {
          "objectTypeApiName": "File",
          "operations": ["MODIFY"],
          "modifiableProperties": ["content", "modifiedAt", "modifiedBy"]
        }
      ],
      "editSpecifications": [
        {
          "operationType": "MODIFY_OBJECT",
          "targetObjectType": "File",
          "objectSelection": {
            "selectionType": "QUERY",
            "queryExpression": "path == $filePath"
          },
          "propertyMappings": [
            { "targetProperty": "content", "sourceParameter": "content" }
          ]
        }
      ],
      "submissionCriteria": [
        {
          "apiName": "fileExists",
          "displayName": "File Must Exist",
          "criterionType": "OBJECT_STATE_CHECK",
          "expression": "File.exists($filePath)",
          "errorMessage": "File does not exist at the specified path."
        },
        {
          "apiName": "hasWritePermission",
          "displayName": "Write Permission Required",
          "criterionType": "PERMISSION_CHECK",
          "expression": "user.hasPermission('file.write', $filePath)",
          "errorMessage": "You do not have write permission for this file."
        }
      ],
      "sideEffects": [
        {
          "apiName": "notifyFileOwner",
          "effectType": "NOTIFICATION",
          "configuration": {
            "notificationConfig": {
              "recipientExpression": "File.getOwner($filePath)",
              "messageTemplate": "File ${filePath} was modified by ${user.name}. Reason: ${reason}",
              "channel": "IN_APP"
            }
          },
          "async": true
        }
      ],
      "implementation": {
        "type": "FUNCTION_BACKED",
        "functionRef": "lib.oda.actions.file.modify_file",
        "functionLanguage": "PYTHON",
        "functionConfig": { "timeout": 30000 }
      },
      "permissions": {
        "requiredRoles": ["Developer", "Admin"],
        "objectTypePermissions": [
          { "objectTypeApiName": "File", "requiredAccess": "WRITE" }
        ]
      },
      "status": "ACTIVE",
      "auditConfig": {
        "enabled": true,
        "logLevel": "DETAILED",
        "includeBeforeAfter": true
      },
      "undoConfig": {
        "undoable": true,
        "undoWindowMinutes": 60,
        "undoStrategy": "RESTORE_SNAPSHOT"
      },
      "metadata": {
        "createdAt": "2026-01-17T10:00:00Z",
        "createdBy": "system",
        "version": 1,
        "tags": ["file-operations", "core"],
        "module": "file_management"
      }
    },
    {
      "apiName": "assignEmployeeToProject",
      "displayName": "Assign Employee to Project",
      "description": "Assigns an employee to a project with a specified role.",
      "category": "project",
      "hazardous": false,
      "parameters": [
        {
          "apiName": "employee",
          "displayName": "Employee",
          "dataType": { "type": "OBJECT_PICKER", "objectTypeRef": "Employee" },
          "required": true
        },
        {
          "apiName": "project",
          "displayName": "Project",
          "dataType": { "type": "OBJECT_PICKER", "objectTypeRef": "Project" },
          "required": true
        },
        {
          "apiName": "role",
          "displayName": "Role",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": {
            "enum": ["Lead", "Developer", "Designer", "QA", "Manager"]
          }
        }
      ],
      "affectedObjectTypes": [
        {
          "objectTypeApiName": "Employee",
          "operations": ["MODIFY"]
        },
        {
          "objectTypeApiName": "Project",
          "operations": ["MODIFY"]
        }
      ],
      "editSpecifications": [
        {
          "operationType": "CREATE_LINK",
          "targetLinkType": "ProjectToTeamMember",
          "linkSelection": {
            "sourceObjectParameter": "project",
            "targetObjectParameter": "employee"
          },
          "propertyMappings": [
            { "targetProperty": "assignedRole", "sourceParameter": "role" },
            { "targetProperty": "joinedAt", "expression": "now()" }
          ]
        }
      ],
      "submissionCriteria": [
        {
          "apiName": "notAlreadyAssigned",
          "displayName": "Not Already Assigned",
          "criterionType": "CARDINALITY_CHECK",
          "expression": "!ProjectToTeamMember.exists($project, $employee)",
          "errorMessage": "Employee is already assigned to this project."
        }
      ],
      "implementation": {
        "type": "DECLARATIVE"
      },
      "status": "ACTIVE"
    }
  ]
}
