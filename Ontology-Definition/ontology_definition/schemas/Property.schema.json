{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://oda.palantir.local/schemas/Property.schema.json",
  "title": "Property Definition Schema",
  "description": "Palantir Foundry-aligned Property definition for ODA system. A Property is the schema definition of a characteristic of a real-world entity or event. This schema covers SharedProperties, ValueTypes, and reusable property definitions.",
  "type": "object",
  "properties": {
    "$type": {
      "type": "string",
      "description": "Discriminator for property definition type.",
      "enum": ["SharedProperty", "ValueType", "StructType"]
    }
  },
  "required": ["$type"],
  "oneOf": [
    { "$ref": "#/$defs/SharedProperty" },
    { "$ref": "#/$defs/ValueType" },
    { "$ref": "#/$defs/StructType" }
  ],
  "$defs": {
    "SharedProperty": {
      "type": "object",
      "description": "Reusable property definition that can be shared across multiple ObjectTypes for consistency.",
      "properties": {
        "$type": { "const": "SharedProperty" },
        "apiName": {
          "type": "string",
          "description": "Unique identifier for this shared property.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
          "minLength": 1,
          "maxLength": 255
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly name.",
          "minLength": 1,
          "maxLength": 255
        },
        "description": {
          "type": "string",
          "description": "Documentation for this shared property.",
          "maxLength": 4096
        },
        "rid": {
          "type": "string",
          "description": "Resource ID - auto-generated.",
          "pattern": "^ri\\.ontology\\.[a-z]+\\.shared-property\\.[a-zA-Z0-9-]+$",
          "readOnly": true
        },
        "dataType": {
          "$ref": "#/$defs/DataType",
          "description": "Data type specification."
        },
        "constraints": {
          "$ref": "#/$defs/PropertyConstraints",
          "description": "Validation constraints."
        },
        "isMandatoryControl": {
          "type": "boolean",
          "description": "If true, this is a security marking property. Must be required and cannot have default.",
          "default": false
        },
        "mandatoryControlConfig": {
          "$ref": "#/$defs/MandatoryControlConfig",
          "description": "Configuration when isMandatoryControl is true."
        },
        "semanticType": {
          "type": "string",
          "description": "Semantic meaning of this property for cross-ObjectType consistency.",
          "enum": [
            "IDENTIFIER",
            "NAME",
            "DESCRIPTION",
            "TIMESTAMP",
            "CREATED_AT",
            "MODIFIED_AT",
            "CREATED_BY",
            "MODIFIED_BY",
            "STATUS",
            "CATEGORY",
            "TAG",
            "URL",
            "EMAIL",
            "PHONE",
            "ADDRESS",
            "CURRENCY",
            "PERCENTAGE",
            "SECURITY_MARKING",
            "CUSTOM"
          ]
        },
        "status": {
          "$ref": "#/$defs/PropertyStatus",
          "default": "EXPERIMENTAL"
        },
        "usedByObjectTypes": {
          "type": "array",
          "description": "ObjectTypes using this shared property (auto-populated).",
          "items": { "type": "string" },
          "readOnly": true
        },
        "metadata": {
          "$ref": "#/$defs/PropertyMetadata"
        }
      },
      "required": ["$type", "apiName", "displayName", "dataType"],
      "additionalProperties": false
    },
    "ValueType": {
      "type": "object",
      "description": "User-defined type derived from a base type with additional constraints. Reusable across multiple Properties.",
      "properties": {
        "$type": { "const": "ValueType" },
        "apiName": {
          "type": "string",
          "description": "Unique identifier for this value type.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
          "minLength": 1,
          "maxLength": 255,
          "examples": ["EmailAddress", "PhoneNumber", "PositiveInteger", "ISO8601Date"]
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly name.",
          "minLength": 1,
          "maxLength": 255
        },
        "description": {
          "type": "string",
          "description": "Documentation explaining this value type's purpose and constraints.",
          "maxLength": 4096
        },
        "rid": {
          "type": "string",
          "pattern": "^ri\\.ontology\\.[a-z]+\\.value-type\\.[a-zA-Z0-9-]+$",
          "readOnly": true
        },
        "baseType": {
          "type": "string",
          "description": "Underlying primitive type this ValueType extends.",
          "enum": [
            "STRING",
            "INTEGER",
            "LONG",
            "FLOAT",
            "DOUBLE",
            "BOOLEAN",
            "DATE",
            "TIMESTAMP",
            "DATETIME"
          ]
        },
        "constraints": {
          "$ref": "#/$defs/ValueTypeConstraints",
          "description": "Validation constraints that define this value type."
        },
        "status": {
          "$ref": "#/$defs/PropertyStatus",
          "default": "EXPERIMENTAL"
        },
        "usedByProperties": {
          "type": "array",
          "description": "Properties using this value type (auto-populated).",
          "items": { "type": "string" },
          "readOnly": true
        },
        "metadata": {
          "$ref": "#/$defs/PropertyMetadata"
        }
      },
      "required": ["$type", "apiName", "displayName", "baseType", "constraints"],
      "additionalProperties": false
    },
    "StructType": {
      "type": "object",
      "description": "User-defined complex data type with multiple fields. Reusable nested structure for properties.",
      "properties": {
        "$type": { "const": "StructType" },
        "apiName": {
          "type": "string",
          "description": "Unique identifier for this struct type.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
          "minLength": 1,
          "maxLength": 255,
          "examples": ["Address", "ContactInfo", "GeoCoordinate", "MonetaryAmount"]
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly name.",
          "minLength": 1,
          "maxLength": 255
        },
        "description": {
          "type": "string",
          "description": "Documentation explaining this struct's purpose.",
          "maxLength": 4096
        },
        "rid": {
          "type": "string",
          "pattern": "^ri\\.ontology\\.[a-z]+\\.struct-type\\.[a-zA-Z0-9-]+$",
          "readOnly": true
        },
        "fields": {
          "type": "array",
          "description": "Field definitions within this struct.",
          "items": {
            "$ref": "#/$defs/StructField"
          },
          "minItems": 1
        },
        "status": {
          "$ref": "#/$defs/PropertyStatus",
          "default": "EXPERIMENTAL"
        },
        "metadata": {
          "$ref": "#/$defs/PropertyMetadata"
        }
      },
      "required": ["$type", "apiName", "displayName", "fields"],
      "additionalProperties": false
    },
    "DataType": {
      "type": "object",
      "description": "Data type specification for a property.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Base type identifier.",
          "enum": [
            "STRING",
            "INTEGER",
            "LONG",
            "FLOAT",
            "DOUBLE",
            "BOOLEAN",
            "DATE",
            "TIMESTAMP",
            "DATETIME",
            "ARRAY",
            "STRUCT",
            "GEOPOINT",
            "GEOSHAPE",
            "TIMESERIES",
            "MEDIA_REFERENCE",
            "VECTOR",
            "JSON",
            "MARKDOWN",
            "BINARY",
            "DECIMAL"
          ]
        },
        "arrayItemType": {
          "$ref": "#/$defs/DataType",
          "description": "For ARRAY type, the type of array elements."
        },
        "structTypeRef": {
          "type": "string",
          "description": "For STRUCT type, reference to a StructType definition."
        },
        "valueTypeRef": {
          "type": "string",
          "description": "Reference to a custom ValueType definition."
        },
        "precision": {
          "type": "integer",
          "description": "For DECIMAL type, total number of digits.",
          "minimum": 1,
          "maximum": 38
        },
        "scale": {
          "type": "integer",
          "description": "For DECIMAL type, digits after decimal point.",
          "minimum": 0,
          "maximum": 38
        },
        "vectorDimension": {
          "type": "integer",
          "description": "For VECTOR type, the dimension size.",
          "minimum": 1
        },
        "timeseriesValueType": {
          "type": "string",
          "description": "For TIMESERIES type, the value type.",
          "enum": ["INTEGER", "LONG", "FLOAT", "DOUBLE"]
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "StructField": {
      "type": "object",
      "description": "Field definition within a StructType.",
      "properties": {
        "apiName": {
          "type": "string",
          "description": "Field name within the struct.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "displayName": {
          "type": "string",
          "description": "Human-friendly field name."
        },
        "dataType": {
          "$ref": "#/$defs/DataType"
        },
        "required": {
          "type": "boolean",
          "description": "If true, field must have a value.",
          "default": false
        },
        "defaultValue": {
          "description": "Default value if not provided."
        },
        "constraints": {
          "$ref": "#/$defs/PropertyConstraints"
        }
      },
      "required": ["apiName", "displayName", "dataType"],
      "additionalProperties": false
    },
    "PropertyConstraints": {
      "type": "object",
      "description": "Validation constraints for a property.",
      "properties": {
        "required": {
          "type": "boolean",
          "description": "If true, property cannot be null/empty.",
          "default": false
        },
        "unique": {
          "type": "boolean",
          "description": "If true, value must be unique across all instances.",
          "default": false
        },
        "immutable": {
          "type": "boolean",
          "description": "If true, value cannot be changed after initial set.",
          "default": false
        },
        "enum": {
          "type": "array",
          "description": "Allowed values for this property.",
          "items": {}
        },
        "minValue": {
          "type": "number",
          "description": "Minimum numeric value (inclusive)."
        },
        "maxValue": {
          "type": "number",
          "description": "Maximum numeric value (inclusive)."
        },
        "minLength": {
          "type": "integer",
          "description": "Minimum string length.",
          "minimum": 0
        },
        "maxLength": {
          "type": "integer",
          "description": "Maximum string length.",
          "minimum": 0
        },
        "pattern": {
          "type": "string",
          "description": "Regex pattern for string validation.",
          "format": "regex"
        },
        "ridFormat": {
          "type": "boolean",
          "description": "If true, must be valid RID format.",
          "default": false
        },
        "uuidFormat": {
          "type": "boolean",
          "description": "If true, must be valid UUID format.",
          "default": false
        },
        "arrayUnique": {
          "type": "boolean",
          "description": "For ARRAY type, if true, elements must be unique.",
          "default": false
        },
        "arrayMinItems": {
          "type": "integer",
          "description": "For ARRAY type, minimum number of items.",
          "minimum": 0
        },
        "arrayMaxItems": {
          "type": "integer",
          "description": "For ARRAY type, maximum number of items.",
          "minimum": 0
        },
        "customValidator": {
          "type": "string",
          "description": "Reference to custom validation function."
        },
        "defaultValue": {
          "description": "Default value if not provided. Cannot be set if isMandatoryControl is true."
        }
      },
      "additionalProperties": false
    },
    "ValueTypeConstraints": {
      "type": "object",
      "description": "Constraints that define a ValueType (at least one must be specified).",
      "properties": {
        "enum": {
          "type": "array",
          "description": "Allowed values.",
          "items": {}
        },
        "minValue": { "type": "number" },
        "maxValue": { "type": "number" },
        "minLength": { "type": "integer", "minimum": 0 },
        "maxLength": { "type": "integer", "minimum": 0 },
        "pattern": {
          "type": "string",
          "format": "regex",
          "description": "Regex pattern that values must match."
        },
        "ridFormat": { "type": "boolean" },
        "uuidFormat": { "type": "boolean" },
        "emailFormat": { "type": "boolean" },
        "urlFormat": { "type": "boolean" },
        "dateFormat": {
          "type": "string",
          "description": "Expected date format string."
        }
      },
      "anyOf": [
        { "required": ["enum"] },
        { "required": ["minValue"] },
        { "required": ["maxValue"] },
        { "required": ["minLength"] },
        { "required": ["maxLength"] },
        { "required": ["pattern"] },
        { "required": ["ridFormat"] },
        { "required": ["uuidFormat"] },
        { "required": ["emailFormat"] },
        { "required": ["urlFormat"] },
        { "required": ["dateFormat"] }
      ],
      "additionalProperties": false
    },
    "MandatoryControlConfig": {
      "type": "object",
      "description": "Configuration for mandatory control property (Palantir P1-CRITICAL).",
      "properties": {
        "controlType": {
          "type": "string",
          "description": "Type of mandatory control.",
          "enum": ["MARKINGS", "ORGANIZATIONS", "CLASSIFICATIONS"]
        },
        "markingColumnType": {
          "type": "string",
          "description": "Column type for marking storage - must be STRING ARRAY of UUIDs.",
          "const": "STRING_ARRAY"
        },
        "allowedMarkings": {
          "type": "array",
          "description": "For MARKINGS type, the set of allowed marking IDs.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "allowedOrganizations": {
          "type": "array",
          "description": "For ORGANIZATIONS type, allowed organization IDs.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "maxClassificationLevel": {
          "type": "string",
          "description": "For CLASSIFICATIONS type (CBAC only), maximum classification level.",
          "enum": ["UNCLASSIFIED", "CONFIDENTIAL", "SECRET", "TOP_SECRET"]
        },
        "enforcementLevel": {
          "type": "string",
          "description": "How strictly to enforce the control.",
          "enum": ["STRICT", "WARN", "AUDIT_ONLY"],
          "default": "STRICT"
        }
      },
      "required": ["controlType"],
      "additionalProperties": false
    },
    "PropertyStatus": {
      "type": "string",
      "description": "Lifecycle status.",
      "enum": [
        "DRAFT",
        "EXPERIMENTAL",
        "ALPHA",
        "BETA",
        "ACTIVE",
        "STABLE",
        "DEPRECATED",
        "SUNSET",
        "ARCHIVED",
        "DELETED"
      ],
      "default": "EXPERIMENTAL"
    },
    "PropertyMetadata": {
      "type": "object",
      "description": "Auxiliary tracking information.",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "readOnly": true
        },
        "createdBy": {
          "type": "string",
          "readOnly": true
        },
        "modifiedAt": {
          "type": "string",
          "format": "date-time",
          "readOnly": true
        },
        "modifiedBy": {
          "type": "string",
          "readOnly": true
        },
        "version": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "readOnly": true
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "$type": "SharedProperty",
      "apiName": "createdAt",
      "displayName": "Created At",
      "description": "Timestamp when this object was created.",
      "dataType": { "type": "TIMESTAMP" },
      "constraints": {
        "required": true,
        "immutable": true
      },
      "semanticType": "CREATED_AT",
      "status": "ACTIVE"
    },
    {
      "$type": "SharedProperty",
      "apiName": "securityMarkings",
      "displayName": "Security Markings",
      "description": "Mandatory control property for row-level security based on user markings.",
      "dataType": {
        "type": "ARRAY",
        "arrayItemType": { "type": "STRING" }
      },
      "constraints": {
        "required": true,
        "arrayUnique": true
      },
      "isMandatoryControl": true,
      "mandatoryControlConfig": {
        "controlType": "MARKINGS",
        "markingColumnType": "STRING_ARRAY",
        "enforcementLevel": "STRICT"
      },
      "semanticType": "SECURITY_MARKING",
      "status": "ACTIVE"
    },
    {
      "$type": "ValueType",
      "apiName": "EmailAddress",
      "displayName": "Email Address",
      "description": "Valid email address format.",
      "baseType": "STRING",
      "constraints": {
        "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
        "maxLength": 255,
        "emailFormat": true
      },
      "status": "ACTIVE"
    },
    {
      "$type": "ValueType",
      "apiName": "PositiveInteger",
      "displayName": "Positive Integer",
      "description": "Integer greater than zero.",
      "baseType": "INTEGER",
      "constraints": {
        "minValue": 1
      },
      "status": "ACTIVE"
    },
    {
      "$type": "ValueType",
      "apiName": "Priority",
      "displayName": "Priority Level",
      "description": "Task or item priority level.",
      "baseType": "STRING",
      "constraints": {
        "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
      },
      "status": "ACTIVE"
    },
    {
      "$type": "StructType",
      "apiName": "Address",
      "displayName": "Address",
      "description": "Physical or mailing address.",
      "fields": [
        {
          "apiName": "street",
          "displayName": "Street",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": { "maxLength": 255 }
        },
        {
          "apiName": "city",
          "displayName": "City",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": { "maxLength": 100 }
        },
        {
          "apiName": "state",
          "displayName": "State/Province",
          "dataType": { "type": "STRING" },
          "required": false,
          "constraints": { "maxLength": 100 }
        },
        {
          "apiName": "postalCode",
          "displayName": "Postal Code",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": { "pattern": "^[A-Z0-9\\- ]{3,10}$" }
        },
        {
          "apiName": "country",
          "displayName": "Country",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": { "maxLength": 100 }
        }
      ],
      "status": "ACTIVE"
    },
    {
      "$type": "StructType",
      "apiName": "MonetaryAmount",
      "displayName": "Monetary Amount",
      "description": "Amount with currency.",
      "fields": [
        {
          "apiName": "amount",
          "displayName": "Amount",
          "dataType": { "type": "DECIMAL", "precision": 18, "scale": 2 },
          "required": true
        },
        {
          "apiName": "currency",
          "displayName": "Currency",
          "dataType": { "type": "STRING" },
          "required": true,
          "constraints": {
            "pattern": "^[A-Z]{3}$",
            "enum": ["USD", "EUR", "GBP", "JPY", "KRW", "CNY"]
          }
        }
      ],
      "status": "ACTIVE"
    }
  ]
}
